--- Project Export ---
Generated: Tue Nov 18 11:53:33 CST 2025

======================================================================
GCP IAM POLICY (Principals & Roles) | Project: adk-d2c-travel-concierge
======================================================================

bindings:
- members:
  - serviceAccount:service-275958968804@compute-system.iam.gserviceaccount.com
  role: roles/compute.serviceAgent
- members:
  - serviceAccount:275958968804@cloudservices.gserviceaccount.com
  role: roles/editor
- members:
  - user:admin@scottmyelle.altostrat.com
  role: roles/owner
etag: BwZDzZ7ohcA=
version: 1

======================================================================
FILE: ./pyproject.toml
======================================================================

[project]
name = "travel-concierge"
version = "0.1.0"
description = "Orchestrates personalized travel experiences, illustrates means to integrate booking systems, and provides support throughout the traveler's journey, from initial planning, booking, to real-time itinerary services and alerts."
authors = [
    { name = "Gary Ng", email = "gkcng@google.com" },
    { name = "Arun Santhanagopalan", email = "asanthan@google.com" },
    { name = "Renee Zhang", email = "xiaolizhang@google.com" },
    { name = "Anisha Kaul", email = "anishasjkaul@google.com" },
    { name = "Duncan Renfrow-Symon", email = "drenfrowsymon@google.com" },
]
license = "Apache-2.0"
readme = "README.md"
dependencies = [
    "google-cloud-aiplatform[adk,agent-engines]>=1.93.0",
    "pydantic>=2.10.6",
    "python-dotenv>=1.0.1",
    "google-genai>=1.16.1",
    "google-adk>=1.0.0",
]

requires-python = ">=3.10,<3.13"

[dependency-groups]
dev = [
    "pytest>=8.3.5",
    "google-adk[eval]>=1.16.0",
    "pytest-asyncio>=0.26.0",
    "agent-starter-pack>=0.14.1",
]

deployment = [
    "absl-py>=2.2.1",
    "cloudpickle>=3.1.1",
    "flake8-pyproject>=1.2.3",
]

[project.optional-dependencies]
lint = [
    "ruff>=0.4.6",
    "mypy>=1.15.0",
    "codespell>=2.2.0",
    "types-pyyaml>=6.0.12.20240917",
    "types-requests>=2.32.0.20240914",
]

[tool.ruff]
line-length = 88
target-version = "py310"

[tool.ruff.lint]
select = [
    "E",   # pycodestyle
    "F",   # pyflakes
    "W",   # pycodestyle warnings
    "I",   # isort
    "C",  # flake8-comprehensions
    "B",   # flake8-bugbear
    "UP", # pyupgrade
    "RUF", # ruff specific rules
]
ignore = ["E501", "C901"] # ignore line too long, too complex

[tool.ruff.lint.isort]
known-first-party = ["travel_concierge"]

[tool.mypy]
disallow_untyped_calls = true
disallow_untyped_defs = true
disallow_incomplete_defs = true
no_implicit_optional = true
check_untyped_defs = true
disallow_subclassing_any = true
warn_incomplete_stub = true
warn_redundant_casts = true
warn_unused_ignores = true
warn_unreachable = true
follow_imports = "silent"
ignore_missing_imports = true
explicit_package_bases = true
disable_error_code = ["misc", "no-untyped-call", "no-any-return"]

exclude = [".venv"]

[tool.codespell]
ignore-words-list = "rouge"
skip = "./locust_env/*,uv.lock,.venv,./frontend,**/*.ipynb"

[tool.pytest.ini_options]
pythonpath = "."
asyncio_default_fixture_loop_scope = "function"

[build-system]
requires = ["uv_build>=0.8.14,<0.9.0"]
build-backend = "uv_build"

[tool.uv.build-backend]
module-root = ""

# This configuration file is used by goo.gle/agent-starter-pack to power remote templating.
# It defines the template's properties and settings.
[tool.agent-starter-pack]
example_question = "I want to plan a trip to Seattle"

[tool.agent-starter-pack.settings]
agent_directory = "travel_concierge"

======================================================================
FILE: ./tests/unit/test_tools.py
======================================================================

# Copyright 2025 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

"""Basic tests for individual tools."""

import os
import unittest

from dotenv import load_dotenv
from google.adk.agents.invocation_context import InvocationContext
from google.adk.artifacts import InMemoryArtifactService
from google.adk.sessions import InMemorySessionService
from google.adk.tools import ToolContext
import pytest
from travel_concierge.agent import root_agent
from travel_concierge.tools.memory import memorize
from travel_concierge.tools.places import map_tool


@pytest.fixture(scope="session", autouse=True)
def load_env():
    load_dotenv()


session_service = InMemorySessionService()
artifact_service = InMemoryArtifactService()


class TestAgents(unittest.TestCase):
    """Test cases for the Travel Concierge cohort of agents."""

    def setUp(self):
        """Set up for test methods."""
        super().setUp()
        self.session = session_service.create_session_sync(
            app_name="Travel_Concierge",
            user_id="traveler0115",
        )
        self.user_id = "traveler0115"
        self.session_id = self.session.id

        self.invoc_context = InvocationContext(
            session_service=session_service,
            invocation_id="ABCD",
            agent=root_agent,
            session=self.session,
        )
        self.tool_context = ToolContext(invocation_context=self.invoc_context)

    def test_memory(self):
        result = memorize(
            key="itinerary_datetime",
            value="12/31/2025 11:59:59",
            tool_context=self.tool_context,
        )
        self.assertIn("status", result)
        self.assertEqual(
            self.tool_context.state["itinerary_datetime"], "12/31/2025 11:59:59"
        )

    @pytest.mark.skipif(
        not os.getenv("GOOGLE_PLACES_API_KEY"),
        reason="Google Places API key not available"
    )
    def test_places(self):
        self.tool_context.state["poi"] = {
            "places": [{"place_name": "Machu Picchu", "address": "Machu Picchu, Peru"}]
        }
        result = map_tool(key="poi", tool_context=self.tool_context)
        print(result)
        self.assertIn("place_id", result["places"][0])
        self.assertEqual(
            self.tool_context.state["poi"]["places"][0]["place_id"],
            "ChIJVVVViV-abZERJxqgpA43EDo",
        )

======================================================================
FILE: ./tests/mcp_abnb.py
======================================================================

# Copyright 2025 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

"""An example of the travel-concierge agents incorporating an MCP tool."""

import asyncio
import json

from dotenv import load_dotenv
from google.adk.artifacts.in_memory_artifact_service import InMemoryArtifactService
from google.adk.runners import Runner
from google.adk.sessions import InMemorySessionService
from google.adk.tools.agent_tool import AgentTool
from google.adk.tools.mcp_tool.mcp_toolset import MCPToolset, StdioServerParameters
from google.genai import types
from travel_concierge.agent import root_agent


load_dotenv()


async def get_tools_async():
    """Gets tools from MCP Server."""
    tools, exit_stack = await MCPToolset.from_server(
        connection_params=StdioServerParameters(
            command="npx",
            args=["-y", "@openbnb/mcp-server-airbnb", "--ignore-robots-txt"],
        )
    )
    # MCP requires maintaining a connection to the local MCP Server.
    # Using exit_stack to clean up server connection before exit.
    return tools, exit_stack


def find_agent(agent, targat_name):
    """A convenient function to find an agent from an existing agent graph."""
    result = None
    print("Matching...", agent.name)
    if agent.name == targat_name:
        return agent
    for sub_agent in agent.sub_agents:
        result = find_agent(sub_agent, targat_name)
        if result:
            break
    for tool in agent.tools:
        if isinstance(tool, AgentTool):
            result = find_agent(tool.agent, targat_name)
            if result:
                break
    return result


async def get_agent_async():
    """Creates an ADK Agent with tools from MCP Server."""
    tools, exit_stack = await get_tools_async()
    print("\nInserting Airbnb MCP tools into Travel-Concierge...")
    planner = find_agent(root_agent, "planning_agent")
    if planner:
        print("FOUND", planner.name)
        planner.tools.extend(tools)
    else:
        print("NOT FOUND")
    return root_agent, exit_stack


async def async_main(question):
    """Executes one turn of the travel_concierge agents with a query that would trigger the MCP tool."""
    session_service = InMemorySessionService()
    artifacts_service = InMemoryArtifactService()
    session = session_service.create_session(
        state={}, app_name="travel-concierge", user_id="traveler0115"
    )

    query = question
    print("[user]: ", query)
    content = types.Content(role="user", parts=[types.Part(text=query)])

    agent, exit_stack = await get_agent_async()
    runner = Runner(
        app_name="travel-concierge",
        agent=agent,
        artifact_service=artifacts_service,
        session_service=session_service,
    )

    events_async = runner.run_async(
        session_id=session.id, user_id="traveler0115", new_message=content
    )

    # Results Handling
    # print(events_async)
    async for event in events_async:
        # {'error': 'Function activities_agent is not found in the tools_dict.'}
        if not event.content:
            continue

        # print(event)
        author = event.author
        # Uncomment this to see the full event payload
        # print(f"\n[{author}]: {json.dumps(event)}")

        function_calls = [
            e.function_call for e in event.content.parts if e.function_call
        ]
        function_responses = [
            e.function_response for e in event.content.parts if e.function_response
        ]

        if event.content.parts[0].text:
            text_response = event.content.parts[0].text
            print(f"\n[{author}]: {text_response}")

        if function_calls:
            for function_call in function_calls:
                print(
                    f"\n[{author}]: {function_call.name}( {json.dumps(function_call.args)} )"
                )

        elif function_responses:
            for function_response in function_responses:
                function_name = function_response.name
                # Detect different payloads and handle accordingly
                application_payload = function_response.response
                if function_name == "airbnb_search":
                    application_payload = application_payload["result"].content[0].text
                print(
                    f"\n[{author}]: {function_name} responds -> {application_payload}"
                )

    await exit_stack.aclose()


if __name__ == "__main__":
    asyncio.run(
        async_main(
            (
                "Find me an airbnb in San Diego, April 9th, to april 13th, no flights nor itinerary needed. "
                "No need to confirm, simply return 5 choices, remember to include urls."
            )
        )
    )

======================================================================
FILE: ./tests/programmatic_example.py
======================================================================

# Copyright 2025 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

"""This is a rudimentary example showing how to interact with an ADK agent as a server end point."""

import json
import requests

#
# This client connects to an existing end point created by running `adk api_server <agent package>`
# This client also illustrates how one can use the adk events streamed from the server side to inform user interface components.
#

# Endpoint created by running `adk api_server travel_concierge``
RUN_ENDPOINT = "http://127.0.0.1:8000/run_sse"
HEADERS = {
    "Content-Type": "application/json; charset=UTF-8",
    "Accept": "text/event-stream",
}

# Create a session if it doesn't exist
SESSION_ENDPOINT = "http://127.0.0.1:8000/apps/travel_concierge/users/traveler0115/sessions/session_2449"
response = requests.post(SESSION_ENDPOINT)
print("Session", response.json())

# We are going to run just two turns with the concierge
user_inputs = [
    "Inspire me about the Maldives",
    "Show me a few activites around Baa Atoll",
]

for user_input in user_inputs:

    DATA = {
        "session_id": "session_2449",
        "app_name": "travel_concierge",
        "user_id": "traveler0115",
        "new_message": {
            "role": "user",
            "parts": [
                {
                    "text": user_input,
                }
            ],
        },
    }

    print(f'\n[user]: "{user_input}"')

    with requests.post(
        RUN_ENDPOINT, data=json.dumps(DATA), headers=HEADERS, stream=True
    ) as r:
        for chunk in r.iter_lines():  # or, for line in r.iter_lines():
            # These events and its content can be inspected and leveraged.
            # This under-pins application integration;
            if not chunk:
                continue
            json_string = chunk.decode("utf-8").removeprefix("data: ").strip()
            event = json.loads(json_string)

            # {'error': 'Function activities_agent is not found in the tools_dict.'}
            if "content" not in event:
                print(event)
                continue

            author = event["author"]
            # Uncomment this to see the full event payload
            # print(f"\n[{author}]: {json.dumps(event)}")
            # continue

            function_calls = [
                e["functionCall"]
                for e in event["content"]["parts"]
                if "functionCall" in e
            ]
            function_responses = [
                e["functionResponse"]
                for e in event["content"]["parts"]
                if "functionResponse" in e
            ]

            if "text" in event["content"]["parts"][0]:
                text_response = event["content"]["parts"][0]["text"]
                print(f"\n{author} {text_response}")

            if function_calls:
                for function_call in function_calls:
                    name = function_call["name"]
                    args = function_call["args"]
                    print(
                        f'\n{author}\nfunction call: "{name}"\nargs: {json.dumps(args,indent=2)}\n'
                    )

            elif function_responses:
                for function_response in function_responses:
                    function_name = function_response["name"]
                    application_payload = json.dumps(
                        function_response["response"], indent=2
                    )
                    print(
                        f'\n{author}\nResponse from: "{name}"\nresponse: {application_payload}\n'
                    )

                    # A switch case statement against the function_name allows
                    # an application to act according to which agent / tool the response originated from.
                    match function_name:
                        case "place_agent":
                            print("\n[app]: To render a carousel of destinations")
                        case "map_tool":
                            print("\n[app]: To render a map of pois")
                        case "flight_selection_agent":
                            print("\n[app]: Render a list")
                        case "hotel_selection_agent":
                            print("\n[app]: Render a list")
                    # ... etc

======================================================================
FILE: ./tests/pre_booking_sample.md
======================================================================


**\[user\]:** inspire me about the americas

**\[root_agent\]:**
```json
function call: "transfer_to_agent"
args: {
  "agent_name": "inspiration_agent"
}
```


**\[root_agent\]:**
```json
Response from: "transfer_to_agent"
response: {}
```


**\[inspiration_agent\]:**
```json
function call: "place_agent"
args: {
  "request": "the americas"
}
```


**\[inspiration_agent\]:**
```json
Response from: "place_agent"
response: {
  "places": [
    {
      "name": "Machu Picchu",
      "country": "Peru",
      "image": "https://upload.wikimedia.org/wikipedia/commons/e/eb/Machu_Picchu%2C_Peru.jpg",
      "highlights": "Ancient Inca citadel set high in the Andes Mountains, offering stunning views and rich history.",
      "rating": "4.8"
    },
    {
      "name": "Banff National Park",
      "country": "Canada",
      "image": "https://upload.wikimedia.org/wikipedia/commons/1/1e/Moraine_Lake_Sunrise.jpg",
      "highlights": "Turquoise glacial lakes, majestic mountains, and abundant wildlife in the heart of the Canadian Rockies.",
      "rating": "4.7"
    },
    {
      "name": "New York City",
      "country": "USA",
      "image": "https://upload.wikimedia.org/wikipedia/commons/thumb/0/02/NYC_Downtown_Manhattan_ skyline_seen_from_Jersey_City_--_Oct_2019.jpg/1280px-NYC_Downtown_Manhattan_skyline_seen_from_Jersey_City_--_Oct_2019.jpg",
      "highlights": "Iconic landmarks, world-class museums, diverse neighborhoods, and vibrant cultural experiences.",
      "rating": "4.6"
    }
  ]
}
```


**\[inspiration_agent\]:** OK. I have three destinations in the Americas for you: Machu Picchu in Peru, Banff National Park in Canada, and New York City in the USA.

Machu Picchu is an ancient Inca citadel set high in the Andes Mountains. Banff National Park boasts turquoise glacial lakes and majestic mountains. New York City offers iconic landmarks, world-class museums, and diverse neighborhoods.

Are any of these destinations sound interesting to you? Or would you like me to refine the search?


**\[user\]:** Peru sounds fun!

**\[inspiration_agent\]:** Great! Peru is an amazing country with a rich history and culture. Would you like me to provide some recommendations for things to do and see in Peru? I can use the `poi_agent` to find some points of interest for you.


**\[user\]:** suggest a few activities 

**\[inspiration_agent\]:**
```json
function call: "poi_agent"
args: {
  "request": "Peru"
}
```


**\[inspiration_agent\]:**
```json
Response from: "poi_agent"
response: {
  "places": [
    {
      "place_name": "Machu Picchu",
      "address": "Machu Picchu, Aguas Calientes, Peru",
      "lat": "-13.1631",
      "long": "-72.5450",
      "review_ratings": "4.7",
      "highlights": "Ancient Inca citadel set high in the Andes Mountains.",
      "image_url": "https://example.com/machu_picchu.jpg",
      "map_url": "",
      "place_id": ""
    },
    {
      "place_name": "Sacsayhuam\u00e1n",
      "address": "Sacsayhuam\u00e1n, Cusco, Peru",
      "lat": "-13.5081",
      "long": "-71.9805",
      "review_ratings": "4.5",
      "highlights": "A walled complex on the northern outskirts of Cusco, Peru.",
      "image_url": "https://example.com/sacsayhuaman.jpg",
      "map_url": "",
      "place_id": ""
    },
    {
      "place_name": "Plaza de Armas, Cusco",
      "address": "Plaza de Armas, Cusco, Peru",
      "lat": "-13.5167",
      "long": "-71.9786",
      "review_ratings": "4.6",
      "highlights": "The heart of Cusco, surrounded by historical buildings and churches.",
      "image_url": "https://example.com/plaza_de_armas_cusco.jpg",
      "map_url": "",
      "place_id": ""
    },
    {
      "place_name": "Nazca Lines",
      "address": "Nazca Lines, Nazca, Peru",
      "lat": "-14.8344",
      "long": "-75.4742",
      "review_ratings": "4.3",
      "highlights": "Ancient geoglyphs in the Nazca Desert, best viewed from the air.",
      "image_url": "https://example.com/nazca_lines.jpg",
      "map_url": "",
      "place_id": ""
    },
    {
      "place_name": "Lake Titicaca",
      "address": "Lake Titicaca, Puno, Peru",
      "lat": "-15.8333",
      "long": "-69.3333",
      "review_ratings": "4.4",
      "highlights": "South America's largest lake, known for its floating islands.",
      "image_url": "https://example.com/lake_titicaca.jpg",
      "map_url": "",
      "place_id": ""
    }
  ]
}
```


**\[inspiration_agent\]:** OK. I have a few suggestions for activities in Peru:

1.  **Machu Picchu:** Explore the ancient Inca citadel set high in the Andes Mountains.
2.  **Sacsayhuamán:** Visit a walled complex on the northern outskirts of Cusco.
3.  **Plaza de Armas, Cusco:** Discover the heart of Cusco, surrounded by historical buildings and churches.
4.  **Nazca Lines:** See the ancient geoglyphs in the Nazca Desert, best viewed from the air.
5.  **Lake Titicaca:** Explore South America's largest lake, known for its floating islands.

Do any of these activities sound interesting?


**\[inspiration_agent\]:**
```json
function call: "map_tool"
args: {
  "key": "poi"
}
```


**\[inspiration_agent\]:**
```json
Response from: "map_tool"
response: {
  "result": [
    {
      "place_name": "Machu Picchu",
      "address": "Machu Picchu, Aguas Calientes, Peru",
      "lat": "-13.1547062",
      "long": "-72.5254412",
      "review_ratings": "4.7",
      "highlights": "Ancient Inca citadel set high in the Andes Mountains.",
      "image_url": "https://example.com/machu_picchu.jpg",
      "map_url": "https://www.google.com/maps/place/?q=place_id:ChIJNf_BuIOabZERglGl1iKpiYQ",
      "place_id": "ChIJNf_BuIOabZERglGl1iKpiYQ"
    },
    {
      "place_name": "Sacsayhuam\u00e1n",
      "address": "Sacsayhuam\u00e1n, Cusco, Peru",
      "lat": "-13.509856",
      "long": "-71.9816878",
      "review_ratings": "4.5",
      "highlights": "A walled complex on the northern outskirts of Cusco, Peru.",
      "image_url": "https://example.com/sacsayhuaman.jpg",
      "map_url": "https://www.google.com/maps/place/?q=place_id:ChIJ_agIfG7WbZERPIDD5LG4PJ4",
      "place_id": "ChIJ_agIfG7WbZERPIDD5LG4PJ4"
    },
    {
      "place_name": "Plaza de Armas, Cusco",
      "address": "Plaza de Armas, Cusco, Peru",
      "lat": "-13.5167681",
      "long": "-71.9787795",
      "review_ratings": "4.6",
      "highlights": "The heart of Cusco, surrounded by historical buildings and churches.",
      "image_url": "https://example.com/plaza_de_armas_cusco.jpg",
      "map_url": "https://www.google.com/maps/place/?q=place_id:ChIJdfHXnHPWbZERQ2P8gpCafAI",
      "place_id": "ChIJdfHXnHPWbZERQ2P8gpCafAI"
    },
    {
      "place_name": "Nazca Lines",
      "address": "Nazca Lines, Nazca, Peru",
      "lat": "-14.739027",
      "long": "-75.130005",
      "review_ratings": "4.3",
      "highlights": "Ancient geoglyphs in the Nazca Desert, best viewed from the air.",
      "image_url": "https://example.com/nazca_lines.jpg",
      "map_url": "https://www.google.com/maps/place/?q=place_id:ChIJrTK1zEYeFJERkbWXZrnSAhg",
      "place_id": "ChIJrTK1zEYeFJERkbWXZrnSAhg"
    },
    {
      "place_name": "Lake Titicaca",
      "address": "Lake Titicaca, Puno, Peru",
      "lat": "-15.8402218",
      "long": "-70.0218805",
      "review_ratings": "4.4",
      "highlights": "South America's largest lake, known for its floating islands.",
      "image_url": "https://example.com/lake_titicaca.jpg",
      "map_url": "https://www.google.com/maps/place/?q=place_id:ChIJNUHn9IVpXZERzzJN8tgdNB4",
      "place_id": "ChIJNUHn9IVpXZERzzJN8tgdNB4"
    }
  ]
}
```


**\[inspiration_agent\]:** OK, great! I've confirmed the locations of those POIs on the map. Given your interest in Peru, especially considering your vegan food preference, would you like me to look into vegan restaurants in Cusco or other regions you might be interested in visiting? Or perhaps you'd like help with planning a more detailed itinerary, including flights and hotels?


**\[user\]:** Plan itinerary

**\[inspiration_agent\]:**
```json
function call: "transfer_to_agent"
args: {
  "agent_name": "planning_agent"
}
```


**\[inspiration_agent\]:**
```json
Response from: "transfer_to_agent"
response: {}
```


**\[planning_agent\]:** OK. I can help you plan an itinerary for your trip to Peru.

First, I need to gather some information:

*   **Origin:** Where will you be departing from?
*   **Start Date:** When would you like to start your trip?
*   **End Date:** When would you like to end your trip? Or, alternatively, how many days would you like to stay?

Once I have this information, I can start searching for flights and hotels and create a draft itinerary for you.


**\[user\]:** From San Diego, May 4th for a week.

**\[planning_agent\]:** Okay, I have the following information:

*   **Origin:** San Diego, CA, USA
*   **Destination:** Peru (Based on your previous interest)
*   **Start Date:** May 4, 2025
*   **Duration:** 7 days
*   **End Date:** May 11, 2025

I will now memorize the origin, destination, start date, and end date.


**\[planning_agent\]:**
```json
function call: "memorize"
args: {
  "value": "San Diego, CA, USA",
  "key": "origin"
}
```


**\[planning_agent\]:**
```json
function call: "memorize"
args: {
  "key": "destination",
  "value": "Peru"
}
```


**\[planning_agent\]:**
```json
function call: "memorize"
args: {
  "key": "start_date",
  "value": "2025-05-04"
}
```


**\[planning_agent\]:**
```json
function call: "memorize"
args: {
  "key": "end_date",
  "value": "2025-05-11"
}
```


**\[planning_agent\]:**
```json
Response from: "memorize"
response: {
  "status": "Stored \"origin\": \"San Diego, CA, USA\""
}
```


**\[planning_agent\]:**
```json
Response from: "memorize"
response: {
  "status": "Stored \"destination\": \"Peru\""
}
```


**\[planning_agent\]:**
```json
Response from: "memorize"
response: {
  "status": "Stored \"start_date\": \"2025-05-04\""
}
```


**\[planning_agent\]:**
```json
Response from: "memorize"
response: {
  "status": "Stored \"end_date\": \"2025-05-11\""
}
```


**\[planning_agent\]:** Now that I have the dates and location, let's start by finding flights. I will use the `flight_search_agent` to find flights from San Diego to Peru for the specified dates.


**\[planning_agent\]:**
```json
function call: "flight_search_agent"
args: {
  "request": "Flights from San Diego, CA, USA to Peru from 2025-05-04 to 2025-05-11"
}
```


**\[planning_agent\]:**
```json
Response from: "flight_search_agent"
response: {
  "flights": [
    {
      "flight_number": "AA123",
      "departure": {
        "cityName": "San Diego",
        "airportCode": "SAN",
        "timestamp": "2025-05-04T14:00:00Z"
      },
      "arrival": {
        "cityName": "Lima",
        "airportCode": "LIM",
        "timestamp": "2025-05-05T02:00:00Z"
      },
      "airlines": [
        "American Airlines"
      ],
      "airline_logo": "/images/american.png",
      "priceInUSD": 600,
      "numberOfStops": 1
    },
    {
      "flight_number": "UA456",
      "departure": {
        "cityName": "San Diego",
        "airportCode": "SAN",
        "timestamp": "2025-05-06T10:00:00Z"
      },
      "arrival": {
        "cityName": "Cusco",
        "airportCode": "CUZ",
        "timestamp": "2025-05-07T01:00:00Z"
      },
      "airlines": [
        "United Airlines"
      ],
      "airline_logo": "/images/united.png",
      "priceInUSD": 700,
      "numberOfStops": 2
    },
    {
      "flight_number": "DL789",
      "departure": {
        "cityName": "San Diego",
        "airportCode": "SAN",
        "timestamp": "2025-05-08T16:00:00Z"
      },
      "arrival": {
        "cityName": "Lima",
        "airportCode": "LIM",
        "timestamp": "2025-05-09T03:00:00Z"
      },
      "airlines": [
        "Delta Air Lines"
      ],
      "airline_logo": "/images/delta1.jpg",
      "priceInUSD": 650,
      "numberOfStops": 0
    },
    {
      "flight_number": "LA101",
      "departure": {
        "cityName": "San Diego",
        "airportCode": "SAN",
        "timestamp": "2025-05-10T08:00:00Z"
      },
      "arrival": {
        "cityName": "Arequipa",
        "airportCode": "AQP",
        "timestamp": "2025-05-11T12:00:00Z"
      },
      "airlines": [
        "LATAM Airlines"
      ],
      "airline_logo": "/images/airplane.png",
      "priceInUSD": 800,
      "numberOfStops": 1
    }
  ]
}
```


**\[planning_agent\]:** OK, I have found some flights for your trip. Here are a few options:

1.  **American Airlines (AA123):** Departs from San Diego (SAN) on May 4th at 2:00 PM, arrives in Lima (LIM) on May 5th at 2:00 AM. 1 stop. Price: $600.
2.  **United Airlines (UA456):** Departs from San Diego (SAN) on May 6th at 10:00 AM, arrives in Cusco (CUZ) on May 7th at 1:00 AM. 2 stops. Price: $700.
3.  **Delta Air Lines (DL789):** Departs from San Diego (SAN) on May 8th at 4:00 PM, arrives in Lima (LIM) on May 9th at 3:00 AM. Non-stop. Price: $650.
4.  **LATAM Airlines (LA101):** Departs from San Diego (SAN) on May 10th at 8:00 AM, arrives in Arequipa (AQP) on May 11th at 12:00 PM. 1 stop. Price: $800.

Which outbound flight do you prefer?


**\[user\]:** AA123

**\[planning_agent\]:** Okay, you've chosen American Airlines (AA123) departing on May 4th. Now, let's select your seat for this flight.



**\[planning_agent\]:**
```json
function call: "flight_seat_selection_agent"
args: {
  "request": "American Airlines (AA123) departing from San Diego (SAN) on May 4th at 2:00 PM, arriving in Lima (LIM) on May 5th at 2:00 AM"
}
```


**\[planning_agent\]:**
```json
Response from: "flight_seat_selection_agent"
response: {
  "seats": [
    [
      {
        "isAvailable": true,
        "priceInUSD": 60,
        "seatNumber": "1A"
      },
      {
        "isAvailable": true,
        "priceInUSD": 60,
        "seatNumber": "1B"
      },
      {
        "isAvailable": false,
        "priceInUSD": 60,
        "seatNumber": "1C"
      },
      {
        "isAvailable": true,
        "priceInUSD": 70,
        "seatNumber": "1D"
      },
      {
        "isAvailable": true,
        "priceInUSD": 70,
        "seatNumber": "1E"
      },
      {
        "isAvailable": true,
        "priceInUSD": 50,
        "seatNumber": "1F"
      }
    ],
    [
      {
        "isAvailable": true,
        "priceInUSD": 60,
        "seatNumber": "2A"
      },
      {
        "isAvailable": false,
        "priceInUSD": 60,
        "seatNumber": "2B"
      },
      {
        "isAvailable": true,
        "priceInUSD": 60,
        "seatNumber": "2C"
      },
      {
        "isAvailable": true,
        "priceInUSD": 70,
        "seatNumber": "2D"
      },
      {
        "isAvailable": true,
        "priceInUSD": 70,
        "seatNumber": "2E"
      },
      {
        "isAvailable": true,
        "priceInUSD": 50,
        "seatNumber": "2F"
      }
    ],
    [
      {
        "isAvailable": true,
        "priceInUSD": 60,
        "seatNumber": "3A"
      },
      {
        "isAvailable": true,
        "priceInUSD": 60,
        "seatNumber": "3B"
      },
      {
        "isAvailable": true,
        "priceInUSD": 60,
        "seatNumber": "3C"
      },
      {
        "isAvailable": true,
        "priceInUSD": 70,
        "seatNumber": "3D"
      },
      {
        "isAvailable": true,
        "priceInUSD": 70,
        "seatNumber": "3E"
      },
      {
        "isAvailable": true,
        "priceInUSD": 50,
        "seatNumber": "3F"
      }
    ],
    [
      {
        "isAvailable": true,
        "priceInUSD": 60,
        "seatNumber": "4A"
      },
      {
        "isAvailable": true,
        "priceInUSD": 60,
        "seatNumber": "4B"
      },
      {
        "isAvailable": true,
        "priceInUSD": 60,
        "seatNumber": "4C"
      },
      {
        "isAvailable": true,
        "priceInUSD": 70,
        "seatNumber": "4D"
      },
      {
        "isAvailable": true,
        "priceInUSD": 70,
        "seatNumber": "4E"
      },
      {
        "isAvailable": true,
        "priceInUSD": 50,
        "seatNumber": "4F"
      }
    ],
    [
      {
        "isAvailable": true,
        "priceInUSD": 60,
        "seatNumber": "5A"
      },
      {
        "isAvailable": true,
        "priceInUSD": 60,
        "seatNumber": "5B"
      },
      {
        "isAvailable": true,
        "priceInUSD": 60,
        "seatNumber": "5C"
      },
      {
        "isAvailable": true,
        "priceInUSD": 70,
        "seatNumber": "5D"
      },
      {
        "isAvailable": true,
        "priceInUSD": 70,
        "seatNumber": "5E"
      },
      {
        "isAvailable": true,
        "priceInUSD": 50,
        "seatNumber": "5F"
      }
    ]
  ]
}
```


**\[planning_agent\]:** Okay, I have the seat map for American Airlines flight AA123. Since you prefer a window seat, here are some available options: 1A, 1F, 2A, 2C, 2F, 3A, 3B, 3C, 3F, 4A, 4B, 4C, 4F, 5A, 5B, 5C, 5F.

Please select your preferred seat number.


**\[user\]:** 1A

**\[planning_agent\]:** Okay, you've selected seat 1A for your outbound flight. I will now memorize the outbound flight choice and seat number.


**\[planning_agent\]:**
```json
function call: "memorize"
args: {
  "value": "{\"airline_logo\": \"/images/american.png\", \"airlines\": [\"American Airlines\"], \"arrival\": {\"airportCode\": \"LIM\", \"cityName\": \"Lima\", \"timestamp\": \"2025-05-05T02:00:00Z\"}, \"departure\": {\"airportCode\": \"SAN\", \"cityName\": \"San Diego\", \"timestamp\": \"2025-05-04T14:00:00Z\"}, \"flight_number\": \"AA123\", \"numberOfStops\": 1, \"priceInUSD\": 600}",
  "key": "outbound_flight_selection"
}
```


**\[planning_agent\]:**
```json
Response from: "memorize"
response: {
  "status": "Stored \"outbound_flight_selection\": \"{\"airline_logo\": \"/images/american.png\", \"airlines\": [\"American Airlines\"], \"arrival\": {\"airportCode\": \"LIM\", \"cityName\": \"Lima\", \"timestamp\": \"2025-05-05T02:00:00Z\"}, \"departure\": {\"airportCode\": \"SAN\", \"cityName\": \"San Diego\", \"timestamp\": \"2025-05-04T14:00:00Z\"}, \"flight_number\": \"AA123\", \"numberOfStops\": 1, \"priceInUSD\": 600}\""
}
```


**\[planning_agent\]:**
```json
function call: "memorize"
args: {
  "value": "1A",
  "key": "outbound_seat_number"
}
```


**\[planning_agent\]:**
```json
Response from: "memorize"
response: {
  "status": "Stored \"outbound_seat_number\": \"1A\""
}
```


**\[planning_agent\]:** Now, let's find a return flight from Peru to San Diego on May 11th.


**\[planning_agent\]:**
```json
function call: "flight_search_agent"
args: {
  "request": "Flights from Peru to San Diego, CA, USA on 2025-05-11"
}
```


**\[planning_agent\]:**
```json
Response from: "flight_search_agent"
response: {
  "flights": [
    {
      "flight_number": "LATAM2345",
      "departure": {
        "cityName": "Lima",
        "airportCode": "LIM",
        "timestamp": "2025-05-11T14:00:00Z"
      },
      "arrival": {
        "cityName": "San Diego",
        "airportCode": "SAN",
        "timestamp": "2025-05-12T02:00:00Z"
      },
      "airlines": [
        "LATAM Airlines"
      ],
      "airline_logo": "/images/LATAM.png",
      "priceInUSD": 650,
      "numberOfStops": 1
    },
    {
      "flight_number": "AVIANCA1234",
      "departure": {
        "cityName": "Lima",
        "airportCode": "LIM",
        "timestamp": "2025-05-11T18:00:00Z"
      },
      "arrival": {
        "cityName": "San Diego",
        "airportCode": "SAN",
        "timestamp": "2025-05-12T08:00:00Z"
      },
      "airlines": [
        "Avianca"
      ],
      "airline_logo": "/images/avianca.png",
      "priceInUSD": 700,
      "numberOfStops": 1
    },
    {
      "flight_number": "AmericanAirlines5678",
      "departure": {
        "cityName": "Cusco",
        "airportCode": "CUZ",
        "timestamp": "2025-05-11T10:00:00Z"
      },
      "arrival": {
        "cityName": "San Diego",
        "airportCode": "SAN",
        "timestamp": "2025-05-12T16:00:00Z"
      },
      "airlines": [
        "American Airlines"
      ],
      "airline_logo": "/images/american.png",
      "priceInUSD": 800,
      "numberOfStops": 2
    },
    {
      "flight_number": "Delta9101",
      "departure": {
        "cityName": "Lima",
        "airportCode": "LIM",
        "timestamp": "2025-05-11T16:00:00Z"
      },
      "arrival": {
        "cityName": "San Diego",
        "airportCode": "SAN",
        "timestamp": "2025-05-12T05:00:00Z"
      },
      "airlines": [
        "Delta Air Lines"
      ],
      "airline_logo": "/images/delta1.jpg",
      "priceInUSD": 750,
      "numberOfStops": 1
    }
  ]
}
```


**\[planning_agent\]:** OK, I have found some return flights for your trip. Here are a few options:

1.  **LATAM Airlines (LATAM2345):** Departs from Lima (LIM) on May 11th at 2:00 PM, arrives in San Diego (SAN) on May 12th at 2:00 AM. 1 stop. Price: $650.
2.  **Avianca (AVIANCA1234):** Departs from Lima (LIM) on May 11th at 6:00 PM, arrives in San Diego (SAN) on May 12th at 8:00 AM. 1 stop. Price: $700.
3.  **American Airlines (AmericanAirlines5678):** Departs from Cusco (CUZ) on May 11th at 10:00 AM, arrives in San Diego (SAN) on May 12th at 4:00 PM. 2 stops. Price: $800.
4.  **Delta Air Lines (Delta9101):** Departs from Lima (LIM) on May 11th at 4:00 PM, arrives in San Diego (SAN) on May 12th at 5:00 AM. 1 stop. Price: $750.

Which return flight do you prefer?


**\[user\]:** LATAM2345

**\[planning_agent\]:** Okay, you've chosen LATAM Airlines (LATAM2345) departing on May 11th. Now, let's select your seat for this flight.


**\[planning_agent\]:**
```json
function call: "flight_seat_selection_agent"
args: {
  "request": "LATAM Airlines (LATAM2345) departing from Lima (LIM) on May 11th at 2:00 PM, arriving in San Diego (SAN) on May 12th at 2:00 AM"
}
```


**\[planning_agent\]:**
```json
Response from: "flight_seat_selection_agent"
response: {
  "seats": [
    [
      {
        "isAvailable": true,
        "priceInUSD": 60,
        "seatNumber": "1A"
      },
      {
        "isAvailable": true,
        "priceInUSD": 60,
        "seatNumber": "1B"
      },
      {
        "isAvailable": false,
        "priceInUSD": 60,
        "seatNumber": "1C"
      },
      {
        "isAvailable": true,
        "priceInUSD": 70,
        "seatNumber": "1D"
      },
      {
        "isAvailable": true,
        "priceInUSD": 70,
        "seatNumber": "1E"
      },
      {
        "isAvailable": true,
        "priceInUSD": 50,
        "seatNumber": "1F"
      }
    ],
    [
      {
        "isAvailable": true,
        "priceInUSD": 60,
        "seatNumber": "2A"
      },
      {
        "isAvailable": false,
        "priceInUSD": 60,
        "seatNumber": "2B"
      },
      {
        "isAvailable": true,
        "priceInUSD": 60,
        "seatNumber": "2C"
      },
      {
        "isAvailable": true,
        "priceInUSD": 70,
        "seatNumber": "2D"
      },
      {
        "isAvailable": true,
        "priceInUSD": 70,
        "seatNumber": "2E"
      },
      {
        "isAvailable": true,
        "priceInUSD": 50,
        "seatNumber": "2F"
      }
    ],
    [
      {
        "isAvailable": true,
        "priceInUSD": 60,
        "seatNumber": "3A"
      },
      {
        "isAvailable": true,
        "priceInUSD": 60,
        "seatNumber": "3B"
      },
      {
        "isAvailable": true,
        "priceInUSD": 60,
        "seatNumber": "3C"
      },
      {
        "isAvailable": true,
        "priceInUSD": 70,
        "seatNumber": "3D"
      },
      {
        "isAvailable": false,
        "priceInUSD": 70,
        "seatNumber": "3E"
      },
      {
        "isAvailable": true,
        "priceInUSD": 50,
        "seatNumber": "3F"
      }
    ],
    [
      {
        "isAvailable": true,
        "priceInUSD": 60,
        "seatNumber": "4A"
      },
      {
        "isAvailable": true,
        "priceInUSD": 60,
        "seatNumber": "4B"
      },
      {
        "isAvailable": true,
        "priceInUSD": 60,
        "seatNumber": "4C"
      },
      {
        "isAvailable": true,
        "priceInUSD": 70,
        "seatNumber": "4D"
      },
      {
        "isAvailable": true,
        "priceInUSD": 70,
        "seatNumber": "4E"
      },
      {
        "isAvailable": true,
        "priceInUSD": 50,
        "seatNumber": "4F"
      }
    ],
    [
      {
        "isAvailable": true,
        "priceInUSD": 60,
        "seatNumber": "5A"
      },
      {
        "isAvailable": false,
        "priceInUSD": 60,
        "seatNumber": "5B"
      },
      {
        "isAvailable": true,
        "priceInUSD": 60,
        "seatNumber": "5C"
      },
      {
        "isAvailable": false,
        "priceInUSD": 70,
        "seatNumber": "5D"
      },
      {
        "isAvailable": true,
        "priceInUSD": 70,
        "seatNumber": "5E"
      },
      {
        "isAvailable": true,
        "priceInUSD": 50,
        "seatNumber": "5F"
      }
    ]
  ]
}
```


**\[planning_agent\]:** Okay, I have the seat map for LATAM Airlines flight LATAM2345. Since you prefer a window seat, here are some available options: 1A, 1B, 1F, 2A, 2C, 2F, 3A, 3B, 3F, 4A, 4B, 4C, 4F, 5A, 5C, 5E, 5F

Please select your preferred seat number.


**\[user\]:** 2A

**\[planning_agent\]:** Okay, you've selected seat 2A for your return flight. I will now memorize the return flight choice and seat number.


**\[planning_agent\]:**
```json
function call: "memorize"
args: {
  "key": "return_flight_selection",
  "value": "{\"airline_logo\": \"/images/LATAM.png\", \"airlines\": [\"LATAM Airlines\"], \"arrival\": {\"airportCode\": \"SAN\", \"cityName\": \"San Diego\", \"timestamp\": \"2025-05-12T02:00:00Z\"}, \"departure\": {\"airportCode\": \"LIM\", \"cityName\": \"Lima\", \"timestamp\": \"2025-05-11T14:00:00Z\"}, \"flight_number\": \"LATAM2345\", \"numberOfStops\": 1, \"priceInUSD\": 650}"
}
```


**\[planning_agent\]:**
```json
Response from: "memorize"
response: {
  "status": "Stored \"return_flight_selection\": \"{\"airline_logo\": \"/images/LATAM.png\", \"airlines\": [\"LATAM Airlines\"], \"arrival\": {\"airportCode\": \"SAN\", \"cityName\": \"San Diego\", \"timestamp\": \"2025-05-12T02:00:00Z\"}, \"departure\": {\"airportCode\": \"LIM\", \"cityName\": \"Lima\", \"timestamp\": \"2025-05-11T14:00:00Z\"}, \"flight_number\": \"LATAM2345\", \"numberOfStops\": 1, \"priceInUSD\": 650}\""
}
```


**\[planning_agent\]:**
```json
function call: "memorize"
args: {
  "value": "2A",
  "key": "return_seat_number"
}
```


**\[planning_agent\]:**
```json
Response from: "memorize"
response: {
  "status": "Stored \"return_seat_number\": \"2A\""
}
```


**\[planning_agent\]:** Now that we have the flights, let's find a hotel. Based on the activities you were interested in, I will search for hotels in Cusco, as it's a central location for visiting Machu Picchu and Sacsayhuamán.


**\[planning_agent\]:**
```json
function call: "hotel_search_agent"
args: {
  "request": "hotel in Cusco, Peru from 2025-05-05 to 2025-05-11"
}
```


**\[planning_agent\]:**
```json
Response from: "hotel_search_agent"
response: {
  "hotels": [
    {
      "name": "Palacio del Inka, a Luxury Collection Hotel, Cusco",
      "address": "Calle Santa Catalina 103, Cusco 08000, Peru",
      "check_in_time": "15:00",
      "check_out_time": "12:00",
      "thumbnail": "/src/images/hotel.png",
      "price": 350
    },
    {
      "name": "Belmond Hotel Monasterio",
      "address": "Calle Plazoleta Nazarenas, Cusco 08001, Peru",
      "check_in_time": "14:00",
      "check_out_time": "11:00",
      "thumbnail": "/src/images/hotel.png",
      "price": 450
    },
    {
      "name": "Sol y Luna, a Belmond Hotel, Sacred Valley",
      "address": "Urubamba, Sacred Valley, Peru",
      "check_in_time": "15:00",
      "check_out_time": "12:00",
      "thumbnail": "/src/images/hotel.png",
      "price": 500
    },
    {
      "name": "Inkaterra La Casona",
      "address": "Calle Santa Clara, Cusco 08002, Peru",
      "check_in_time": "14:00",
      "check_out_time": "11:00",
      "thumbnail": "/src/images/hotel.png",
      "price": 300
    }
  ]
}
```


**\[planning_agent\]:** OK, I have found some hotels in Cusco for your trip. Here are a few options:

1.  **Palacio del Inka, a Luxury Collection Hotel, Cusco:** Address: Calle Santa Catalina 103, Cusco 08000, Peru. Price: $350 per night. Check-in: 3:00 PM, Check-out: 12:00 PM.
2.  **Belmond Hotel Monasterio:** Address: Calle Plazoleta Nazarenas, Cusco 08001, Peru. Price: $450 per night. Check-in: 2:00 PM, Check-out: 11:00 AM.
3.  **Sol y Luna, a Belmond Hotel, Sacred Valley:** Address: Urubamba, Sacred Valley, Peru. Price: $500 per night. Check-in: 3:00 PM, Check-out: 12:00 PM.
4.  **Inkaterra La Casona:** Address: Calle Santa Clara, Cusco 08002, Peru. Price: $300 per night. Check-in: 2:00 PM, Check-out: 11:00 AM.

Which hotel do you prefer?


**\[user\]:** Belmond Hotel Monasterio

**\[planning_agent\]:** Okay, you've chosen Belmond Hotel Monasterio. Now, let's select a room for your stay.


**\[planning_agent\]:**
```json
function call: "hotel_room_selection_agent"
args: {
  "request": "Belmond Hotel Monasterio in Cusco, Peru from 2025-05-05 to 2025-05-11"
}
```


**\[planning_agent\]:**
```json
Response from: "hotel_room_selection_agent"
response: {
  "rooms": [
    {
      "isAvailable": true,
      "priceInUSD": 450,
      "roomType": "Queen Room with Balcony"
    },
    {
      "isAvailable": true,
      "priceInUSD": 500,
      "roomType": "King Room with Balcony"
    },
    {
      "isAvailable": false,
      "priceInUSD": 400,
      "roomType": "Twin Room"
    },
    {
      "isAvailable": true,
      "priceInUSD": 450,
      "roomType": "Double Room"
    }
  ]
}
```


**\[planning_agent\]:** Okay, I have the room options for Belmond Hotel Monasterio. Here are the available rooms:

1.  **Queen Room with Balcony:** Price: $450 per night.
2.  **King Room with Balcony:** Price: $500 per night.
3.  **Double Room:** Price: $450 per night.

Which room type do you prefer?


**\[user\]:** Queen Room with Balcony

**\[planning_agent\]:** Okay, you've selected the Queen Room with Balcony. I will now memorize the hotel choice and room selection.


**\[planning_agent\]:**
```json
function call: "memorize"
args: {
  "value": "{\"address\": \"Calle Plazoleta Nazarenas, Cusco 08001, Peru\", \"check_in_time\": \"14:00\", \"check_out_time\": \"11:00\", \"name\": \"Belmond Hotel Monasterio\", \"price\": 450, \"thumbnail\": \"/src/images/hotel.png\"}",
  "key": "hotel_selection"
}
```


**\[planning_agent\]:**
```json
Response from: "memorize"
response: {
  "status": "Stored \"hotel_selection\": \"{\"address\": \"Calle Plazoleta Nazarenas, Cusco 08001, Peru\", \"check_in_time\": \"14:00\", \"check_out_time\": \"11:00\", \"name\": \"Belmond Hotel Monasterio\", \"price\": 450, \"thumbnail\": \"/src/images/hotel.png\"}\""
}
```


**\[planning_agent\]:**
```json
function call: "memorize"
args: {
  "key": "room_selection",
  "value": "Queen Room with Balcony"
}
```


**\[planning_agent\]:**
```json
Response from: "memorize"
response: {
  "status": "Stored \"room_selection\": \"Queen Room with Balcony\""
}
```


**\[planning_agent\]:** Now that we have your flights and hotel sorted, let's create a draft itinerary for your trip to Peru!

**Day 1: May 4, 2025 - Travel to Lima**

*   11:00 AM: Depart from your home (6420 Sequence Dr #400, San Diego, CA 92121, United States) and drive to San Diego International Airport (SAN). (Allow 3 hours for driving, parking, and security).
*   2:00 PM: Depart from San Diego (SAN) on American Airlines (AA123) to Lima (LIM).

**Day 2: May 5, 2025 - Arrival in Cusco & Hotel Check-in**

*   2:00 AM: Arrive in Lima (LIM).
*   (Since there's no direct flight to Cusco, consider a connecting flight in the morning)
*   Morning: Arrive in Cusco (CUZ) (Time to be determined based on connecting flight).
*   Afternoon: Check into Belmond Hotel Monasterio (Calle Plazoleta Nazarenas, Cusco 08001, Peru). Check-in time is 2:00 PM.
*   Evening: Relax and acclimatize to the altitude. Have a vegan meal at a local restaurant in Cusco.

**Day 3: May 6, 2025 - Exploring Cusco**

*   Morning: Visit Plaza de Armas, the heart of Cusco, surrounded by historical buildings and churches.
*   Afternoon: Explore Sacsayhuamán, a walled complex on the northern outskirts of Cusco.

**Day 4: May 7, 2025 - Machu Picchu**

*   Full day trip to Machu Picchu.
*   Take a train from Cusco to Aguas Calientes (the town at the base of Machu Picchu).
*   Explore the ancient Inca citadel with a guided tour.

**Day 5: May 8, 2025 - Exploring Vegan Food in Cusco**

*   Explore more of Cusco, search for vegan restaurant.

**Day 6: May 9, 2025 - Lake Titicaca**

*   Fly to Lake Titicaca and visit the floating islands.

**Day 7: May 10, 2025 - Travel back to Lima**

*   Fly back to Lima from Lake Titicaca.

**Day 8: May 11, 2025 - Departure**

*   11:00 AM: Check out of Belmond Hotel Monasterio. Check-out time is 11:00 AM.
*   2:00 PM: Depart from Lima (LIM) on LATAM Airlines (LATAM2345) to San Diego (SAN).

**Day 9: May 12, 2025 - Arrival in San Diego**

*   2:00 AM: Arrive in San Diego (SAN).

How does this draft itinerary look to you? Would you like me to make any changes?


**\[user\]:** It sounds good!


**\[planning_agent\]:** Great! I'm glad you like the itinerary. Now that you've approved the draft, I'll persist the entire plan using the `itinerary_agent`.


**\[planning_agent\]:**
```json
function call: "itinerary_agent"
args: {
  "request": "Origin: San Diego, CA, USA; Destination: Peru; Start Date: 2025-05-04; End Date: 2025-05-11; Outbound Flight: American Airlines (AA123) from SAN to LIM on 2025-05-04, Seat 1A; Return Flight: LATAM Airlines (LATAM2345) from LIM to SAN on 2025-05-11, Seat 2A; Hotel: Belmond Hotel Monasterio in Cusco, Peru; Room: Queen Room with Balcony; Day 1: Depart from home and fly to Lima; Day 2: Arrive in Lima, connecting flight to Cusco, check into hotel; Day 3: Explore Cusco; Day 4: Machu Picchu; Day 5: Vegan Food in Cusco; Day 6: Lake Titicaca; Day 7: Travel back to Lima; Day 8: Depart from Lima; Day 9: Arrive in San Diego."
}
```


**\[planning_agent\]:**
```json
Response from: "itinerary_agent"
response: {
  "trip_name": "San Diego to Peru Trip",
  "start_date": "2025-05-04",
  "end_date": "2025-05-11",
  "origin": "San Diego",
  "destination": "Peru",
  "days": [
    {
      "day_number": 1,
      "date": "2025-05-04",
      "events": [
        {
          "event_type": "flight",
          "description": "Depart from home and fly to Lima",
          "booking_required": true,
          "departure_airport": "SAN",
          "arrival_airport": "LIM",
          "flight_number": "AA123",
          "boarding_time": "13:30",
          "seat_number": "1A",
          "departure_time": "14:00",
          "arrival_time": "02:00",
          "price": "600",
          "booking_id": ""
        }
      ]
    },
    {
      "day_number": 2,
      "date": "2025-05-05",
      "events": [
        {
          "event_type": "flight",
          "description": "Connecting flight to Cusco",
          "booking_required": true,
          "departure_airport": "LIM",
          "arrival_airport": "CUZ",
          "flight_number": "",
          "boarding_time": "",
          "seat_number": "",
          "departure_time": "",
          "arrival_time": "",
          "price": "",
          "booking_id": ""
        },
        {
          "event_type": "hotel",
          "description": "Check into Belmond Hotel Monasterio",
          "address": "Calle Plazoleta Nazarenas, Cusco 08001, Peru",
          "check_in_time": "14:00",
          "check_out_time": "11:00",
          "room_selection": "Queen Room with Balcony",
          "booking_required": true,
          "price": "450",
          "booking_id": ""
        }
      ]
    },
    {
      "day_number": 3,
      "date": "2025-05-06",
      "events": [
        {
          "event_type": "visit",
          "description": "Explore Cusco",
          "address": "Cusco, Peru",
          "start_time": "09:00",
          "end_time": "18:00",
          "booking_required": false
        }
      ]
    },
    {
      "day_number": 4,
      "date": "2025-05-07",
      "events": [
        {
          "event_type": "visit",
          "description": "Machu Picchu",
          "address": "Machu Picchu, Peru",
          "start_time": "09:00",
          "end_time": "18:00",
          "booking_required": true
        }
      ]
    },
    {
      "day_number": 5,
      "date": "2025-05-08",
      "events": [
        {
          "event_type": "visit",
          "description": "Vegan Food in Cusco",
          "address": "Cusco, Peru",
          "start_time": "09:00",
          "end_time": "18:00",
          "booking_required": false
        }
      ]
    },
    {
      "day_number": 6,
      "date": "2025-05-09",
      "events": [
        {
          "event_type": "visit",
          "description": "Lake Titicaca",
          "address": "Lake Titicaca, Peru",
          "start_time": "09:00",
          "end_time": "18:00",
          "booking_required": true
        }
      ]
    },
    {
      "day_number": 7,
      "date": "2025-05-10",
      "events": [
        {
          "event_type": "flight",
          "description": "Travel back to Lima",
          "booking_required": true,
          "departure_airport": "CUZ",
          "arrival_airport": "LIM",
          "flight_number": "",
          "boarding_time": "",
          "seat_number": "",
          "departure_time": "",
          "arrival_time": "",
          "price": "",
          "booking_id": ""
        }
      ]
    },
    {
      "day_number": 8,
      "date": "2025-05-11",
      "events": [
        {
          "event_type": "flight",
          "description": "Depart from Lima",
          "booking_required": true,
          "departure_airport": "LIM",
          "arrival_airport": "SAN",
          "flight_number": "LATAM2345",
          "boarding_time": "13:30",
          "seat_number": "2A",
          "departure_time": "14:00",
          "arrival_time": "02:00",
          "price": "650",
          "booking_id": ""
        }
      ]
    },
    {
      "day_number": 9,
      "date": "2025-05-12",
      "events": [
        {
          "event_type": "visit",
          "description": "Arrive in San Diego",
          "address": "San Diego, CA, USA",
          "start_time": "02:00",
          "end_time": "02:00",
          "booking_required": false
        }
      ]
    }
  ]
}
```


**\[planning_agent\]:** Okay, the itinerary has been successfully created and saved!

Before I transfer you to the `booking_agent` to finalize the bookings and handle payments, let's reconfirm the details of your trip:

*   **Trip:** San Diego to Peru
*   **Dates:** May 4, 2025 - May 11, 2025
*   **Outbound Flight:** American Airlines (AA123) from San Diego (SAN) to Lima (LIM) on May 4, 2025, departing at 2:00 PM. Seat: 1A.
*   **Return Flight:** LATAM Airlines (LATAM2345) from Lima (LIM) to San Diego (SAN) on May 11, 2025, departing at 2:00 PM. Seat: 2A.
*   **Hotel:** Belmond Hotel Monasterio in Cusco, Peru. Check-in: May 5, 2025, Check-out: May 11, 2025.
*   **Room:** Queen Room with Balcony.

Is all of this information correct?


**\[user\]:** yup

**\[planning_agent\]:** Great! Since everything is confirmed, I will now transfer you to the `booking_agent` to finalize the bookings. The `booking_agent` will handle the payment choices and processing for your flights and hotel.


**\[planning_agent\]:**
```json
function call: "transfer_to_agent"
args: {
  "agent_name": "booking_agent"
}
```


**\[planning_agent\]:**
```json
Response from: "transfer_to_agent"
response: {}
```


**\[booking_agent\]:** OK. I see the following items in your itinerary require bookings:

1.  **Outbound Flight:** American Airlines (AA123) from San Diego (SAN) to Lima (LIM) on May 4, 2025, departing at 2:00 PM. Seat: 1A.
2.  **Connecting flight to Cusco:** from Lima (LIM) to Cusco (CUZ) on May 5, 2025
3.  **Hotel:** Belmond Hotel Monasterio in Cusco, Peru. Check-in: May 5, 2025, Check-out: May 11, 2025. Room: Queen Room with Balcony.
4.  **Machu Picchu visit:** on May 7, 2025
5.  **Lake Titicaca visit:** on May 9, 2025
6.  **Travel back to Lima flight:** from Cusco (CUZ) to Lima (LIM) on May 10, 2025
7.  **Return Flight:** LATAM Airlines (LATAM2345) from Lima (LIM) to San Diego (SAN) on May 11, 2025, departing at 2:00 PM. Seat: 2A.

To streamline the process, I will combine the outbound and return flights into a single transaction.
Are you ready to proceed with confirming and paying for these items?


**\[user\]:** Sounds good

**\[booking_agent\]:** Okay, let's start with the flights.

**Outbound Flight:** American Airlines (AA123) from San Diego (SAN) to Lima (LIM) on May 4, 2025, departing at 2:00 PM. Seat: 1A. Price: $600
**Return Flight:** LATAM Airlines (LATAM2345) from Lima (LIM) to San Diego (SAN) on May 11, 2025, departing at 2:00 PM. Seat: 2A. Price: $650

I'll call the `confirm_reservation_agent` to confirm this reservation, which creates a reservation, pending payment, then wait for your consent.


**\[booking_agent\]:**
```json
function call: "confirm_reservation_agent"
args: {
  "request": "Flight: American Airlines (AA123) from San Diego (SAN) to Lima (LIM) on May 4, 2025, departing at 2:00 PM, Seat: 1A. AND Flight: LATAM Airlines (LATAM2345) from Lima (LIM) to San Diego (SAN) on May 11, 2025, departing at 2:00 PM. Seat: 2A."
}
```


**\[booking_agent\]:**
```json
Response from: "confirm_reservation_agent"
response: {
  "result": "Okay, I have the following flights for you:\n\n**Outbound Flight:**\n\n*   **Airline:** American Airlines (AA123)\n*   **Departure:** San Diego (SAN) on May 4, 2025, at 2:00 PM\n*   **Arrival:** Lima (LIM)\n*   **Seat:** 1A\n\n**Return Flight:**\n\n*   **Airline:** LATAM Airlines (LATAM2345)\n*   **Departure:** Lima (LIM) on May 11, 2025, at 2:00 PM\n*   **Arrival:** San Diego (SAN)\n*   **Seat:** 2A\n\nThe total price for these flights is $1200. Your reservation ID is FLT987654321.\n\nDo you want to proceed with the payment?\n"
}
```


**\[booking_agent\]:** OK. I have confirmed the flights with reservation ID `FLT987654321`. The total price is $1250 ($600 + $650). Do you want to proceed with the payment?


**\[user\]:** yes

**\[booking_agent\]:**
```json
function call: "payment_choice"
args: {
  "request": "flights"
}
```


**\[booking_agent\]:**
```json
Response from: "payment_choice"
response: {
  "result": "Okay, to book your flights, I need to confirm your payment method.\n\nHere are your options:\n\n1.  **Apple Pay**\n2.  **Google Pay**\n3.  **Credit Card on file**\n\nPlease choose one of these options.\n"
}
```


**\[booking_agent\]:** OK. Please choose one of the available payment methods for the flights: Apple Pay, Google Pay, or Credit Card on file.


**\[user\]:** Credit card

**\[booking_agent\]:**
```json
function call: "payment_agent"
args: {
  "request": "Pay $1250 for flights with reservation ID FLT987654321 using credit card on file."
}
```


**\[booking_agent\]:**
```json
Response from: "payment_agent"
response: {
  "result": "```json\n{\n \"payment_status\": \"approved\",\n \"payment_method\": \"credit card\",\n \"amount\": 1250,\n \"transaction_date\": \"2025-03-28 03:07:30\",\n \"reservation_id\": \"FLT987654321\",\n \"final_order_id\": \"ORD9988776655\"\n}\n```\n"
}
```


**\[booking_agent\]:** OK. Payment of $1250 for flights with reservation ID `FLT987654321` has been approved using your credit card on file. Your final order ID is `ORD9988776655`.

Now, let's move on to the next item: **Connecting flight to Cusco:** from Lima (LIM) to Cusco (CUZ) on May 5, 2025.

Could you please provide me with your preferred departure time for this connecting flight? This will help me find the best available option for you.


**\[user\]:** doesn't matter find the best time

**\[booking_agent\]:** Okay, I will find the best time and book the connecting flight from Lima (LIM) to Cusco (CUZ) on May 5, 2025.


**\[booking_agent\]:**
```json
function call: "confirm_reservation_agent"
args: {
  "request": "Connecting flight from Lima (LIM) to Cusco (CUZ) on May 5, 2025, best available time"
}
```


**\[booking_agent\]:**
```json
Response from: "confirm_reservation_agent"
response: {
  "result": "Okay, I can help you with that.\n\nI found a connecting flight from Lima (LIM) to Cusco (CUZ) on May 5, 2025.\n\n**Flight Details:**\n\n*   **Airline:** Avianca\n*   **Departs:** Lima (LIM) at 06:00 AM\n*   **Arrives:** Cusco (CUZ) at 07:25 AM\n*   **Duration:** 1 hour 25 minutes\n*   **Price:** $120\n\n**Reservation ID:** 49285\n\nDo you want to proceed with the payment for this flight?\n"
}
```


**\[booking_agent\]:** OK. I found a connecting flight with these details:

*   **Airline:** Avianca
*   **Departs:** Lima (LIM) at 06:00 AM
*   **Arrives:** Cusco (CUZ) at 07:25 AM
*   **Price:** $120
*   **Reservation ID:** 49285

Do you want to proceed with the payment for this flight?


**\[user\]:** yes please

**\[booking_agent\]:**
```json
function call: "payment_agent"
args: {
  "request": "Pay $120 for connecting flight with reservation ID 49285 using credit card on file."
}
```


**\[booking_agent\]:**
```json
Response from: "payment_agent"
response: {
  "result": "```json\n{\n \"payment_status\": \"approved\",\n \"payment_method\": \"credit card\",\n \"amount\": 120,\n \"reservation_id\": \"49285\",\n \"transaction_date\": \"2025-03-28\",\n \"transaction_time\": \"03:09:08\",\n \"order_id\": \"63920\"\n}\n```"
}
```


**\[booking_agent\]:** OK. Payment of $120 for the connecting flight with reservation ID `49285` has been approved using your credit card on file. Your order ID is `63920`.

Now, let's proceed with the hotel booking:

**Hotel:** Belmond Hotel Monasterio in Cusco, Peru. Check-in: May 5, 2025, Check-out: May 11, 2025. Room: Queen Room with Balcony. Price: $450 per night, for 6 nights = $2700.

I'll call the `confirm_reservation_agent` to confirm this reservation, which creates a reservation, pending payment, then wait for your consent.


**\[booking_agent\]:**
```json
function call: "confirm_reservation_agent"
args: {
  "request": "Hotel: Belmond Hotel Monasterio in Cusco, Peru. Check-in: May 5, 2025, Check-out: May 11, 2025. Room: Queen Room with Balcony."
}
```


**\[booking_agent\]:**
```json
Response from: "confirm_reservation_agent"
response: {
  "result": "Okay, I can help you with that. Let me check the availability and price for a Queen Room with Balcony at the Belmond Hotel Monasterio in Cusco, Peru, from May 5, 2025, to May 11, 2025.\n\nOkay, I have a Queen Room with Balcony available for those dates. The total price, including taxes and fees, is $3,120.\n\n**Reservation Details:**\n\n*   **Hotel:** Belmond Hotel Monasterio\n*   **Location:** Cusco, Peru\n*   **Check-in:** May 5, 2025\n*   **Check-out:** May 11, 2025\n*   **Room Type:** Queen Room with Balcony\n*   **Total Price:** $3,120\n*   **Reservation ID:** BHMC-4957\n\nWould you like to proceed with the payment to confirm this reservation?\n"
}
```


**\[booking_agent\]:** OK. I have confirmed the hotel booking with reservation ID `BHMC-4957`. The total price is $3,120. Do you want to proceed with the payment?


**\[user\]:** yes please

**\[booking_agent\]:**
```json
function call: "payment_agent"
args: {
  "request": "Pay $3,120 for hotel booking with reservation ID BHMC-4957 using credit card on file."
}
```


**\[booking_agent\]:**
```json
Response from: "payment_agent"
response: {
  "result": "```json\n{\n \"payment_status\": \"approved\",\n \"payment_method\": \"credit card\",\n \"amount\": 3120,\n \"reservation_id\": \"BHMC-4957\"\n}\n```\n\nNew order ID is BHMC-4957.\n"
}
```


**\[booking_agent\]:** OK. Payment of $3,120 for the hotel booking with reservation ID `BHMC-4957` has been approved using your credit card on file.

Now let's book the rest of your trip.
**Machu Picchu visit:** on May 7, 2025.


**\[booking_agent\]:**
```json
function call: "confirm_reservation_agent"
args: {
  "request": "Machu Picchu visit on May 7, 2025"
}
```


**\[booking_agent\]:**
```json
Response from: "confirm_reservation_agent"
response: {
  "result": "Okay, I can help you with that!\n\nOne moment while I check availability and pricing for a visit to Machu Picchu on May 7, 2025.\n\nOkay, I found an available entrance ticket for Machu Picchu on May 7, 2025. The price is $150.\n\nYour reservation ID is MP-7594\n\nDo you want to proceed with the payment for this reservation?\n"
}
```


**\[booking_agent\]:** Okay, I found an available entrance ticket for Machu Picchu on May 7, 2025. The price is $150 and the reservation ID is MP-7594.

Do you want to proceed with the payment for this reservation?


**\[user\]:** yes

**\[booking_agent\]:**
```json
function call: "payment_agent"
args: {
  "request": "Pay $150 for Machu Picchu visit with reservation ID MP-7594 using credit card on file."
}
```


**\[booking_agent\]:**
```json
Response from: "payment_agent"
response: {
  "result": "```json\n{\n \"payment_status\": \"approved\",\n \"final_order_id\": \"MP-7594\"\n}\n```"
}
```


**\[booking_agent\]:** OK. Payment of $150 for the Machu Picchu visit with reservation ID `MP-7594` has been approved using your credit card on file.

Next up: **Lake Titicaca visit:** on May 9, 2025


**\[booking_agent\]:**
```json
function call: "confirm_reservation_agent"
args: {
  "request": "Lake Titicaca visit on May 9, 2025"
}
```


**\[booking_agent\]:**
```json
Response from: "confirm_reservation_agent"
response: {
  "result": "Okay, I can help you with that!\n\nI have a Lake Titicaca visit for you on May 9, 2025. The price is $150.\n\n**Here are the reservation details:**\n*   **Item:** Lake Titicaca Visit\n*   **Date:** May 9, 2025\n*   **Price:** $150\n*   **Reservation ID:** LK78956\n\nWould you like to proceed with the payment?\n"
}
```


**\[booking_agent\]:** OK. I have a Lake Titicaca visit for you on May 9, 2025. The price is $150 and the reservation ID is LK78956.

Would you like to proceed with the payment?


**\[user\]:** yes

**\[booking_agent\]:**
```json
function call: "payment_agent"
args: {
  "request": "Pay $150 for Lake Titicaca visit with reservation ID LK78956 using credit card on file."
}
```


**\[booking_agent\]:**
```json
Response from: "payment_agent"
response: {
  "result": "```json\n{\n \"payment_status\": \"approved\",\n \"order_id\": \"LK78956\"\n}\n```"
}
```


**\[booking_agent\]:** OK. Payment of $150 for the Lake Titicaca visit with reservation ID `LK78956` has been approved using your credit card on file.

Lastly: **Travel back to Lima flight:** from Cusco (CUZ) to Lima (LIM) on May 10, 2025


**\[booking_agent\]:**
```json
function call: "confirm_reservation_agent"
args: {
  "request": "Flight from Cusco (CUZ) to Lima (LIM) on May 10, 2025"
}
```


**\[booking_agent\]:**
```json
Response from: "confirm_reservation_agent"
response: {
  "result": "Okay, I can help you with that.\n\nFlight from Cusco (CUZ) to Lima (LIM) on May 10, 2025:\n\n*   **Price:** $150\n*   **Reservation ID:** FLT-749205\n\nDo you want to proceed with the payment?\n"
}
```


**\[booking_agent\]:** OK. I have a flight from Cusco (CUZ) to Lima (LIM) on May 10, 2025 for $150 with reservation ID FLT-749205.

Do you want to proceed with the payment?


**\[user\]:** yes

**\[booking_agent\]:**
```json
function call: "payment_agent"
args: {
  "request": "Pay $150 for flight from Cusco (CUZ) to Lima (LIM) with reservation ID FLT-749205 using credit card on file."
}
```


**\[booking_agent\]:**
```json
Response from: "payment_agent"
response: {
  "result": "```json\n{\n \"payment_status\": \"approved\",\n \"transaction_type\": \"flight booking\",\n \"amount\": 150,\n \"payment_method\": \"credit card\",\n \"reservation_id\": \"FLT-749205\",\n \"final_order_id\": \"ORD-495739\"\n}\n```"
}
```


**\[booking_agent\]:** OK. Payment of $150 for the flight from Cusco (CUZ) to Lima (LIM) with reservation ID `FLT-749205` has been approved using your credit card on file. The final order ID is `ORD-495739`.

That completes all the bookings for your trip! Is there anything else I can help you with?


======================================================================
FILE: ./tests/post_booking_sample.md
======================================================================


**\[user\]:** transfer to pre_trip

**\[root_agent\]:**
```json
function call: "transfer_to_agent"
args: {
  "agent_name": "pre_trip_agent"
}
```


**\[root_agent\]:**
```json
Response from: "transfer_to_agent"
response: {}
```


**\[pre_trip_agent\]:** Okay, I am now in charge. I see you have a trip planned from San Diego to Seattle between June 15th and June 17th, 2025. I will gather relevant travel information for you. Since you have a US passport, I'll keep that in mind.

To start, I will get information on visa requirements, medical requirements, storm monitoring, and travel advisories for your trip. Then I will suggest what to pack.



**\[pre_trip_agent\]:**
```json
function call: "google_search_grounding"
args: {
  "request": "visa_requirements San Diego Seattle"
}
```


**\[pre_trip_agent\]:**
```json
function call: "google_search_grounding"
args: {
  "request": "medical_requirements San Diego Seattle"
}
```


**\[pre_trip_agent\]:**
```json
function call: "google_search_grounding"
args: {
  "request": "storm_monitor San Diego Seattle"
}
```


**\[pre_trip_agent\]:**
```json
function call: "google_search_grounding"
args: {
  "request": "travel_advisory San Diego Seattle"
}
```


**\[pre_trip_agent\]:**
```json
function call: "what_to_pack_agent"
args: {
  "request": "San Diego to Seattle in June"
}
```


**\[pre_trip_agent\]:**
```json
Response from: "what_to_pack_agent"
response: {
  "result": "To visit San Diego or Seattle, ensure you have a valid passport, and if required based on your nationality, apply for a US visa or ESTA through the Electronic System for Travel Authorization.\n"
}
```


**\[pre_trip_agent\]:**
```json
Response from: "what_to_pack_agent"
response: {
  "result": "To ensure a safe and healthy trip from San Diego to Seattle, make sure your routine vaccinations are up to date, consult your doctor about any medical concerns, and carry sufficient prescription medications; for detailed travel health advice, consider contacting Kaiser Permanente's Travel Advisory Service at 1-206-326-3488.\n"
}
```


**\[pre_trip_agent\]:**
```json
Response from: "what_to_pack_agent"
response: {
  "result": "San Diego: Expect patchy drizzle tonight and partly cloudy skies tomorrow with a high around 65\u00b0F.\n\nSeattle: Expect cloudy conditions with periods of rain today and a high of 53\u00b0F, with rain likely to continue through the weekend.\n"
}
```


**\[pre_trip_agent\]:**
```json
Response from: "what_to_pack_agent"
response: {
  "result": "Currently, there are health advisories in San Diego regarding Xylazine in the drug supply and a measles outbreak, and it's always wise to review visitor safety tips in Seattle, such as being aware of your surroundings and protecting your valuables.\n"
}
```


**\[pre_trip_agent\]:**
```json
Response from: "what_to_pack_agent"
response: {
  "items": [
    "light jacket",
    "umbrella",
    "comfortable walking shoes",
    "layers",
    "sunscreen"
  ]
}
```


**\[pre_trip_agent\]:** Here's the important information for your trip:

*   **Visa:** As a US citizen, you do not need a visa for travel between San Diego and Seattle.
*   **Medical:** Ensure your routine vaccinations are up to date. Consider consulting your doctor about any medical concerns and bring sufficient prescription medications. There is a measles outbreak in San Diego, so ensure you are vaccinated.
*   **Travel Advisory:** There are health advisories in San Diego regarding Xylazine in the drug supply. Be aware of your surroundings and protect your valuables in Seattle.
*   **Storm Update:** Weather in San Diego will be partly cloudy with a high around 65°F. Seattle will be cloudy with rain and a high of 53°F.
*   **What to Pack:** I suggest packing a light jacket, umbrella, comfortable walking shoes, layers, and sunscreen.


**\[user\]:** transfer to in_trip

**\[pre_trip_agent\]:**
```json
function call: "transfer_to_agent"
args: {
  "agent_name": "in_trip_agent"
}
```


**\[pre_trip_agent\]:**
```json
Response from: "transfer_to_agent"
response: {}
```


**\[in_trip_agent\]:** Okay, I am now in charge. What do you need help with during your trip? I can provide information about your itinerary, transport, or attractions. Just let me know what you need.


**\[user\]:** monitor

**\[in_trip_agent\]:**
```json
function call: "transfer_to_agent"
args: {
  "agent_name": "trip_monitor_agent"
}
```


**\[in_trip_agent\]:**
```json
Response from: "transfer_to_agent"
response: {}
```


**\[trip_monitor_agent\]:** Okay, I will monitor your itinerary and bring attention to items that necessitate changes.

Here's what I'll do:

1.  **Identify key events:** I'll identify flights, events requiring bookings, and weather-sensitive activities in your itinerary.
2.  **Check their status:** I'll use the available tools to check for flight delays/cancellations, confirm event bookings, and assess weather impacts on outdoor activities.
3.  **Summarize potential issues:** I'll provide a concise list of suggested changes for your attention.

Let's start!

**Flights:**

*   **Flight AA1234 (San Diego to Seattle) on 2025-06-15:** Departure at 08:00, check-in at 07:30.
*   **Flight UA5678 (Seattle to San Diego) on 2025-06-17:** Departure at 16:00, check-in at 15:30.

**Events Requiring Booking:**

*   **Space Needle on 2025-06-16:** Located at 400 Broad St, Seattle, WA 98109.
*   **Museum of Pop Culture (MoPOP) on 2025-06-17:** Located at 325 5th Ave N, Seattle, WA 98109.

**Weather-Sensitive Activities:**

*   **Pike Place Market on 2025-06-16:** Located at 85 Pike St, Seattle, WA 98101.
*   **Ivar's Acres of Clams on 2025-06-16:** Located at 1001 Alaskan Way, Pier 54, Seattle, WA 98104.
*   **Capitol Hill Neighborhood on 2025-06-16:** Located in Capitol Hill, Seattle, WA.

Now, I will check the status of these events using the available tools.


**\[trip_monitor_agent\]:**
```json
function call: "flight_status_check"
args: {
  "flight_date": "2025-06-15",
  "checkin_time": "07:30",
  "departure_time": "08:00",
  "flight_number": "AA1234"
}
```


**\[trip_monitor_agent\]:**
```json
function call: "flight_status_check"
args: {
  "flight_number": "UA5678",
  "checkin_time": "15:30",
  "departure_time": "16:00",
  "flight_date": "2025-06-17"
}
```


**\[trip_monitor_agent\]:**
```json
function call: "event_booking_check"
args: {
  "event_name": "Space Needle",
  "event_location": "400 Broad St, Seattle, WA 98109",
  "event_date": "2025-06-16"
}
```


**\[trip_monitor_agent\]:**
```json
function call: "event_booking_check"
args: {
  "event_name": "Museum of Pop Culture (MoPOP)",
  "event_location": "325 5th Ave N, Seattle, WA 98109",
  "event_date": "2025-06-17"
}
```


**\[trip_monitor_agent\]:**
```json
function call: "weather_impact_check"
args: {
  "activity_location": "85 Pike St, Seattle, WA 98101",
  "activity_date": "2025-06-16",
  "activity_name": "Pike Place Market"
}
```


**\[trip_monitor_agent\]:**
```json
function call: "weather_impact_check"
args: {
  "activity_name": "Ivar's Acres of Clams",
  "activity_date": "2025-06-16",
  "activity_location": "1001 Alaskan Way, Pier 54, Seattle, WA 98104"
}
```


**\[trip_monitor_agent\]:**
```json
function call: "weather_impact_check"
args: {
  "activity_name": "Capitol Hill Neighborhood",
  "activity_location": "Capitol Hill, Seattle, WA",
  "activity_date": "2025-06-16"
}
```


**\[trip_monitor_agent\]:**
```json
Response from: "weather_impact_check"
response: {
  "status": "Flight AA1234 checked"
}
```


**\[trip_monitor_agent\]:**
```json
Response from: "weather_impact_check"
response: {
  "status": "Flight UA5678 checked"
}
```


**\[trip_monitor_agent\]:**
```json
Response from: "weather_impact_check"
response: {
  "status": "Space Needle is closed."
}
```


**\[trip_monitor_agent\]:**
```json
Response from: "weather_impact_check"
response: {
  "status": "Museum of Pop Culture (MoPOP) checked"
}
```


**\[trip_monitor_agent\]:**
```json
Response from: "weather_impact_check"
response: {
  "status": "Pike Place Market checked"
}
```


**\[trip_monitor_agent\]:**
```json
Response from: "weather_impact_check"
response: {
  "status": "Ivar's Acres of Clams checked"
}
```


**\[trip_monitor_agent\]:**
```json
Response from: "weather_impact_check"
response: {
  "status": "Capitol Hill Neighborhood checked"
}
```


**\[trip_monitor_agent\]:** Here's a summary of suggested changes based on my checks:

*   **Space Needle:** The Space Needle is closed on 2025-06-16. You should find an alternative activity or reschedule your visit.

All other events appear to be in order.

I will now transfer you back to the `in_trip_agent` to handle your other needs.


**\[trip_monitor_agent\]:**
```json
function call: "transfer_to_agent"
args: {
  "agent_name": "in_trip_agent"
}
```


**\[trip_monitor_agent\]:**
```json
Response from: "transfer_to_agent"
response: {}
```


**\[in_trip_agent\]:** OK. The Space Needle is closed on June 16, 2025. I suggest you find an alternative activity or reschedule. Let me know if you want me to help you find something else to do, or if you want to reschedule.


**\[user\]:** memorize the date '2025-06-15 04:00:00' and store it in the variable 'itinerary_datetime'


**\[in_trip_agent\]:**
```json
function call: "memorize"
args: {
  "key": "itinerary_datetime",
  "value": "2025-06-15 04:00:00"
}
```


**\[in_trip_agent\]:**
```json
Response from: "memorize"
response: {
  "status": "Stored \"itinerary_datetime\": \"2025-06-15 04:00:00\""
}
```


**\[in_trip_agent\]:** OK. I have memorized the date '2025-06-15 04:00:00' and stored it in the variable 'itinerary_datetime'.


**\[user\]:** call day_of to help with transport


**\[in_trip_agent\]:**
```json
function call: "day_of_agent"
args: {
  "request": "help"
}
```


**\[in_trip_agent\]:**
```json
Response from: "day_of_agent"
response: {
  "result": "Okay, I can help you with your travel logistics from 6420 Sequence Dr #400, San Diego, CA 92121, United States to SAN Airport, aiming to arrive by 6:30 AM.\n\nGiven the current time is 4:00 AM, here's a plan to get you to the airport on time:\n\n**Option 1: Ride Sharing (Uber/Lyft)**\n\n*   **Departure Time:** I recommend leaving around 5:30 AM. This gives you a buffer for traffic and potential delays.\n*   **Travel Time:** Ride sharing services typically take about 15-25 minutes to get to SAN from your location, depending on traffic.\n*   **Airport Buffer:** Arriving by 6:00 AM gives you 30 minutes to spare before your target arrival time of 6:30 AM. This allows plenty of time for security, check-in, and any unexpected delays.\n*   **Pick-up:** I can help you order an Uber. To do that, I need to know the exact pick up location.\n\nLet me know if you'd like me to help you order an Uber.\n"
}
```


**\[in_trip_agent\]:** OK. I have called the `day_of_agent` to help you with transport. It recommends leaving around 5:30 AM to get to the airport by 6:30 AM using a ride-sharing service. It also offered to help you order an Uber. Do you want me to help you order an Uber? If so, please provide the exact pickup location.


**\[user\]:** memorize the date '2025-06-16 15:00:00' and store it in the variable 'itinerary_datetime'

**\[in_trip_agent\]:**
```json
function call: "memorize"
args: {
  "value": "2025-06-16 15:00:00",
  "key": "itinerary_datetime"
}
```


**\[in_trip_agent\]:**
```json
Response from: "memorize"
response: {
  "status": "Stored \"itinerary_datetime\": \"2025-06-16 15:00:00\""
}
```


**\[in_trip_agent\]:** Okay, I have memorized the date '2025-06-16 15:00:00' and stored it in the variable 'itinerary_datetime'.


**\[user\]:** call day_of to help with transport

**\[in_trip_agent\]:**
```json
function call: "day_of_agent"
args: {
  "request": "help"
}
```


**\[in_trip_agent\]:**
```json
Response from: "day_of_agent"
response: {
  "result": "Okay, I can help you get from the Space Needle to dinner in Capitol Hill by 7 PM.\n\nTo make sure you arrive on time, I recommend leaving the Space Needle by 4:30 PM. This will give you plenty of time to account for traffic and find parking in Capitol Hill.\n\nHere are a few transportation options:\n\n*   **Ride-sharing (Uber/Lyft):** This is likely the most convenient option. I can help you order an Uber and find a good pickup spot near the Space Needle. I can check the ETA.\n\nLet me know if you'd like me to help you with ordering an Uber.\n"
}
```


**\[in_trip_agent\]:** OK. I have contacted the day_of_agent. It suggests leaving the Space Needle by 4:30 PM to make your 7 PM dinner in Capitol Hill. It also suggests using a ride-sharing service like Uber or Lyft. Would you like me to help you order an Uber and find a good pickup spot near the Space Needle?


**\[user\]:** transfer to post_trip

**\[in_trip_agent\]:**
```json
function call: "transfer_to_agent"
args: {
  "agent_name": "post_trip_agent"
}
```


**\[in_trip_agent\]:**
```json
Response from: "transfer_to_agent"
response: {}
```


**\[post_trip_agent\]:** Hello! Now that your trip to Seattle is complete, I'd love to hear about your experience. Your feedback is valuable and will help me tailor future travel plans to your preferences.

To start, what did you like most about the trip? Were there any specific experiences or aspects that were particularly memorable?

On the other hand, what could have been even better? Is there anything you would change about the itinerary or any aspect of the trip?

Would you recommend any of the businesses you encountered, such as Ivar's Acres of Clams or the Capitol Hill Neighborhood?

Your answers will help me understand your food dietary preferences, travel destination preferences, activities preferences, and any business reviews or recommendations you may have.

Thank you for your time and feedback! This will be incorporated into your preferences for next time!


======================================================================
FILE: ./tests/__init__.py
======================================================================

# Copyright 2025 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

======================================================================
FILE: ./README.md
======================================================================

# Travel Concierge

This sample demonstrates the use of Agent Development Kit to deliver a new user experience for Travelers. A cohort of agents mimics the notion of having a personal travel concierge, taking care of a traveler's needs: from trip conception, planning and booking, to preparing for the trip, getting help to get from point A to B during the trip, while simultaneously acting as an informative guide.

This example includes illustrations with ADK supported tools such as Google Places API, Google Search Grounding and MCP.

## Overview

A traveler's experience can be divided into two stages: pre-booking and post-booking. In this example, each stage involves the use of multiple specialized agents working together to provide the concierge experience.

During the pre-booking stage, different agents are constructed to help the traveler with vacation inspirations, activities planning, finding flights and hotels, and helps with booking payment processing. The pre-booking stage ends with an itinerary for a trip.

In the post-booking stage, given a concrete itinerary, a different set of agents support the traveler's needs before, during and after the trip. For example, the pre-trip agent checks for visa and medical requirements, travel advisory, and storm status. The in-trip agent monitors for any changes to bookings, with a day-of agent that helps the traveler getting from A to B during the trip. The post-trip agent helps collect feedback and identify additional preferences for future travel plans.


## Agent Details
The key features of the Travel Concierge include:

| Feature | Description |
| --- | --- |
| **Interaction Type:** | Conversational |
| **Complexity:**  | Advanced |
| **Agent Type:**  | Multi Agent |
| **Components:**  | Tools, AgentTools, Memory |
| **Vertical:**  | Travel |

See section [MCP](#mcp) for an example using Airbnb's MCP search tool.

### Agent Architecture
Travel Concierge Agents Architecture

<img src="travel-concierge-arch.png" alt="Travel Concierge's Multi-Agent Architecture" width="800"/>

### Component Details

Expand on the "Key Components" from above.
*   **Agents:**
    * `inspiration_agent` - Interacts with the user to make suggestions on destinations and activities, inspire the user to choose one.
    * `planning_agent` - Given a destination, start date, and duration, the planning agent helps the user select flights, seats and a hotel (mocked), then generate an itinerary containing the activities.
    * `booking_agent` - Given an itinerary, the booking agent will help process those items in the itinerary that requires payment.
    * `pre_trip_agent` - Intended to be invoked regularly before the trip starts; This agent fetches relevant trip information given its origin, destination, and the user's nationality.
    * `in_trip_agent`- Intended to be invoked frequently during the trip. This agent provide three services: monitor any changes in bookings (mocked), acts as an informative guide, and provides transit assistance.
    * `post_trip_agent` - In this example, the post trip agent asks the traveler about their experience and attempts to extract and store their various preferences based on the trip, so that the information could be useful in future interactions.
*   **Tools:**
    * `map_tool` - retrieves lat/long; geocoding an address with the Google Map API.
    * `memorize` - a function to memorize information from the dialog that are important to trip planning and to provide in-trip support.
*   **AgentTools:**  
    * `google_search_grounding` - used in the example for pre-trip information gather such as visa, medical, travel advisory...etc.
    * `what_to_pack` - suggests what to pack for the trip given the origin and destination.
    * `place_agent` - this recommends destinations.
    * `poi_agent` - this suggests activities given a destination.
    * `itinerary_agent` - called by the `planning_agent` to fully construct and represent an itinerary in JSON following a pydantic schema.
    * `day_of_agent` - called by the `in_trip_agent` to provide in_trip on the day and in the moment transit information, getting from A to B. Implemented using dynamic instructions.
    * `flight_search_agent` -  mocked flight search given origin, destination, outbound and return dates.
    * `flight_seat_selection_agent` -  mocked seat selection, some seats are not available.
    * `hotel_search_agent` - mocked hotel selection given destination, outbound and return dates.
    * `hotel_room_selection_agent` - mocked hotel room selection.
    * `confirm_reservation_agent` - mocked reservation.
    * `payment_choice` - mocked payment selection, Apple Pay will not succeed, Google Pay and Credit Card will.
    * `payment_agent` - mocked payment processing.
*   **Memory:** 
    * All agents and tools in this example use the Agent Development Kit's internal session state as memory.
    * The session state is used to store information such as the itinerary, and temporary AgentTools' responses.
    * There are a number of premade itineraries that can be loaded for test runs. See 'Running the Agent' below on how to run them.

## Setup and Installation

### Folder Structure
```
.
├── README.md
├── travel-concierge-arch.png
├── pyproject.toml
├── travel_concierge/
│   ├── shared_libraries/
│   ├── tools/
│   └── sub_agents/
│       ├── inspiration/
│       ├── planning/
│       ├── booking/
│       ├── pre_trip/
│       ├── in_trip/
│       └── post_trip/
├── tests/
│   └── unit/
├── eval/
│   └── data/
└── deployment/
```

### Prerequisites

- Python 3.10+
- Google Cloud Project (for Vertex AI integration)
- API Key for [Google Maps Platform Places API](https://developers.google.com/maps/documentation/places/web-service/get-api-key)
- Google Agent Development Kit 1.0+
- uv: Install uv by following the instructions on the official uv [website](https://docs.astral.sh/uv/)
  ```bash
  curl -LsSf https://astral.sh/uv/install.sh | sh
  ```

### Installation

1.  Clone the repository:

    ```bash
    git clone https://github.com/google/adk-samples.git
    cd adk-samples/python/agents/travel-concierge
    ```
    NOTE: From here on, all command-line instructions shall be executed under the directory  `travel-concierge/` unless otherwise stated.

2.  Install dependencies:

    ```bash
    uv sync
    ```

3.  Set up Google Cloud credentials:

    Otherwise:
    - At the top directory `travel-concierge/`, make a `.env` by copying `.env.example`
    - Set the following environment variables.
    - To use Vertex, make sure you have the Vertex AI API enabled in your project.
    ```
    # Choose Model Backend: 0 -> ML Dev, 1 -> Vertex
    GOOGLE_GENAI_USE_VERTEXAI=1
    # ML Dev backend config, when GOOGLE_GENAI_USE_VERTEXAI=0, ignore if using Vertex.
    # GOOGLE_API_KEY=YOUR_VALUE_HERE

    # Vertex backend config
    GOOGLE_CLOUD_PROJECT=__YOUR_CLOUD_PROJECT_ID__
    GOOGLE_CLOUD_LOCATION=us-central1

    # Places API
    GOOGLE_PLACES_API_KEY=__YOUR_API_KEY_HERE__

    # GCS Storage Bucket name - for Agent Engine deployment test
    GOOGLE_CLOUD_STORAGE_BUCKET=YOUR_BUCKET_NAME_HERE

    # Sample Scenario Path - Default is an empty itinerary
    # This will be loaded upon first user interaction.
    #
    # Uncomment one of the two, or create your own.
    #
    # TRAVEL_CONCIERGE_SCENARIO=travel_concierge/profiles/itinerary_seattle_example.json
    TRAVEL_CONCIERGE_SCENARIO=travel_concierge/profiles/itinerary_empty_default.json
    ```

4. Authenticate your GCloud account.
    ```bash
    gcloud auth application-default login
    ```

5. Activate the virtual environment set up by Poetry, run:
    ```bash
    eval $(poetry env activate)
    (travel-concierge-py3.12) $ # Virtualenv entered
    ```
    Repeat this command whenever you have a new shell, before running the commands in this README.

## Running the Agent

### Using `adk`

ADK provides convenient ways to bring up agents locally and interact with them.
You may talk to the agent using the CLI:

```bash
# Under the travel-concierge directory:
adk run travel_concierge
```

or via its web interface:
```bash
# Under the travel-concierge directory:
adk web
```

This will start a local web server on your machine. You may open the URL, select "travel_concierge" in the top-left drop-down menu, and
a chatbot interface will appear on the right. 

The conversation is initially blank. For an outline on the concierge interaction, see the section [Sample Agent interaction](#sample-agent-interaction) 

Here is something to try: 
* "Need some destination ideas for the Americas"
* After interacting with the agents for a while, you may ask: "Go ahead to planning".


### Programmatic Access

Below is an example of interacting with the agent as a server using Python. 
Try it under the travel-concierge directory:

First, establish a quick development API server for the travel_concierge package.
```bash
adk api_server travel_concierge
```
This will start a fastapi server at http://127.0.0.1:8000.
You can access its API docs at http://127.0.0.1:8000/docs

Here is an example client that only call the server for two turns:
```bash
python tests/programmatic_example.py
```

You may notice that there are code to handle function responses. We will revisit this in the [GUI](#gui) section below.


### Sample Agent interaction

Two example sessions are provided to illustrate how the Travel Concierge operates.
- Trip planning from inspiration to finalized bookings for a trip to Peru ([`tests/pre_booking_sample.md`](tests/pre_booking_sample.md)).
- In-trip experience for a short get away to Seattle, simulating the passage of time using a tool ([`tests/post_booking_sample.md`](tests/post_booking_sample.md)).

### Worth Trying

Instead of interacting with the concierge one turn at time. Try giving it the entire instruction, including decision making criteria, and watch it work, e.g. 

  *"Find flights to London from JFK on April 20th for 4 days. Pick any flights and any seats; also Any hotels and room type. Make sure you pick seats for both flights. Go ahead and act on my behalf without my input, until you have selected everything, confirm with me before generating an itinerary."*

Without specifically optimizing for such usage, this cohort of agents seem to be able to operate by themselves on your behalf with very little input.


## Running Tests

To run the illustrative tests and evaluations, install the extra dependencies and run `pytest`:

```bash
uv sync --dev
uv run pytest
```

The different tests can also be run separately:

To run the unit tests, just checking all agents and tools responds:
```bash
uv run pytest tests
```

To run agent trajectory tests:
```bash
uv run pytest eval
```

## Deploying the Agent

To deploy the agent to Vertex AI Agent Engine, run the following command under `travel-concierge`:

```bash
uv sync --group deployment
uv run python deployment/deploy.py --create
```
When this command returns, if it succeeds it will print an AgentEngine resource
id that looks something like this:
```
projects/************/locations/us-central1/reasoningEngines/7737333693403889664
```

To quickly test that the agent has successfully deployed,
run the following command for one turn with the agent "Looking for inspirations around the Americas":
```bash
uv run python deployment/deploy.py --quicktest --resource_id=<RESOURCE_ID>
```
This will return a stream of JSON payload indicating the deployed agent is functional.

To delete the agent, run the following command (using the resource ID returned previously):
```bash
uv run python deployment/deploy.py --delete --resource_id=<RESOURCE_ID>
```

### Alternative: Using Agent Starter Pack

You can also use the [Agent Starter Pack](https://goo.gle/agent-starter-pack) to create a production-ready version of this agent with additional deployment options:

```bash
# Create and activate a virtual environment
python -m venv .venv && source .venv/bin/activate # On Windows: .venv\Scripts\activate

# Install the starter pack and create your project
pip install --upgrade agent-starter-pack
agent-starter-pack create my-travel-concierge -a adk@travel-concierge
```

<details>
<summary>⚡️ Alternative: Using uv</summary>

If you have [`uv`](https://github.com/astral-sh/uv) installed, you can create and set up your project with a single command:
```bash
uvx agent-starter-pack create my-travel-concierge -a adk@travel-concierge
```
This command handles creating the project without needing to pre-install the package into a virtual environment.

</details>

The starter pack will prompt you to select deployment options and provides additional production-ready features including automated CI/CD deployment scripts.

## Application Development

### Callbacks and initial State

The `root_agent` in this demo currently has a `before_agent_callback` registered to load an initial state, such as user preferences and itinerary, from a file into the session state for interaction. The primary reason for this is to reduce the amount of set up necessary, and this makes it easy to use the ADK UIs.

In a realistic application scenario, initial states can be included when a new `Session` is being created, there by satisfying use cases where user preferences and other pieces of information are most likely loaded from external databases.
 
### Memory vs States

In this example, we are using the session states as memory for the concierge, to store the itinerary, and intermediate agent / tools / user preference responses. In a realistic application scenario, the source for user profiles should be an external database, and the 
reciprocal writes to session states from tools should in addition be persisted, as a write-through, to external databases dedicated for user profiles and itineraries. 

### MCP

An example using Airbnb's MCP server is included. ADK supports MCP and provides several MCP tools.
This example attaches the Airbnb search and listing MCP tools to the `planning_agent`, and ask the concierge to simply find an airbnb given certain dates. The concierge will transfer the request to the planning agent which in turn will call the Airbnb search MCP tool.

To try the example, first set up nodejs and npx from Node.js [website](https://nodejs.org/en/download)

Making sure:
```
$ which node
/Users/USERNAME/.nvm/versions/node/v22.14.0/bin/node

$ which npx
/Users/USERNAME/.nvm/versions/node/v22.14.0/bin/npx
```

Then, under the `travel-concierge/` directory, run the test with:
```
python -m tests.mcp_abnb
```

You will see outputs on the console similar to the following:
```
[user]: Find me an airbnb in San Diego, April 9th, to april 13th, no flights nor itinerary needed. No need to confirm, simply return 5 choicess, remember to include urls.

( Setting up the agent and the tool ) 

Server started with options: ignore-robots-txt
Airbnb MCP Server running on stdio

Inserting Airbnb MCP tools into Travel-Concierge...
...
FOUND planning_agent

( Execute: Runner.run_async() ) 

[root_agent]: transfer_to_agent( {"agent_name": "planning_agent"} )
...
[planning_agent]: airbnb_search( {"checkout": "2025-04-13", "location": "San Diego", "checkin": "2025-04-09"} )

[planning_agent]: airbnb_search responds -> {
  "searchUrl": "https://www.airbnb.com/s/San%20Diego/homes?checkin=2025-04-09&checkout=2025-04-13&adults=1&children=0&infants=0&pets=0",
  "searchResults": [
    {
      "url": "https://www.airbnb.com/rooms/24669593",
      "listing": {
        "id": "24669593",
        "title": "Room in San Diego",
        "coordinate": {
          "latitude": 32.82952,
          "longitude": -117.22201
        },
        "structuredContent": {
          "mapCategoryInfo": "Stay with Stacy, Hosting for 7 years"
        }
      },
      "avgRatingA11yLabel": "4.91 out of 5 average rating,  211 reviews",
      "listingParamOverrides": {
        "categoryTag": "Tag:8678",
        "photoId": "1626723618",
        "amenities": ""
      },
      "structuredDisplayPrice": {
        "primaryLine": {
          "accessibilityLabel": "$9,274 TWD for 4 nights"
        },
        "explanationData": {
          "title": "Price details",
          "priceDetails": "$2,319 TWD x 4 nights: $9,274 TWD"
        }
      }
    },
    ...
    ...
  ]
}

[planning_agent]: Here are 5 Airbnb options in San Diego for your trip from April 9th to April 13th, including the URLs:

1.  Room in San Diego: [https://www.airbnb.com/rooms/24669593](https://www.airbnb.com/rooms/24669593)
2.  Room in San Diego: [https://www.airbnb.com/rooms/5360158](https://www.airbnb.com/rooms/5360158)
3.  Room in San Diego: [https://www.airbnb.com/rooms/1374944285472373029](https://www.airbnb.com/rooms/1374944285472373029)
4.  Apartment in San Diego: [https://www.airbnb.com/rooms/808814447273523115](https://www.airbnb.com/rooms/808814447273523115)
5.  Room in San Diego: [https://www.airbnb.com/rooms/53010806](https://www.airbnb.com/rooms/53010806)
```

### GUI

A typical end-user will be interacting with agents via GUIs instead of pure text. The front-end concierge application will likely render several kinds of agent responses graphically and/or with rich media, for example:
- Destination ideas as a carousel of cards,
- Points of interest / Directions on a Map,
- Expandable videos, images, link outs.
- Selection of flights and hotels as lists with logos, 
- Selection of flight seats on a seating chart,
- Clickable templated responses.

Many of these can be achieved via ADK's Events. This is because:
- All function calls and function responses are reported as events by the session runner.
- In this travel-concierge example, several sub-agents and tools use an explicit pydantic schema and controlled generation to generate a JSON response. These agents are: place agent (for destinations), poi agent (for pois and activities), flights and hotels selection agents, seats and rooms selection agents, and itinerary.
- When a session runner service is wrapped as a server endpoint, the series of events carrying these JSON payloads can be streamed over to the application.
- When the application recognizes the payload schema by their source agent, it can therefore render the payload accordingly.

To see how to work with events, agents and tools responses, open the file [`tests/programmatic_example.py`](tests/programmatic_example.py).

Run the test client code with:
```
python tests/programmatic_example.py 
```

You will get outputs similar to this below:
```
[user]: "Inspire me about Maldives"

...

[root_agent]: transfer_to_agent( {"agent_name": "inspiration_agent"} )

...

[inspiration_agent]: place_agent responds -> {
  "id": "af-be786618-b60b-45ee-a801-c40fd6811e60",
  "name": "place_agent",
  "response": {
    "places": [
      {
        "name": "Malé",
        "country": "Maldives",
        "image": "https://upload.wikimedia.org/wikipedia/commons/thumb/1/1c/Male%2C_Maldives_panorama_2016.jpg/1280px-Male%2C_Maldives_panorama_2016.jpg",
        "highlights": "The vibrant capital city, offering bustling markets, historic mosques, and a glimpse into local Maldivian life.",
        "rating": "4.2"
      },
      {
        "name": "Baa Atoll",
        "country": "Maldives",
        "image": "https://upload.wikimedia.org/wikipedia/commons/thumb/9/95/Baa_Atoll_Maldives.jpg/1280px-Baa_Atoll_Maldives.jpg",
        "highlights": "A UNESCO Biosphere Reserve, famed for its rich marine biodiversity, including manta rays and whale sharks, perfect for snorkeling and diving.",
        "rating": "4.8"
      },
      {
        "name": "Addu Atoll",
        "country": "Maldives",
        "image": "https://upload.wikimedia.org/wikipedia/commons/thumb/c/c3/Addu_Atoll_Maldives.jpg/1280px-Addu_Atoll_Maldives.jpg",
        "highlights": "The southernmost atoll, known for its unique equatorial vegetation, historic WWII sites, and excellent diving spots with diverse coral formations.",
        "rating": "4.5"
      }
    ]
  }
}

[app]: To render a carousel of destinations

[inspiration_agent]: Maldives is an amazing destination! I see three great options:

1.  **Malé:** The capital city, where you can experience local life, markets, and mosques.
2.  **Baa Atoll:** A UNESCO Biosphere Reserve, perfect for snorkeling and diving, with manta rays and whale sharks.
3.  **Addu Atoll:** The southernmost atoll, offering unique vegetation, WWII history, and diverse coral for diving.

Are any of these destinations sound interesting? I can provide you with some activities you can do in the destination you selected.

[user]: "Suggest some acitivities around Baa Atoll"

...

```

In an environment where the events are passed from the server running the agents to an application front-end, the application can use the method in this example to parse and identify which payload is being sent and choose the most appropriate payload renderer / handler.

## Customization

The following are some ideas how one can reuse the concierge and make it your own.

### Load a premade itinerary to demo the in-trip flow
- By default, a user profile and an empty itinerary is loaded from `travel_concierge/profiles/itinerary_empty_default.json`.
- To specify a different file to load, such as the Seattle example `travel_concierge/profiles/itinerary_seattle_example.json`:
  - Set the environmental variable `TRAVEL_CONCIERGE_SCENARIO` to `travel_concierge/profiles/itinerary_seattle_example.json` in the `.env`.
  - Then restart `adk web` and load the travel concierge.
- When you start interacting with the agent, the state will be loaded. 
- You can see the loaded user profile and itinerary when you select "State" in the GUI.


### Make your own premade itinerary for demos

- The Itinerary schema is defined in types.py
- Make a copy of `itinerary_seattle_example.json` and make your own `itinerary` following the schema.
- Use the above steps to load and test your new itinerary.
- For the `user_profile` dict:
  - `passport_nationality` and `home` are mandatory fields, modify only the `address` and `local_prefer_mode`.
  - You can modify / add additional profile fields to the 


### Integration with external APIs

There are many opportunities for enhancements, customizations and integration in this example:
- Connecting to real flights / seats selection systems
- Connecting to real hotels / rooms selection systems
- Usage of external memory persistence services, or databases, instead of the session's state
- Use of the Google Maps [Route API](https://developers.google.com/maps/documentation/routes) in `day_of` agent.
- Connect to external APIs for visa / medical / travel advisory and NOAA storm information instead of using Google Search Grounding.


### Refining Agents

The following are just the starting ideas:
- A more sophisticated itinerary and activity planning agent; For example, currently the agent does not handle flights with lay-over.
- Better accounting - accuracy in calculating costs on flights, hotels + others.
- A booking agent that is less mundane and more efficient
- For the pre-trip and in-trip agents, there are opportunities to dynamically adjusts the itinerary and resolves trip exceptions

## Troubleshoot

The following occasionally happens while interaction with the agent:
- "Malformed" function call or response, or pydantic errors - when this happens simply tell the agent to "try again". 
- If the agents tries to call a tool that doesn't exist, tell the agent that it is the "wrong tool, try again", the agent  is often able to self correct. 
- Similarly, if you have waited for a while and the agent has stopped in the middle of executing a series of actions, ask the agent "what's next" to nudge it forward.

These happens occasionally, it is likely due to variations in JSON responses that requires more rigorous experimentation on prompts and generation parameters to attain more stable results. Within an application, these retries can also be built into the application as part of exception handling.


## Disclaimer

This agent sample is provided for illustrative purposes only and is not intended for production use. It serves as a basic example of an agent and a foundational starting point for individuals or teams to develop their own agents.

This sample has not been rigorously tested, may contain bugs or limitations, and does not include features or optimizations typically required for a production environment (e.g., robust error handling, security measures, scalability, performance considerations, comprehensive logging, or advanced configuration options).

Users are solely responsible for any further development, testing, security hardening, and deployment of agents based on this sample. We recommend thorough review, testing, and the implementation of appropriate safeguards before using any derived agent in a live or critical system.
======================================================================
FILE: ./dev_tools/local_dev.txt
======================================================================

Verify Python Version: python --version
Create Virtual Environment: python3 -m venv venv
Activate Virtual Environment: source venv/bin/activate
Deactivate Venv: deactivate
Initialize gCloud: gcloud init
Install Flask: pip install Flask
Run a python app: python app.py
Make a scrip executable: chmod +x "your script name.sh"

CP a file from one Bucket to Another: 
- All Files: gcloud storage cp gs://cnbc-transcription/input/*.mp4 gs://cnbc-segment-search-video-uploads
- A Single File: gcloud storage cp "gs://stars_temp/Stars.csv" gs://qwiklabs-gcp-00-a296066dea31-star

======================================================================
FILE: ./dev_tools/export.sh
======================================================================

#!/bin/bash
set -e

# --- Configuration ---
cd "$(dirname "$0")/.."

PROJECT_ROOT=$(pwd)
OUTPUT_FILE="${PROJECT_ROOT}/project_export.txt"

# --- Initial Setup ---
echo "--- Project Export ---" > "$OUTPUT_FILE"
echo "Generated: $(date)" >> "$OUTPUT_FILE"

# --- GCP IAM Export ---
echo "Attempting to export GCP IAM policy..."
PROJECT_ID=$(gcloud config get-value project 2>/dev/null)

if [ -z "$PROJECT_ID" ]; then
    echo "WARNING: GCP Project ID not found. Skipping IAM export."
    echo "         (To fix, run 'gcloud auth login' and 'gcloud config set project YOUR_PROJECT_ID')"
else
    echo "Exporting IAM policy for project: ${PROJECT_ID}"
    
    echo "" >> "$OUTPUT_FILE"
    echo "======================================================================" >> "$OUTPUT_FILE"
    echo "GCP IAM POLICY (Principals & Roles) | Project: ${PROJECT_ID}" >> "$OUTPUT_FILE"
    echo "======================================================================" >> "$OUTPUT_FILE"
    echo "" >> "$OUTPUT_FILE"

    gcloud projects get-iam-policy "${PROJECT_ID}" --format="yaml" >> "$OUTPUT_FILE"
fi

# --- Project Code Export ---
echo "Exporting project code structure to ${OUTPUT_FILE}..."

find . \( \
    -name ".git" -o \
    -name ".venv" -o \
    -name "venv" -o \
    -name ".vscode" -o \
    -name ".idea" -o \
    -name "__pycache__" -o \
    -path "./web-app/node_modules" -o \
    -path "./web-app/build" \
\) -prune -o \
-type f \
-not -name "*.png" \
-not -name "*.jpg" \
-not -name "*.jpeg" \
-not -name "*.ico" \
-not -name "*.pyc" \
-not -name ".DS_Store" \
-not -name "uv.lock" \
-not -name "poetry.lock" \
-not -name "package-lock.json" \
-not -name "project_export.txt" \
-print | while read -r filepath; do
    echo "Appending code file: ${filepath}"
    
    echo "" >> "$OUTPUT_FILE"
    echo "======================================================================" >> "$OUTPUT_FILE"
    echo "FILE: ${filepath}" >> "$OUTPUT_FILE"
    echo "======================================================================" >> "$OUTPUT_FILE"
    echo "" >> "$OUTPUT_FILE"
    cat "${filepath}" >> "$OUTPUT_FILE"
done
======================================================================
FILE: ./deployment/deploy.py
======================================================================

# Copyright 2025 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

"""Deployment script for Travel Concierge."""

import asyncio
import os

from absl import app, flags
from dotenv import load_dotenv

from travel_concierge.agent import root_agent

from google.adk.sessions import VertexAiSessionService

import vertexai
from vertexai import agent_engines
from vertexai.preview.reasoning_engines import AdkApp

FLAGS = flags.FLAGS
flags.DEFINE_string("project_id", None, "GCP project ID.")
flags.DEFINE_string("location", None, "GCP location.")
flags.DEFINE_string("bucket", None, "GCP bucket.")

flags.DEFINE_string(
    "initial_states_path",
    None,
    "Relative path to the initial state file, .e.g eval/itinerary_empty_default.json",
)
flags.DEFINE_string("map_key", None, "API Key for Google Places API")

flags.DEFINE_string("resource_id", None, "ReasoningEngine resource ID.")
flags.DEFINE_bool("create", False, "Creates a new deployment.")
flags.DEFINE_bool("quicktest", False, "Try a new deployment with one turn.")
flags.DEFINE_bool("delete", False, "Deletes an existing deployment.")
flags.mark_bool_flags_as_mutual_exclusive(["create", "delete", "quicktest"])


def create(env_vars: dict[str, str]) -> None:
    """Creates a new deployment."""
    print(env_vars)
    app = AdkApp(
        agent=root_agent,
        enable_tracing=True,
        env_vars=env_vars,
    )

    remote_agent = agent_engines.create(  
        app,
        display_name="Travel-Concierge-ADK",
        description="An Example AgentEngine Deployment",                    
        requirements=[
            "google-adk (>=1.16.0)",
            "google-cloud-aiplatform[agent_engines] (>=1.93.1)",
            "google-genai (>=1.16.1)",
            "pydantic (>=2.10.6,<3.0.0)",
            "absl-py (>=2.2.1,<3.0.0)",
            "pydantic (>=2.10.6,<3.0.0)",
            "requests (>=2.32.3,<3.0.0)",
        ],
        extra_packages=[
            "./travel_concierge",  # The main package
        ],
    )
    print(f"Created remote agent: {remote_agent.resource_name}")


def delete(resource_id: str) -> None:
    remote_agent = agent_engines.get(resource_id)
    remote_agent.delete(force=True)
    print(f"Deleted remote agent: {resource_id}")


def send_message(session_service: VertexAiSessionService, resource_id: str, message: str) -> None:
    """Send a message to the deployed agent."""

    session = asyncio.run(session_service.create_session(
            app_name=resource_id,
            user_id="traveler0115"
        )
    )

    remote_agent = agent_engines.get(resource_id)

    print(f"Trying remote agent: {resource_id}")
    for event in remote_agent.stream_query(
        user_id="traveler0115",
        session_id=session.id,
        message=message,
    ):
        print(event)
    print("Done.")


def main(argv: list[str]) -> None:

    load_dotenv()
    env_vars = {}

    project_id = (
        FLAGS.project_id if FLAGS.project_id else os.getenv("GOOGLE_CLOUD_PROJECT")
    )
    location = FLAGS.location if FLAGS.location else os.getenv("GOOGLE_CLOUD_LOCATION")
    bucket = FLAGS.bucket if FLAGS.bucket else os.getenv("GOOGLE_CLOUD_STORAGE_BUCKET")
    # Variables for Travel Concierge from .env
    initial_states_path = (
        FLAGS.initial_states_path
        if FLAGS.initial_states_path
        else os.getenv("TRAVEL_CONCIERGE_SCENARIO")
    )
    env_vars["TRAVEL_CONCIERGE_SCENARIO"] = initial_states_path
    map_key = (
        FLAGS.initial_states_path
        if FLAGS.initial_states_path
        else os.getenv("GOOGLE_PLACES_API_KEY")
    )
    env_vars["GOOGLE_PLACES_API_KEY"] = map_key

    print(f"PROJECT: {project_id}")
    print(f"LOCATION: {location}")
    print(f"BUCKET: {bucket}")
    print(f"INITIAL_STATE: {initial_states_path}")
    print(f"MAP: {map_key[:5]}")

    if not project_id:
        print("Missing required environment variable: GOOGLE_CLOUD_PROJECT")
        return
    elif not location:
        print("Missing required environment variable: GOOGLE_CLOUD_LOCATION")
        return
    elif not bucket:
        print("Missing required environment variable: GOOGLE_CLOUD_STORAGE_BUCKET")
        return
    elif not initial_states_path:
        print("Missing required environment variable: TRAVEL_CONCIERGE_SCENARIO")
        return
    elif not map_key:
        print("Missing required environment variable: GOOGLE_PLACES_API_KEY")
        return

    vertexai.init(
        project=project_id,
        location=location,
        staging_bucket=f"gs://{bucket}",
    )

    if FLAGS.create:
        create(env_vars)
    elif FLAGS.delete:
        if not FLAGS.resource_id:
            print("resource_id is required for delete")
            return
        delete(FLAGS.resource_id)
    elif FLAGS.quicktest:
        if not FLAGS.resource_id:
            print("resource_id is required for quicktest")
            return
        session_service = VertexAiSessionService(project_id, location)
        send_message(session_service, FLAGS.resource_id, "Looking for inspirations around the Americas")
    else:
        print("Unknown command")


if __name__ == "__main__":
    app.run(main)

======================================================================
FILE: ./travel_concierge/tools/memory.py
======================================================================

# Copyright 2025 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

"""The 'memorize' tool for several agents to affect session states."""

from datetime import datetime
import json
import os
from typing import Dict, Any

from google.adk.agents.callback_context import CallbackContext
from google.adk.sessions.state import State
from google.adk.tools import ToolContext

from travel_concierge.shared_libraries import constants

SAMPLE_SCENARIO_PATH = os.getenv(
    "TRAVEL_CONCIERGE_SCENARIO", "travel_concierge/profiles/itinerary_empty_default.json"
)


def memorize_list(key: str, value: str, tool_context: ToolContext):
    """
    Memorize pieces of information.

    Args:
        key: the label indexing the memory to store the value.
        value: the information to be stored.
        tool_context: The ADK tool context.

    Returns:
        A status message.
    """
    mem_dict = tool_context.state
    if key not in mem_dict:
        mem_dict[key] = []
    if value not in mem_dict[key]:
        mem_dict[key].append(value)
    return {"status": f'Stored "{key}": "{value}"'}


def memorize(key: str, value: str, tool_context: ToolContext):
    """
    Memorize pieces of information, one key-value pair at a time.

    Args:
        key: the label indexing the memory to store the value.
        value: the information to be stored.
        tool_context: The ADK tool context.

    Returns:
        A status message.
    """
    mem_dict = tool_context.state
    mem_dict[key] = value
    return {"status": f'Stored "{key}": "{value}"'}


def forget(key: str, value: str, tool_context: ToolContext):
    """
    Forget pieces of information.

    Args:
        key: the label indexing the memory to store the value.
        value: the information to be removed.
        tool_context: The ADK tool context.

    Returns:
        A status message.
    """
    if tool_context.state[key] is None:
        tool_context.state[key] = []
    if value in tool_context.state[key]:
        tool_context.state[key].remove(value)
    return {"status": f'Removed "{key}": "{value}"'}


def _set_initial_states(source: Dict[str, Any], target: State | dict[str, Any]):
    """
    Setting the initial session state given a JSON object of states.

    Args:
        source: A JSON object of states.
        target: The session state object to insert into.
    """
    if constants.SYSTEM_TIME not in target:
        target[constants.SYSTEM_TIME] = str(datetime.now())

    if constants.ITIN_INITIALIZED not in target:
        target[constants.ITIN_INITIALIZED] = True

        target.update(source)

        itinerary = source.get(constants.ITIN_KEY, {})
        if itinerary:
            target[constants.ITIN_START_DATE] = itinerary[constants.START_DATE]
            target[constants.ITIN_END_DATE] = itinerary[constants.END_DATE]
            target[constants.ITIN_DATETIME] = itinerary[constants.START_DATE]


def _load_precreated_itinerary(callback_context: CallbackContext):
    """
    Sets up the initial state.
    Set this as a callback as before_agent_call of the root_agent.
    This gets called before the system instruction is contructed.

    Args:
        callback_context: The callback context.
    """    
    data = {}
    with open(SAMPLE_SCENARIO_PATH, "r") as file:
        data = json.load(file)
        print(f"\nLoading Initial State: {data}\n")

    _set_initial_states(data["state"], callback_context.state)

======================================================================
FILE: ./travel_concierge/tools/places.py
======================================================================

# Copyright 2025 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

"""Wrapper to Google Maps Places API."""

import os
from typing import Dict, List, Any

from google.adk.tools import ToolContext
import requests


class PlacesService:
    """Wrapper to Placees API."""

    def _check_key(self):
        if (
            not hasattr(self, "places_api_key") or not self.places_api_key
        ):  # Either it doesn't exist or is None.
            # https://developers.google.com/maps/documentation/places/web-service/get-api-key
            self.places_api_key = os.getenv("GOOGLE_PLACES_API_KEY")

    def find_place_from_text(self, query: str) -> Dict[str, str]:
        """Fetches place details using a text query."""
        self._check_key()
        places_url = "https://maps.googleapis.com/maps/api/place/findplacefromtext/json"
        params = {
            "input": query,
            "inputtype": "textquery",
            "fields": "place_id,formatted_address,name,photos,geometry",
            "key": self.places_api_key,
        }

        try:
            response = requests.get(places_url, params=params)
            response.raise_for_status()
            place_data = response.json()

            if not place_data.get("candidates"):
                return {"error": "No places found."}

            # Extract data for the first candidate
            place_details = place_data["candidates"][0]
            place_id = place_details["place_id"]
            place_name = place_details["name"]
            place_address = place_details["formatted_address"]
            photos = self.get_photo_urls(place_details.get("photos", []), maxwidth=400)
            map_url = self.get_map_url(place_id)
            location = place_details["geometry"]["location"]
            lat = str(location["lat"])
            lng = str(location["lng"])

            return {
                "place_id": place_id,
                "place_name": place_name,
                "place_address": place_address,
                "photos": photos,
                "map_url": map_url,
                "lat": lat,
                "lng": lng,
            }

        except requests.exceptions.RequestException as e:
            return {"error": f"Error fetching place data: {e}"}

    def get_photo_urls(self, photos: List[Dict[str, Any]], maxwidth: int = 400) -> List[str]:
        """Extracts photo URLs from the 'photos' list."""
        photo_urls = []
        for photo in photos:
            photo_url = f"https://maps.googleapis.com/maps/api/place/photo?maxwidth={maxwidth}&photoreference={photo['photo_reference']}&key={self.places_api_key}"
            photo_urls.append(photo_url)
        return photo_urls

    def get_map_url(self, place_id: str) -> str:
        """Generates the Google Maps URL for a given place ID."""
        return f"https://www.google.com/maps/place/?q=place_id:{place_id}"


# Google Places API
places_service = PlacesService()


def map_tool(key: str, tool_context: ToolContext):
    """
    This is going to inspect the pois stored under the specified key in the state.
    One by one it will retrieve the accurate Lat/Lon from the Map API, if the Map API is available for use.

    Args:
        key: The key under which the POIs are stored.
        tool_context: The ADK tool context.
        
    Returns:
        The updated state with the full JSON object under the key.
    """
    if key not in tool_context.state:
        tool_context.state[key] = {}

    # The pydantic object types.POISuggestions
    if "places" not in tool_context.state[key]:
        tool_context.state[key]["places"] = []

    pois = tool_context.state[key]["places"]
    for poi in pois:  # The pydantic object types.POI
        location = poi["place_name"] + ", " + poi["address"]
        result = places_service.find_place_from_text(location)
        # Fill the place holders with verified information.
        poi["place_id"] = result["place_id"] if "place_id" in result else None
        poi["map_url"] = result["map_url"] if "map_url" in result else None
        if "lat" in result and "lng" in result:
            poi["lat"] = result["lat"]
            poi["long"] = result["lng"]

    return {"places": pois}  # Return the updated pois

======================================================================
FILE: ./travel_concierge/tools/__init__.py
======================================================================

# Copyright 2025 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

======================================================================
FILE: ./travel_concierge/tools/search.py
======================================================================

# Copyright 2025 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

"""Wrapper to Google Search Grounding with custom prompt."""

from google.adk.agents import Agent
from google.adk.tools.agent_tool import AgentTool

from google.adk.tools.google_search_tool import google_search

_search_agent = Agent(
    model="gemini-2.5-flash",
    name="google_search_grounding",
    description="An agent providing Google-search grounding capability",
    instruction=""",
    Answer the user's question directly using google_search grounding tool; Provide a brief but concise response. 
    Rather than a detail response, provide the immediate actionable item for a tourist or traveler, in a single sentence.
    Do not ask the user to check or look up information for themselves, that's your role; do your best to be informative.
    """,
    tools=[google_search],
)

google_search_grounding = AgentTool(agent=_search_agent)

======================================================================
FILE: ./travel_concierge/__init__.py
======================================================================

# Copyright 2025 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

import os

import google.auth

_, project_id = google.auth.default()
os.environ.setdefault("GOOGLE_CLOUD_PROJECT", project_id)
os.environ.setdefault("GOOGLE_CLOUD_LOCATION", "global")
os.environ.setdefault("GOOGLE_GENAI_USE_VERTEXAI", "True")

from . import agent

======================================================================
FILE: ./travel_concierge/shared_libraries/constants.py
======================================================================

# Copyright 2025 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

"""Constants used as keys into ADK's session state."""

SYSTEM_TIME = "_time"
ITIN_INITIALIZED = "_itin_initialized"

ITIN_KEY = "itinerary"
PROF_KEY = "user_profile"

ITIN_START_DATE = "itinerary_start_date"
ITIN_END_DATE = "itinerary_end_date"
ITIN_DATETIME = "itinerary_datetime"

START_DATE = "start_date"
END_DATE = "end_date"

======================================================================
FILE: ./travel_concierge/shared_libraries/__init__.py
======================================================================

# Copyright 2025 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

======================================================================
FILE: ./travel_concierge/shared_libraries/types.py
======================================================================

# Copyright 2025 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

"""Common data schema and types for travel-concierge agents."""

from typing import Optional, Union

from google.genai import types
from pydantic import BaseModel, Field


# Convenient declaration for controlled generation.
json_response_config = types.GenerateContentConfig(
    response_mime_type="application/json"
)


class Room(BaseModel):
    """A room for selection."""
    is_available: bool = Field(
        description="Whether the room type is available for selection."
    )
    price_in_usd: int = Field(description="The cost of the room selection.")
    room_type: str = Field(
        description="Type of room, e.g. Twin with Balcon, King with Ocean View... etc."
    )


class RoomsSelection(BaseModel):
    """A list of rooms for selection."""
    rooms: list[Room]


class Hotel(BaseModel):
    """A hotel from the search."""
    name: str = Field(description="Name of the hotel")
    address: str = Field(description="Full address of the Hotel")
    check_in_time: str = Field(description="Time in HH:MM format, e.g. 16:00")
    check_out_time: str = Field(description="Time in HH:MM format, e.g. 15:30")
    thumbnail: str = Field(description="Hotel logo location")
    price: int = Field(description="Price of the room per night")


class HotelsSelection(BaseModel):
    """A list of hotels from the search."""
    hotels: list[Hotel]


class Seat(BaseModel):
    """A Seat from the search."""
    is_available: bool = Field(
        description="Whether the seat is available for selection."
    )
    price_in_usd: int = Field(description="The cost of the seat selection.")
    seat_number: str = Field(description="Seat number, e.g. 22A, 34F... etc.")


class SeatsSelection(BaseModel):
    """A list of seats from the search."""
    seats: list[list[Seat]]


class AirportEvent(BaseModel):
    """An Airport event."""
    city_name: str = Field(description="Name of the departure city")
    airport_code: str = Field(description="IATA code of the departure airport")
    timestamp: str = Field(description="ISO 8601 departure or arrival date and time")


class Flight(BaseModel):
    """A Flight search result."""
    flight_number: str = Field(
        description="Unique identifier for the flight, like BA123, AA31, etc."
    )
    departure: AirportEvent
    arrival: AirportEvent
    airlines: list[str] = Field(
        description="Airline names, e.g., American Airlines, Emirates"
    )
    airline_logo: str = Field(description="Airline logo location")
    price_in_usd: int = Field(description="Flight price in US dollars")
    number_of_stops: int = Field(description="Number of stops during the flight")


class FlightsSelection(BaseModel):
    """A list of flights from the search."""
    flights: list[Flight]


class Destination(BaseModel):
    """A destination recommendation."""
    name: str = Field(description="A Destination's Name")
    country: str = Field(description="The Destination's Country Name")
    image: str = Field(description="verified URL to an image of the destination")
    highlights: str = Field(description="Short description highlighting key features")
    rating: str = Field(description="Numerical rating (e.g., 4.5)")


class DestinationIdeas(BaseModel):
    """Destinations recommendation."""
    places: list[Destination]


class POI(BaseModel):
    """A Point Of Interest suggested by the agent."""
    place_name: str = Field(description="Name of the attraction")
    address: str = Field(
        description="An address or sufficient information to geocode for a Lat/Lon"
    )
    lat: str = Field(
        description="Numerical representation of Latitude of the location (e.g., 20.6843)"
    )
    long: str = Field(
        description="Numerical representation of Longitude of the location (e.g., -88.5678)"
    )
    review_ratings: str = Field(
        description="Numerical representation of rating (e.g. 4.8 , 3.0 , 1.0 etc)"
    )
    highlights: str = Field(description="Short description highlighting key features")
    image_url: str = Field(description="verified URL to an image of the destination")
    map_url: Optional[str] = Field(description="Verified URL to Google Map")
    place_id: Optional[str] = Field(description="Google Map place_id")


class POISuggestions(BaseModel):
    """Points of interest recommendation."""
    places: list[POI]


class AttractionEvent(BaseModel):
    """An Attraction."""
    event_type: str = Field(default="visit")
    description: str = Field(
        description="A title or description of the activity or the attraction visit"
    )
    address: str = Field(description="Full address of the attraction")
    start_time: str = Field(description="Time in HH:MM format, e.g. 16:00")
    end_time: str = Field(description="Time in HH:MM format, e.g. 16:00")
    booking_required: bool = Field(default=False)
    price: Optional[str] = Field(description="Some events may cost money")


class FlightEvent(BaseModel):
    """A Flight Segment in the itinerary."""
    event_type: str = Field(default="flight")
    description: str = Field(description="A title or description of the Flight")
    booking_required: bool = Field(default=True)
    departure_airport: str = Field(description="Airport code, i.e. SEA")
    arrival_airport: str = Field(description="Airport code, i.e. SAN")
    flight_number: str = Field(description="Flight number, e.g. UA5678")
    boarding_time: str = Field(description="Time in HH:MM format, e.g. 15:30")
    seat_number: str = Field(description="Seat Row and Position, e.g. 32A")
    departure_time: str = Field(description="Time in HH:MM format, e.g. 16:00")
    arrival_time: str = Field(description="Time in HH:MM format, e.g. 20:00")
    price: Optional[str] = Field(description="Total air fare")
    booking_id: Optional[str] = Field(
        description="Booking Reference ID, e.g LMN-012-STU"
    )


class HotelEvent(BaseModel):
    """A Hotel Booking in the itinerary."""
    event_type: str = Field(default="hotel")
    description: str = Field(description="A name, title or a description of the hotel")
    address: str = Field(description="Full address of the attraction")
    check_in_time: str = Field(description="Time in HH:MM format, e.g. 16:00")
    check_out_time: str = Field(description="Time in HH:MM format, e.g. 15:30")
    room_selection: str = Field()
    booking_required: bool = Field(default=True)
    price: Optional[str] = Field(description="Total hotel price including all nights")
    booking_id: Optional[str] = Field(
        description="Booking Reference ID, e.g ABCD12345678"
    )


class ItineraryDay(BaseModel):
    """A single day of events in the itinerary."""
    day_number: int = Field(
        description="Identify which day of the trip this represents, e.g. 1, 2, 3... etc."
    )
    date: str = Field(description="The Date this day YYYY-MM-DD format")
    events: list[Union[FlightEvent, HotelEvent, AttractionEvent]] = Field(
        default=[], description="The list of events for the day"
    )


class Itinerary(BaseModel):
    """A multi-day itinerary."""
    trip_name: str = Field(
        description="Simple one liner to describe the trip. e.g. 'San Diego to Seattle Getaway'"
    )
    start_date: str = Field(description="Trip Start Date in YYYY-MM-DD format")
    end_date: str = Field(description="Trip End Date in YYYY-MM-DD format")
    origin: str = Field(description="Trip Origin, e.g. San Diego")
    destination: str = (Field(description="Trip Destination, e.g. Seattle"),)
    days: list[ItineraryDay] = Field(
        default_factory=list, description="The multi-days itinerary"
    )


class UserProfile(BaseModel):
    """An example user profile."""
    allergies: list[str] = Field(
        default=[], description="A list of food allergies to avoid"
    )
    diet_preference: list[str] = Field(
        default=[], description="Vegetarian, Vegan... etc."
    )
    passport_nationality: str = Field(
        description="Nationality of traveler, e.g. US Citizen"
    )
    home_address: str = Field(description="Home address of traveler")
    home_transit_preference: str = Field(
        description="Preferred mode of transport around home, e.g. drive"
    )


class PackingList(BaseModel):
    """A list of things to pack for the trip."""
    items: list[str]

======================================================================
FILE: ./travel_concierge/.env
======================================================================

# Choose Model Backend: 0 -> ML Dev (Google AI Studio), 1 -> Vertex (Google Cloud)
# Set to 1 to use Vertex AI, which is required for Agent Engine deployment.
GOOGLE_GENAI_USE_VERTEXAI=1

# Vertex backend configuration required for deployment:
# Replace the placeholders with your actual Google Cloud Project ID and Location.
GOOGLE_CLOUD_PROJECT=adk-d2c-travel-concierge
GOOGLE_CLOUD_LOCATION=us-central1

# Places API Key: The travel_concierge agent requires this API key to function.
# Replace the placeholder with your actual Google Places API Key.
GOOGLE_PLACES_API_KEY=AIzaSyCXGC3qSDVt7MgWlp7gqr71DpnPcWCC1HQERE

# GCS Storage Bucket name: Required for staging the agent for Agent Engine deployment.
# Replace the placeholder with the name of a bucket in your GCP project.
GOOGLE_CLOUD_STORAGE_BUCKET=adk-d2c-travel-concierge-artifacts

# Sample Scenario Path: Defines the initial state/itinerary for the agent.
# Uncomment the desired scenario or keep the default. This is loaded on the first user interaction.
# TRAVEL_CONCIERGE_SCENARIO=travel_concierge/profiles/itinerary_seattle_example.json
TRAVEL_CONCIERGE_SCENARIO=travel_concierge/profiles/itinerary_empty_default.json
======================================================================
FILE: ./travel_concierge/agent.py
======================================================================

# Copyright 2025 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

"""Demonstration of Travel AI Conceirge using Agent Development Kit"""

from google.adk.agents import Agent

from travel_concierge import prompt

from travel_concierge.sub_agents.booking.agent import booking_agent
from travel_concierge.sub_agents.in_trip.agent import in_trip_agent
from travel_concierge.sub_agents.inspiration.agent import inspiration_agent
from travel_concierge.sub_agents.planning.agent import planning_agent
from travel_concierge.sub_agents.post_trip.agent import post_trip_agent
from travel_concierge.sub_agents.pre_trip.agent import pre_trip_agent

from travel_concierge.tools.memory import _load_precreated_itinerary


root_agent = Agent(
    model="gemini-2.5-flash",
    name="root_agent",
    description="A Travel Conceirge using the services of multiple sub-agents",
    instruction=prompt.ROOT_AGENT_INSTR,
    sub_agents=[
        inspiration_agent,
        planning_agent,
        booking_agent,
        pre_trip_agent,
        in_trip_agent,
        post_trip_agent,
    ],
    before_agent_callback=_load_precreated_itinerary,
)

======================================================================
FILE: ./travel_concierge/prompt.py
======================================================================

# Copyright 2025 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

"""Defines the prompts in the travel ai agent."""

ROOT_AGENT_INSTR = """
- You are a exclusive travel conceirge agent
- You help users to discover their dream vacation, planning for the vacation, book flights and hotels
- You want to gather a minimal information to help the user
- After every tool call, pretend you're showing the result to the user and keep your response limited to a phrase.
- Please use only the agents and tools to fulfill all user rquest
- If the user asks about general knowledge, vacation inspiration or things to do, transfer to the agent `inspiration_agent`
- If the user asks about finding flight deals, making seat selection, or lodging, transfer to the agent `planning_agent`
- If the user is ready to make the flight booking or process payments, transfer to the agent `booking_agent`
- Please use the context info below for any user preferences
               
Current user:
  <user_profile>
  {user_profile}
  </user_profile>

Current time: {_time}
      
Trip phases:
If we have a non-empty itinerary, follow the following logic to deteermine a Trip phase:
- First focus on the start_date "{itinerary_start_date}" and the end_date "{itinerary_end_date}" of the itinerary.
- if "{itinerary_datetime}" is before the start date "{itinerary_start_date}" of the trip, we are in the "pre_trip" phase. 
- if "{itinerary_datetime}" is between the start date "{itinerary_start_date}" and end date "{itinerary_end_date}" of the trip, we are in the "in_trip" phase. 
- When we are in the "in_trip" phase, the "{itinerary_datetime}" dictates if we have "day_of" matters to handle.
- if "{itinerary_datetime}" is after the end date of the trip, we are in the "post_trip" phase. 

<itinerary>
{itinerary}
</itinerary>

Upon knowing the trip phase, delegate the control of the dialog to the respective agents accordingly: 
pre_trip, in_trip, post_trip.
"""

======================================================================
FILE: ./travel_concierge/sub_agents/booking/__init__.py
======================================================================

# Copyright 2025 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

======================================================================
FILE: ./travel_concierge/sub_agents/booking/agent.py
======================================================================

# Copyright 2025 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

"""Booking agent and sub-agents, handling the confirmation and payment of bookable events."""

from google.adk.agents import Agent
from google.adk.tools.agent_tool import AgentTool
from google.genai.types import GenerateContentConfig

from travel_concierge.sub_agents.booking import prompt


create_reservation = Agent(
    model="gemini-2.5-flash",
    name="create_reservation",
    description="""Create a reservation for the selected item.""",
    instruction=prompt.CONFIRM_RESERVATION_INSTR,
)


payment_choice = Agent(
    model="gemini-2.5-flash",
    name="payment_choice",
    description="""Show the users available payment choices.""",
    instruction=prompt.PAYMENT_CHOICE_INSTR,
)

process_payment = Agent(
    model="gemini-2.5-flash",
    name="process_payment",
    description="""Given a selected payment choice, processes the payment, completing the transaction.""",
    instruction=prompt.PROCESS_PAYMENT_INSTR,
)


booking_agent = Agent(
    model="gemini-2.5-flash",
    name="booking_agent",
    description="Given an itinerary, complete the bookings of items by handling payment choices and processing.",
    instruction=prompt.BOOKING_AGENT_INSTR,
    tools=[
        AgentTool(agent=create_reservation),
        AgentTool(agent=payment_choice),
        AgentTool(agent=process_payment),
    ],
    generate_content_config=GenerateContentConfig(
        temperature=0.0, top_p=0.5
    )
)

======================================================================
FILE: ./travel_concierge/sub_agents/booking/prompt.py
======================================================================

# Copyright 2025 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

"""Prompt for the booking agent and sub-agents."""

BOOKING_AGENT_INSTR = """
- You are the booking agent who helps users with completing the bookings for flight, hotel, and any other events or activities that requires booking.

- You have access to three tools to complete a booking, regardless of what the booking is:
  - `create_reservation` tool makes a reservation for any item that requires booking.
  - `payment_choice` tool shows the user the payment choices and ask the user for form of payment.
  - `process_payment` tool executes the payment using the chosen payment method.

- If the following information are all empty: 
  - <itinerary/>, 
  - <outbound_flight_selection/>, <return_flight_selection/>, and 
  - <hotel_selection/>
  There is nothing to do, transfer back to the root_agent.
- Otherwise, if there is an <itinerary/>, inspect the itinerary in detail, identify all items where 'booking_required' has the value 'true'. 
- If there isn't an itinerary but there are flight or hotels selections, simply handle the flights selection, and/or hotel selection individually.
- Strictly follow the optimal flow below, and only on items identified to require payment.

Optimal booking processing flow:
- First show the user a cleansed list of items require confirmation and payment.
- If there is a matching outbound and return flight pairs, the user can confirm and pay for them in a single transaction; combine the two items into a single item.
- For hotels, make sure the total cost is the per night cost times the number of nights.
- Wait for the user's acknowledgment before proceeding. 
- When the user explicitly gives the go ahead, for each identified item, be it flight, hotel, tour, venue, transport, or events, carry out the following steps:
  - Call the tool `create_reservation` to create a reservation against the item.
  - Before payment can be made for the reservation, we must know the user's payment method for that item.
  - Call `payment_choice` to present the payment choicess to the user.
  - Ask user to confirm their payment choice. Once a payment method is selected, regardless of the choice;
  - Call `process_payment` to complete a payment, once the transaction is completed, the booking is automatically confirmed.
  - Repeat this list for each item, starting at `create_reservation`.

Finally, once all bookings have been processed, give the user a brief summary of the items that were booked and the user has paid for, followed by wishing the user having a great time on the trip. 

Current time: {_time}

Traveler's itinerary:
  <itinerary>
  {itinerary}
  </itinerary>

Other trip details:
  <origin>{origin}</origin>
  <destination>{destination}</destination>
  <start_date>{start_date}</start_date>
  <end_date>{end_date}</end_date>
  <outbound_flight_selection>{outbound_flight_selection}</outbound_flight_selection>
  <outbound_seat_number>{outbound_seat_number}</outbound_seat_number>
  <return_flight_selection>{return_flight_selection}</return_flight_selection>
  <return_seat_number>{return_seat_number}</return_seat_number>
  <hotel_selection>{hotel_selection}</hotel_selection>
  <room_selection>{room_selection}</room_selection>

Remember that you can only use the tools `create_reservation`, `payment_choice`, `process_payment`.

"""


CONFIRM_RESERVATION_INSTR = """
Under a simulation scenario, you are a travel booking reservation agent and you will be called upon to reserve and confirm a booking.
Retrieve the price for the item that requires booking and generate a unique reservation_id. 

Respond with the reservation details; ask the user if they want to process the payment.

Current time: {_time}
"""


PROCESS_PAYMENT_INSTR = """
- You role is to execute the payment for booked item.
- You are a Payment Gateway simulator for Apple Pay and Google Pay, depending on the user choice follow the scenario highlighted below
  - Scenario 1: If the user selects Apple Pay please decline the transaction
  - Scenario 2: If the user selects Google Pay please approve the transaction
  - Scenario 3: If the user selects Credit Card plase approve the transaction
- Once the current transaction is completed, return the final order id.

Current time: {_time}
"""


PAYMENT_CHOICE_INSTR = """
  Provide the users with three choice 1. Apple Pay 2. Google Pay, 3. Credit Card on file, wait for the users to make the choice. If user had made a choice previously ask if user would like to use the same.
"""

======================================================================
FILE: ./travel_concierge/sub_agents/planning/__init__.py
======================================================================

# Copyright 2025 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

======================================================================
FILE: ./travel_concierge/sub_agents/planning/agent.py
======================================================================

# Copyright 2025 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

"""Planning agent. A pre-booking agent covering the planning part of the trip."""

from google.adk.agents import Agent
from google.adk.tools.agent_tool import AgentTool
from google.genai.types import GenerateContentConfig
from travel_concierge.shared_libraries import types
from travel_concierge.sub_agents.planning import prompt
from travel_concierge.tools.memory import memorize


itinerary_agent = Agent(
    model="gemini-2.5-flash",
    name="itinerary_agent",
    description="Create and persist a structured JSON representation of the itinerary",
    instruction=prompt.ITINERARY_AGENT_INSTR,
    disallow_transfer_to_parent=True,
    disallow_transfer_to_peers=True,
    output_schema=types.Itinerary,
    output_key="itinerary",
    generate_content_config=types.json_response_config,
)


hotel_room_selection_agent = Agent(
    model="gemini-2.5-flash",
    name="hotel_room_selection_agent",
    description="Help users with the room choices for a hotel",
    instruction=prompt.HOTEL_ROOM_SELECTION_INSTR,
    disallow_transfer_to_parent=True,
    disallow_transfer_to_peers=True,
    output_schema=types.RoomsSelection,
    output_key="room",
    generate_content_config=types.json_response_config,
)

hotel_search_agent = Agent(
    model="gemini-2.5-flash",
    name="hotel_search_agent",
    description="Help users find hotel around a specific geographic area",
    instruction=prompt.HOTEL_SEARCH_INSTR,
    disallow_transfer_to_parent=True,
    disallow_transfer_to_peers=True,
    output_schema=types.HotelsSelection,
    output_key="hotel",
    generate_content_config=types.json_response_config,
)


flight_seat_selection_agent = Agent(
    model="gemini-2.5-flash",
    name="flight_seat_selection_agent",
    description="Help users with the seat choices",
    instruction=prompt.FLIGHT_SEAT_SELECTION_INSTR,
    disallow_transfer_to_parent=True,
    disallow_transfer_to_peers=True,
    output_schema=types.SeatsSelection,
    output_key="seat",
    generate_content_config=types.json_response_config,
)

flight_search_agent = Agent(
    model="gemini-2.5-flash",
    name="flight_search_agent",
    description="Help users find best flight deals",
    instruction=prompt.FLIGHT_SEARCH_INSTR,
    disallow_transfer_to_parent=True,
    disallow_transfer_to_peers=True,
    output_schema=types.FlightsSelection,
    output_key="flight",
    generate_content_config=types.json_response_config,
)


planning_agent = Agent(
    model="gemini-2.5-flash",
    description="""Helps users with travel planning, complete a full itinerary for their vacation, finding best deals for flights and hotels.""",
    name="planning_agent",
    instruction=prompt.PLANNING_AGENT_INSTR,
    tools=[
        AgentTool(agent=flight_search_agent),
        AgentTool(agent=flight_seat_selection_agent),
        AgentTool(agent=hotel_search_agent),
        AgentTool(agent=hotel_room_selection_agent),
        AgentTool(agent=itinerary_agent),
        memorize,
    ],
    generate_content_config=GenerateContentConfig(
        temperature=0.1, top_p=0.5
    )
)

======================================================================
FILE: ./travel_concierge/sub_agents/planning/prompt.py
======================================================================

# Copyright 2025 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

"""Prompt for the planning agent."""

PLANNING_AGENT_INSTR = """
You are a travel planning agent who help users finding best deals for flights, hotels, and constructs full itineraries for their vacation. 
You do not handle any bookings. You are helping users with their selections and preferences only.
The actual booking, payment and transactions will be handled by transfering to the `booking_agent` later.

You support a number of user journeys:
- Just need to find flights,
- Just need to find hotels,
- Find flights and hotels but without itinerary,
- Find flights, hotels with an full itinerary,
- Autonomously help the user find flights and hotels.

You have access to the following tools only:
- Use the `flight_search_agent` tool to find flight choices,
- Use the `flight_seat_selection_agent` tool to find seat choices,
- Use the `hotel_search_agent` tool to find hotel choices,
- Use the `hotel_room_selection_agent` tool to find room choices,
- Use the `itinerary_agent` tool to generate an itinerary, and
- Use the `memorize` tool to remember the user's chosen selections.


How to support the user journeys:

The instructions to support a full itinerary with flights and hotels is given within the <FULL_ITINERARY/> block. 
For user journeys there only contains flights or hotels, use instructions from the <FIND_FLIGHTS/> and <FIND_HOTELS/> blocks accordingly for the identified user journey.
Identify the user journey under which the user is referred to you; Satisfy the user's need matching the user journey.
When you are being asked to act autonomously:
- you assume the role of the user temporarily,
- you can make decision on selecting flights, seats, hotels, and rooms, base on user's preferences, 
- if you made a choice base on user's preference, briefly mention the rationale.
- but do not proceed to booking.

Instructions for different user journeys:

<FULL_ITINERARY>
You are creating a full plan with flights and hotel choices, 

Your goal is to help the traveler reach the destination to enjoy these activities, by first completing the following information if any is blank:
  <origin>{origin}</origin>
  <destination>{destination}</destination>
  <start_date>{start_date}</start_date>
  <end_date>{end_date}</end_date>
  <itinerary>
  {itinerary}
  <itinerary>

Current time: {_time}; Infer the current Year from the time.

Make sure you use the information that's already been filled above previously.
- If <destination/> is empty, you can derive the destination base on the dialog so far.
- Ask for missing information from the user, for example, the start date and the end date of the trip. 
- The user may give you start date and number of days of stay, derive the end_date from the information given.
- Use the `memorize` tool to store trip metadata into the following variables (dates in YYYY-MM-DD format);
  - `origin`, 
  - `destination`
  - `start_date` and 
  - `end_date`
  To make sure everything is stored correctly, instead of calling memorize all at once, chain the calls such that 
  you only call another `memorize` after the last call has responded. 
- Use instructions from <FIND_FLIGHTS/> to complete the flight and seat choices.
- Use instructions from <FIND_HOTELS/> to complete the hotel and room choices.
- Finally, use instructions from <CREATE_ITINERARY/> to generate an itinerary.
</FULL_ITINERARY>

<FIND_FLIGHTS>
You are to help the user select a fight and a seat. You do not handle booking nor payment.
Your goal is to help the traveler reach the destination to enjoy these activities, by first completing the following information if any is blank:
  <outbound_flight_selection>{outbound_flight_selection}</outbound_flight_selection>
  <outbound_seat_number>{outbound_seat_number}</outbound_seat_number>
  <return_flight_selection>{return_flight_selection}</return_flight_selection>
  <return_seat_number>{return_seat_number}</return_seat_number>  

- You only have two tools at your disposal: `flight_search_agent` and `flight_seat_selection_agent`.
- Given the user's home city location "{origin}" and the derived destination, 
  - Call `flight_search_agent` and work with the user to select both outbound and inbound flights.
  - Present the flight choices to the user, includes information such as: the airline name, the flight number, departure and arrival airport codes and time. When user selects the flight...
  - Call the `flight_seat_selection_agent` tool to show seat options, asks the user to select one.
  - Call the `memorize` tool to store the outbound and inbound flights and seats selections info into the following variables:
    - 'outbound_flight_selection' and 'outbound_seat_number'
    - 'return_flight_selection' and 'return_seat_number'
    - For flight choise, store the full JSON entries from the `flight_search_agent`'s prior response.  
  - Here's the optimal flow
    - search for flights
    - choose flight, store choice,    
    - select seats, store choice.    
</FIND_FLIGHTS>

<FIND_HOTELS>
You are to help the user with their hotel choices. You do not handle booking nor payment.
Your goal is to help the traveler by  completing the following information if any is blank:
  <hotel_selection>{hotel_selection}</hotel_selection>
  <room_selection>{room_selection}<room_selection>

- You only have two tools at your disposal: `hotel_search_agent` and `hotel_room_selection_agent`.
- Given the derived destination and the interested activities,
  - Call `hotel_search_agent` and work with the user to select a hotel. When user select the hotel...
  - Call `hotel_room_selection_agent` to choose a room.
  - Call the `memorize` tool to store the hotel and room selections into the following variables:
    - `hotel_selection` and `room_selection`
    - For hotel choice, store the chosen JSON entry from the `hotel_search_agent`'s prior response.  
  - Here is the optimal flow
    - search for hotel
    - choose hotel, store choice,
    - select room, store choice.
</FIND_HOTELS>

<CREATE_ITINERARY>
- Help the user prepare a draft itinerary order by days, including a few activites from the dialog so far and from their stated <interests/> below.
  - The itinery should start with traveling to the airport from home. Build in some buffer time for parking, airport shuttles, getting through check-in, security checks, well before boarding time.
  - Travel from airport to the hotel for check-in, up on arrival at the airport.
  - Then the activities.
  - At the end of the trip, check-out from the hotel and travel back to the airport.
- Confirm with the user if the draft is good to go, if the user gives the go ahead, carry out the following steps:
  - Make sure the user's choices for flights and hotels are memorized as instructed above.
  - Store the itinerary by calling the `itinerary_agent` tool, storing the entire plan including flights and hotel details.

Interests:
  <interests>
  {poi}
  </interests>
</CREATE_ITINERARY>

Finally, once the supported user journey is completed, reconfirm with user, if the user gives the go ahead, transfer to `booking_agent` for booking.

Please use the context info below for user preferences
  <user_profile>
  {user_profile}
  </user_profile>
"""


FLIGHT_SEARCH_INSTR = """Generate search results for flights from origin to destination inferred from user query please use future dates within 3 months from today's date for the prices, limit to 4 results.
- ask for any details you don't know, like origin and destination, etc.
- You must generate non empty json response if the user provides origin and destination location
- today's date is ${{new Date().toLocaleDateString()}}.
- Please use the context info below for any user preferences

Current user:
  <user_profile>
  {user_profile}
  </user_profile>

Current time: {_time}
Use origin: {origin} and destination: {destination} for your context

Return the response as a JSON object formatted like this:

{{
  {{"flights": [
    {
      "flight_number":"Unique identifier for the flight, like BA123, AA31, etc."),
      "departure": {{
        "city_name": "Name of the departure city",
        "airport_code": "IATA code of the departure airport",
        "timestamp": ("ISO 8601 departure date and time"),
      }},
      "arrival": {{
        "city_name":"Name of the arrival city",
        "airport_code":"IATA code of the arrival airport",
        "timestamp": "ISO 8601 arrival date and time",
      }},
      "airlines": [
        "Airline names, e.g., American Airlines, Emirates"
      ],
      "airline_logo": "Airline logo location , e.g., if airlines is American then output /images/american.png for United use /images/united.png for Delta use /images/delta1.jpg rest default to /images/airplane.png",
      "price_in_usd": "Integer - Flight price in US dollars",
      "number_of_stops": "Integer - indicating the number of stops during the flight",
    }
  ]}}
}}

Remember that you can only use the tools to complete your tasks: 
  - `flight_search_agent`,
  - `flight_seat_selection_agent`,
  - `hotel_search_agent`,
  - `hotel_room_selection_agent`,
  - `itinerary_agent`,
  - `memorize`

"""

FLIGHT_SEAT_SELECTION_INSTR = """
Simulate available seats for flight number specified by the user, 6 seats on each row and 3 rows in total, adjust pricing based on location of seat.
- You must generate non empty response if the user provides flight number
- Please use the context info below for any user preferences
- Please use this as examples, the seats response is an array of arrays, representing multiple rows of multiple seats.

{{
  "seats" : 
  [
    [
      {{
          "is_available": True,
          "price_in_usd": 60,
          "seat_number": "1A"
      }},
      {{
          "is_available": True,
          "price_in_usd": 60,
          "seat_number": "1B"
      }},
      {{
          "is_available": False,
          "price_in_usd": 60,
          "seat_number": "1C"
      }},
      {{
          "is_available": True,
          "price_in_usd": 70,
          "seat_number": "1D"
      }},
      {{
          "is_available": True,
          "price_in_usd": 70,
          "seat_number": "1E"
      }},
      {{
          "is_available": True,
          "price_in_usd": 50,
          "seat_number": "1F"
      }}
    ],
    [
      {{
          "is_available": True,
          "price_in_usd": 60,
          "seat_number": "2A"
      }},
      {{
          "is_available": False,
          "price_in_usd": 60,
          "seat_number": "2B"
      }},
      {{
          "is_available": True,
          "price_in_usd": 60,
          "seat_number": "2C"
      }},
      {{
          "is_available": True,
          "price_in_usd": 70,
          "seat_number": "2D"
      }},
      {{
          "is_available": True,
          "price_in_usd": 70,
          "seat_number": "2E"
      }},
      {{
          "is_available": True,
          "price_in_usd": 50,
          "seat_number": "2F"
      }}
    ],
  ]
}}

Output from flight agent
<flight>
{flight}
</flight>
use this for your context.
"""


HOTEL_SEARCH_INSTR = """Generate search results for hotels for hotel_location inferred from user query. Find only 4 results.
- ask for any details you don't know, like check_in_date, check_out_date places_of_interest
- You must generate non empty json response if the user provides hotel_location
- today's date is ${{new Date().toLocaleDateString()}}.
- Please use the context info below for any user preferences

Current user:
  <user_profile>
  {user_profile}
  </user_profile>

Current time: {_time}
Use origin: {origin} and destination: {destination} for your context

Return the response as a JSON object formatted like this:
 
{{
  "hotels": [
    {{
      "name": "Name of the hotel",
      "address": "Full address of the Hotel",
      "check_in_time": "16:00",
      "check_out_time": "11:00",      
      "thumbnail": "Hotel logo location , e.g., if hotel is Hilton then output /src/images/hilton.png. if hotel is mariott United use /src/images/mariott.png. if hotel is Conrad  use /src/images/conrad.jpg rest default to /src/images/hotel.png",
      "price": int - "Price of the room per night",
    }},
    {{
      "name": "Name of the hotel",
      "address": "Full address of the Hotel",
      "check_in_time": "16:00",
      "check_out_time": "11:00",           
      "thumbnail": "Hotel logo location , e.g., if hotel is Hilton then output /src/images/hilton.png. if hotel is mariott United use /src/images/mariott.png. if hotel is Conrad  use /src/images/conrad.jpg rest default to /src/images/hotel.png",
      "price": int - "Price of the room per night",
    }},    
  ]
}}
"""

HOTEL_ROOM_SELECTION_INSTR = """
Simulate available rooms for hotel chosen by the user, adjust pricing based on location of room.
- You must generate non empty response if the user chooses a hotel
- Please use the context info below for any user preferences
- please use this as examples

Output from hotel agent:
<hotel>
{hotel}
</hotel>
use this for your context
{{
  "rooms" :
  [
    {{
        "is_available": True,
        "price_in_usd": 260,
        "room_type": "Twin with Balcony"
    }},
    {{
        "is_available": True,
        "price_in_usd": 60,
        "room_type": "Queen with Balcony"
    }},
    {{
        "is_available": False,
        "price_in_usd": 60,
        "room_type": "Twin with Assistance"
    }},
    {{
        "is_available": True,
        "price_in_usd": 70,
        "room_type": "Queen with Assistance"
    }},
  ]
}}
"""


ITINERARY_AGENT_INSTR = """
Given a full itinerary plan provided by the planning agent, generate a JSON object capturing that plan.

Make sure the activities like getting there from home, going to the hotel to checkin, and coming back home is included in the itinerary:
  <origin>{origin}</origin>
  <destination>{destination}</destination>
  <start_date>{start_date}</start_date>
  <end_date>{end_date}</end_date>
  <outbound_flight_selection>{outbound_flight_selection}</outbound_flight_selection>
  <outbound_seat_number>{outbound_seat_number}</outbound_seat_number>
  <return_flight_selection>{return_flight_selection}</return_flight_selection>
  <return_seat_number>{return_seat_number}</return_seat_number>  
  <hotel_selection>{hotel_selection}</hotel_selection>
  <room_selection>{room_selection}<room_selection>

Current time: {_time}; Infer the Year from the time.

The JSON object captures the following information:
- The metadata: trip_name, start and end date, origin and destination.
- The entire multi-days itinerary, which is a list with each day being its own oject.
- For each day, the metadata is the day_number and the date, the content of the day is a list of events.
- Events have different types. By default, every event is a "visit" to somewhere.
  - Use 'flight' to indicate traveling to airport to fly.
  - Use 'hotel' to indiciate traveling to the hotel to check-in.
- Always use empty strings "" instead of `null`.

<JSON_EXAMPLE>
{{
  "trip_name": "San Diego to Seattle Getaway",
  "start_date": "2024-03-15",
  "end_date": "2024-03-17",
  "origin": "San Diego",
  "destination": "Seattle",
  "days": [
    {{
      "day_number": 1,
      "date": "2024-03-15",
      "events": [
        {{
          "event_type": "flight",
          "description": "Flight from San Diego to Seattle",
          "flight_number": "AA1234",
          "departure_airport": "SAN",
          "boarding_time": "07:30",
          "departure_time": "08:00",
          "arrival_airport": "SEA",
          "arrival_time": "10:30",
          "seat_number": "22A",
          "booking_required": True,
          "price": "450",
          "booking_id": ""
        }},
        {{
          "event_type": "hotel",
          "description": "Seattle Marriott Waterfront",
          "address": "2100 Alaskan Wy, Seattle, WA 98121, United States",
          "check_in_time": "16:00",
          "check_out_time": "11:00",
          "room_selection": "Queen with Balcony",
          "booking_required": True,      
          "price": "750",          
          "booking_id": ""
        }}        
      ]
    }},
    {{
      "day_number": 2,
      "date": "2024-03-16",
      "events": [
        {{
          "event_type": "visit",
          "description": "Visit Pike Place Market",
          "address": "85 Pike St, Seattle, WA 98101",
          "start_time": "09:00",
          "end_time": "12:00",
          "booking_required": False
        }},
        {{
          "event_type": "visit",
          "description": "Lunch at Ivar's Acres of Clams",
          "address": "1001 Alaskan Way, Pier 54, Seattle, WA 98104",
          "start_time": "12:30",
          "end_time": "13:30",
          "booking_required": False
        }},
        {{
          "event_type": "visit",
          "description": "Visit the Space Needle",
          "address": "400 Broad St, Seattle, WA 98109",
          "start_time": "14:30",
          "end_time": "16:30",
          "booking_required": True,
          "price": "25",        
          "booking_id": ""
        }},
        {{
          "event_type": "visit",
          "description": "Dinner in Capitol Hill",
          "address": "Capitol Hill, Seattle, WA",
          "start_time": "19:00",
          "booking_required": False
        }}
      ]
    }},
    {{
      "day_number": 3,
      "date": "2024-03-17",
      "events": [
        {{
          "event_type": "visit",
          "description": "Visit the Museum of Pop Culture (MoPOP)",
          "address": "325 5th Ave N, Seattle, WA 98109",
          "start_time": "10:00",
          "end_time": "13:00",
          "booking_required": True,
          "price": "12",        
          "booking_id": ""
        }},
        {{
          "event_type":"flight",
          "description": "Return Flight from Seattle to San Diego",
          "flight_number": "UA5678",
          "departure_airport": "SEA",
          "boarding_time": "15:30",
          "departure_time": "16:00",          
          "arrival_airport": "SAN",
          "arrival_time": "18:30",
          "seat_number": "10F",
          "booking_required": True,
          "price": "750",        
          "booking_id": ""
        }}
      ]
    }}
  ]
}}
</JSON_EXAMPLE>

- See JSON_EXAMPLE above for the kind of information capture for each types. 
  - Since each day is separately recorded, all times shall be in HH:MM format, e.g. 16:00
  - All 'visit's should have a start time and end time unless they are of type 'flight', 'hotel', or 'home'.
  - For flights, include the following information:
    - 'departure_airport' and 'arrival_airport'; Airport code, i.e. SEA
    - 'boarding_time'; This is usually half hour - 45 minutes before departure.
    - 'flight_number'; e.g. UA5678
    - 'departure_time' and 'arrival_time'
    - 'seat_number'; The row and position of the seat, e.g. 22A.
    - e.g. {{
        "event_type": "flight",
        "description": "Flight from San Diego to Seattle",
        "flight_number": "AA1234",
        "departure_airport": "SAN",
        "arrival_airport": "SEA",
        "departure_time": "08:00",
        "arrival_time": "10:30",
        "boarding_time": "07:30",
        "seat_number": "22A",
        "booking_required": True,
        "price": "500",        
        "booking_id": "",
      }}
  - For hotels, include:
    - the check-in and check-out time in their respective entry of the journey.
    - Note the hotel price should be the total amount covering all nights.
    - e.g. {{
        "event_type": "hotel",
        "description": "Seattle Marriott Waterfront",
        "address": "2100 Alaskan Wy, Seattle, WA 98121, United States",
        "check_in_time": "16:00",
        "check_out_time": "11:00",
        "room_selection": "Queen with Balcony",
        "booking_required": True,   
        "price": "1050",     
        "booking_id": ""
      }}
  - For activities or attraction visiting, include:
    - the anticipated start and end time for that activity on the day.
    - e.g. for an activity:
      {{
        "event_type": "visit",
        "description": "Snorkeling activity",
        "address": "Ma’alaea Harbor",
        "start_time": "09:00",
        "end_time": "12:00",
        "booking_required": false,
        "booking_id": ""
      }}
    - e.g. for free time, keep address empty:
      {{
        "event_type": "visit",
        "description": "Free time/ explore Maui",
        "address": "",
        "start_time": "13:00",
        "end_time": "17:00",
        "booking_required": false,
        "booking_id": ""
      }}
"""

======================================================================
FILE: ./travel_concierge/sub_agents/__init__.py
======================================================================

# Copyright 2025 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

======================================================================
FILE: ./travel_concierge/sub_agents/post_trip/__init__.py
======================================================================

# Copyright 2025 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

from . import agent

======================================================================
FILE: ./travel_concierge/sub_agents/post_trip/agent.py
======================================================================

# Copyright 2025 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

"""Post-trip agent. A post-booking agent covering the user experience during the time period after the trip."""

from google.adk.agents import Agent

from travel_concierge.sub_agents.post_trip import prompt
from travel_concierge.tools.memory import memorize

post_trip_agent = Agent(
    model="gemini-2.5-flash",
    name="post_trip_agent",
    description="A follow up agent to learn from user's experience; In turn improves the user's future trips planning and in-trip experience.",
    instruction=prompt.POSTTRIP_INSTR,
    tools=[memorize],
)

======================================================================
FILE: ./travel_concierge/sub_agents/post_trip/prompt.py
======================================================================

# Copyright 2025 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

"""Prompt for the post-trip agent."""

POSTTRIP_INSTR = """
You are a post-trip travel assistant.  Based on the user's request and any provided trip information, assist the user with post-trip matters. 

Given the itinerary:
<itinerary>
{itinerary}
</itinerary>

If the itinerary is empty, inform the user that you can help once there is an itinerary, and asks to transfer the user back to the `inspiration_agent`.
Otherwise, follow the rest of the instruction.

You would like to learn as much as possible from the user about their experience on this itinerary.
Use the following type of questions to reveal the user's sentiments:
- What did you liked about the trip?
- Which specific experiences and which aspects were the most memorable?
- What could have been even better?
- Would you recommend any of the businesses you have encountered?

From user's answers, extract the following types of information and use it in the future:
- Food Dietary preferences
- Travel destination preferences
- Acitivities preferences
- Business reviews and recommendations

For every individually identified preferences, store their values using the `memorize` tool.

Finally, thank the user, and express that these feedback will be incorporated into their preferences for next time!
"""

POSTTRIP_IDEAS_UNUSED = """
You can help with:
*   **Social Media:** Generate and post a video log or highlight reel of the trip to social media.
*   **Claims:** Guide the user on filing claims for lost luggage, flight cancellations, or other issues. Provide relevant contact information and procedures.
*   **Reviews:** Help the user leave reviews for hotels, airlines, or other services.  Suggest relevant platforms and guide them on writing effective reviews.
*   **Refunds:**  Provide information on obtaining refunds for cancelled flights or other services.  Explain eligibility requirements and procedures.
"""

======================================================================
FILE: ./travel_concierge/sub_agents/pre_trip/__init__.py
======================================================================

# Copyright 2025 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

from . import agent

======================================================================
FILE: ./travel_concierge/sub_agents/pre_trip/agent.py
======================================================================

# Copyright 2025 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

"""Pre-trip agent. A post-booking agent covering the user experience during the time period running up to the trip."""

from google.adk.agents import Agent
from google.adk.tools.agent_tool import AgentTool
from travel_concierge.shared_libraries import types
from travel_concierge.sub_agents.pre_trip import prompt
from travel_concierge.tools.search import google_search_grounding


what_to_pack_agent = Agent(
    model="gemini-2.5-flash",
    name="what_to_pack_agent",
    description="Make suggestion on what to bring for the trip",
    instruction=prompt.WHATTOPACK_INSTR,
    disallow_transfer_to_parent=True,
    disallow_transfer_to_peers=True,
    output_key="what_to_pack",
    output_schema=types.PackingList,
)

pre_trip_agent = Agent(
    model="gemini-2.5-flash",
    name="pre_trip_agent",
    description="Given an itinerary, this agent keeps up to date and provides relevant travel information to the user before the trip.",
    instruction=prompt.PRETRIP_AGENT_INSTR,
    tools=[google_search_grounding, AgentTool(agent=what_to_pack_agent)],
)

======================================================================
FILE: ./travel_concierge/sub_agents/pre_trip/prompt.py
======================================================================

# Copyright 2025 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

"""Prompt for pre-trip agent."""

PRETRIP_AGENT_INSTR = """
You are a pre-trip assistant to help equip a traveler with the best information for a stress free trip.
You help gather information about an upcoming trips, travel updates, and relevant information.
Several tools are provided for your use.

Given the itinerary:
<itinerary>
{itinerary}
</itinerary>

and the user profile:
<user_profile>
{user_profile}
</user_profile>

If the itinerary is empty, inform the user that you can help once there is an itinerary, and asks to transfer the user back to the `inspiration_agent`.
Otherwise, follow the rest of the instruction.

From the <itinerary/>, note origin of the trip, and the destination, the season and the dates of the trip.
From the <user_profile/>, note the traveler's passport nationality, if none is assume passport is US Citizen.

If you are given the command "update", perform the following action:
Call the tool `google_search_grounding` on each of these topics in turn, with respect to the trip origin "{origin}" and destination "{destination}". 
It is not necessary to provide summary or comments after each tool, simply call the next one until done; 
- visa_requirements,
- medical_requirements,
- storm_monitor,
- travel_advisory,

After that, call the `what_to_pack` tool.

When all the tools have been called, or given any other user utterance, 
- summarize all the retrieved information for the user in human readable form.
- If you have previously provided the information, just provide the most important items.
- If the information is in JSON, convert it into user friendly format.

Example output:
Here are the important information for your trip:
- visa: ...
- medical: ...
- travel advisory: here is a list of advisory...
- storm update: last updated on <date>, the storm Helen may not approach your destination, we are clear... 
- what to pack: jacket, walking shoes... etc.

"""

WHATTOPACK_INSTR = """
Given a trip origin, a destination, and some rough idea of activities, 
suggests a handful of items to pack appropriate for the trip.

Return in JSON format, a list of items to pack, e.g.

[ "walking shoes", "fleece", "umbrella" ]
"""

======================================================================
FILE: ./travel_concierge/sub_agents/inspiration/__init__.py
======================================================================

# Copyright 2025 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

======================================================================
FILE: ./travel_concierge/sub_agents/inspiration/agent.py
======================================================================

# Copyright 2025 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

"""Inspiration agent. A pre-booking agent covering the ideation part of the trip."""

from google.adk.agents import Agent
from google.adk.tools.agent_tool import AgentTool
from travel_concierge.shared_libraries.types import DestinationIdeas, POISuggestions, json_response_config
from travel_concierge.sub_agents.inspiration import prompt
from travel_concierge.tools.places import map_tool


place_agent = Agent(
    model="gemini-2.5-flash",
    name="place_agent",
    instruction=prompt.PLACE_AGENT_INSTR,
    description="This agent suggests a few destination given some user preferences",
    disallow_transfer_to_parent=True,
    disallow_transfer_to_peers=True,
    output_schema=DestinationIdeas,
    output_key="place",
    generate_content_config=json_response_config,
)

poi_agent = Agent(
    model="gemini-2.5-flash",
    name="poi_agent",
    description="This agent suggests a few activities and points of interests given a destination",
    instruction=prompt.POI_AGENT_INSTR,
    disallow_transfer_to_parent=True,
    disallow_transfer_to_peers=True,
    output_schema=POISuggestions,
    output_key="poi",
    generate_content_config=json_response_config,
)

inspiration_agent = Agent(
    model="gemini-2.5-flash",
    name="inspiration_agent",
    description="A travel inspiration agent who inspire users, and discover their next vacations; Provide information about places, activities, interests,",
    instruction=prompt.INSPIRATION_AGENT_INSTR,
    tools=[AgentTool(agent=place_agent), AgentTool(agent=poi_agent), map_tool],
)

======================================================================
FILE: ./travel_concierge/sub_agents/inspiration/prompt.py
======================================================================

# Copyright 2025 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

"""Prompt for the inspiration agent."""

INSPIRATION_AGENT_INSTR = """
You are travel inspiration agent who help users find their next big dream vacation destinations.
Your role and goal is to help the user identify a destination and a few activities at the destination the user is interested in. 

As part of that, user may ask you for general history or knowledge about a destination, in that scenario, answer briefly in the best of your ability, but focus on the goal by relating your answer back to destinations and activities the user may in turn like.
- You will call the two agent tool `place_agent(inspiration query)` and `poi_agent(destination)` when appropriate:
  - Use `place_agent` to recommend general vacation destinations given vague ideas, be it a city, a region, a country.
  - Use `poi_agent` to provide points of interests and acitivities suggestions, once the user has a specific city or region in mind.
  - Everytime after `poi_agent` is invoked, call `map_tool` with the key being `poi` to verify the latitude and longitudes.
- Avoid asking too many questions. When user gives instructions like "inspire me", or "suggest some", just go ahead and call `place_agent`.
- As follow up, you may gather a few information from the user to future their vacation inspirations.
- Once the user selects their destination, then you help them by providing granular insights by being their personal local travel guide

- Here's the optimal flow:
  - inspire user for a dream vacation
  - show them interesting things to do for the selected location

- Your role is only to identify possible destinations and acitivites. 
- Do not attempt to assume the role of `place_agent` and `poi_agent`, use them instead.
- Do not attempt to plan an itinerary for the user with start dates and details, leave that to the planning_agent.
- Transfer the user to planning_agent once the user wants to:
  - Enumerate a more detailed full itinerary, 
  - Looking for flights and hotels deals. 

- Please use the context info below for any user preferences:
Current user:
  <user_profile>
  {user_profile}
  </user_profile>

Current time: {_time}
"""


POI_AGENT_INSTR = """
You are responsible for providing a list of point of interests, things to do recommendations based on the user's destination choice. Limit the choices to 5 results.

Return the response as a JSON object:
{{
 "places": [
    {{
      "place_name": "Name of the attraction",
      "address": "An address or sufficient information to geocode for a Lat/Lon".
      "lat": "Numerical representation of Latitude of the location (e.g., 20.6843)",
      "long": "Numerical representation of Latitude of the location (e.g., -88.5678)",
      "review_ratings": "Numerical representation of rating (e.g. 4.8 , 3.0 , 1.0 etc),
      "highlights": "Short description highlighting key features",
      "image_url": "verified URL to an image of the destination",
      "map_url":  "Placeholder - Leave this as empty string."      
      "place_id": "Placeholder - Leave this as empty string."
    }}
  ]
}}
"""
"""Use the tool `latlon_tool` with the name or address of the place to find its longitude and latitude."""

PLACE_AGENT_INSTR = """
You are responsible for make suggestions on vacation inspirations and recommendations based on the user's query. Limit the choices to 3 results.
Each place must have a name, its country, a URL to an image of it, a brief descriptive highlight, and a rating which rates from 1 to 5, increment in 1/10th points.

Return the response as a JSON object:
{{
  {{"places": [
    {{
      "name": "Destination Name",
      "country": "Country Name",
      "image": "verified URL to an image of the destination",
      "highlights": "Short description highlighting key features",
      "rating": "Numerical rating (e.g., 4.5)"
    }},
  ]}}
}}
"""

======================================================================
FILE: ./travel_concierge/sub_agents/in_trip/tools.py
======================================================================

# Copyright 2025 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

"""Tools for the in_trip, trip_monitor and day_of agents."""

from datetime import datetime
from typing import Dict, Any

from google.adk.agents.readonly_context import ReadonlyContext

from travel_concierge.sub_agents.in_trip import prompt
from travel_concierge.shared_libraries import constants


def flight_status_check(flight_number: str, flight_date: str, checkin_time: str, departure_time: str):
    """Checks the status of a flight, given its flight_number, date, checkin_time and departure_time."""
    print("Checking", flight_number, flight_date, checkin_time, departure_time)
    return {"status": f"Flight {flight_number} checked"}


def event_booking_check(event_name: str, event_date: str, event_location: str):
    """Checks the status of an event that requires booking, given its event_name, date, and event_location."""
    print("Checking", event_name, event_date, event_location)
    if event_name.startswith("Space Needle"):  # Mocking an exception to illustrate
        return {"status": f"{event_name} is closed."}
    return {"status": f"{event_name} checked"}


def weather_impact_check(activity_name: str, activity_date: str, activity_location: str):
    """
    Checks the status of an outdoor activity that may be impacted by weather, given its name, date, and its location.

    Args:
        activity_name: The name of the activity.
        activity_date: The date of the activity.
        activity_location: The location of the activity.

    Returns:
        A dictionary containing the status of the activity.
    """
    print("Checking", activity_name, activity_date, activity_location)
    return {"status": f"{activity_name} checked"}


def get_event_time_as_destination(destin_json: Dict[str, Any], default_value: str):
    """Returns an event time appropriate for the location type."""
    match destin_json["event_type"]:
        case "flight":
            return destin_json["boarding_time"]
        case "hotel":
            return destin_json["check_in_time"]
        case "visit":
            return destin_json["start_time"]
        case _:
            return default_value


def parse_as_origin(origin_json: Dict[str, Any]):
    """Returns a tuple of strings (origin, depart_by) appropriate for the starting location."""
    match origin_json["event_type"]:
        case "flight":
            return (
                origin_json["arrival_airport"] + " Airport",
                origin_json["arrival_time"],
            )
        case "hotel":
            return (
                origin_json["description"] + " " + origin_json.get("address", ""),
                "any time",
            )
        case "visit":
            return (
                origin_json["description"] + " " + origin_json.get("address", ""),
                origin_json["end_time"],
            )
        case "home":
            return (
                origin_json.get("local_prefer_mode")
                + " from "
                + origin_json.get("address", ""),
                "any time",
            )
        case _:
            return "Local in the region", "any time"


def parse_as_destin(destin_json: Dict[str, Any]):
    """Returns a tuple of strings (destination, arrive_by) appropriate for the destination."""
    match destin_json["event_type"]:
        case "flight":
            return (
                destin_json["departure_airport"] + " Airport",
                "An hour before " + destin_json["boarding_time"],
            )
        case "hotel":
            return (
                destin_json["description"] + " " + destin_json.get("address", ""),
                "any time",
            )
        case "visit":
            return (
                destin_json["description"] + " " + destin_json.get("address", ""),
                destin_json["start_time"],
            )
        case "home":
            return (
                destin_json.get("local_prefer_mode")
                + " to "
                + destin_json.get("address", ""),
                "any time",
            )
        case _:
            return "Local in the region", "as soon as possible"


def find_segment(profile: Dict[str, Any], itinerary: Dict[str, Any], current_datetime: str):
    """
    Find the events to travel from A to B
    This follows the itinerary schema in types.Itinerary.

    Since return values will be used as part of the prompt,
    there are flexibilities in what the return values contains.

    Args:
        profile: A dictionary containing the user's profile.
        itinerary: A dictionary containing the user's itinerary.
        current_datetime: A string containing the current date and time.   

    Returns:
      from - capture information about the origin of this segment.
      to   - capture information about the destination of this segment.
      arrive_by - an indication of the time we shall arrive at the destination.
    """
    # Expects current_datetime is in '2024-03-15 04:00:00' format
    datetime_object = datetime.fromisoformat(current_datetime)
    current_date = datetime_object.strftime("%Y-%m-%d")
    current_time = datetime_object.strftime("%H:%M")
    event_date = current_date
    event_time = current_time

    print("-----")
    print("MATCH DATE", current_date, current_time)
    print("-----")

    # defaults
    origin_json = profile["home"]
    destin_json = profile["home"]

    leave_by = "No movement required"
    arrive_by = "No movement required"

    # Go through the itinerary to find where we are base on the current date and time
    for day in itinerary.get("days", []):
        event_date = day["date"]
        for event in day["events"]:
            # for every event we update the origin and destination until
            # we find one we need to pay attention
            origin_json = destin_json
            destin_json = event
            event_time = get_event_time_as_destination(destin_json, current_time)
            # The moment we find an event that's in the immediate future we stop to handle it
            print(
                event["event_type"], event_date, current_date, event_time, current_time
            )
            if event_date >= current_date and event_time >= current_time:
                break
        else:  # if inner loop not break, continue
            continue
        break  # else break too.

    #
    # Construct prompt descriptions for travel_from, travel_to, arrive_by
    #
    travel_from, leave_by = parse_as_origin(origin_json)
    travel_to, arrive_by = parse_as_destin(destin_json)

    return (travel_from, travel_to, leave_by, arrive_by)


def _inspect_itinerary(state: dict[str: Any]):
    """Identifies and returns the itinerary, profile and current datetime from the session state."""

    itinerary = state[constants.ITIN_KEY]
    profile = state[constants.PROF_KEY]
    print("itinerary", itinerary)
    current_datetime = itinerary["start_date"] + " 00:00"
    if state.get(constants.ITIN_DATETIME, ""):
        current_datetime = state[constants.ITIN_DATETIME]

    return itinerary, profile, current_datetime


def transit_coordination(readonly_context: ReadonlyContext):
    """Dynamically generates an instruction for the day_of agent."""

    state = readonly_context.state

    # Inspecting the itinerary
    if constants.ITIN_KEY not in state:
        return prompt.NEED_ITIN_INSTR

    itinerary, profile, current_datetime = _inspect_itinerary(state)
    travel_from, travel_to, leave_by, arrive_by = find_segment(
        profile, itinerary, current_datetime
    )

    print("-----")
    print(itinerary["trip_name"])
    print(current_datetime)
    print("-----")
    print("-----")
    print("TRIP EVENT")
    print("FROM", travel_from, leave_by)
    print("TO", travel_to, arrive_by)
    print("-----")

    return prompt.LOGISTIC_INSTR_TEMPLATE.format(
        CURRENT_TIME=current_datetime,
        TRAVEL_FROM=travel_from,
        LEAVE_BY_TIME=leave_by,
        TRAVEL_TO=travel_to,
        ARRIVE_BY_TIME=arrive_by,
    )

======================================================================
FILE: ./travel_concierge/sub_agents/in_trip/__init__.py
======================================================================

# Copyright 2025 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

from . import agent

======================================================================
FILE: ./travel_concierge/sub_agents/in_trip/agent.py
======================================================================

# Copyright 2025 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

"""In-trip agent. A post-booking agent covering the user experience during the trip."""

from google.adk.agents import Agent
from google.adk.tools.agent_tool import AgentTool

from travel_concierge.sub_agents.in_trip import prompt
from travel_concierge.sub_agents.in_trip.tools import (
    transit_coordination,
    flight_status_check,
    event_booking_check,
    weather_impact_check,
)

from travel_concierge.tools.memory import memorize


# This sub-agent is expected to be called every day closer to the trip, and frequently several times a day during the trip.
day_of_agent = Agent(
    model="gemini-2.5-flash",
    name="day_of_agent",
    description="Day_of agent is the agent handling the travel logistics of a trip.",
    instruction=transit_coordination,
)


trip_monitor_agent = Agent(
    model="gemini-2.5-flash",
    name="trip_monitor_agent",
    description="Monitor aspects of a itinerary and bring attention to items that necessitate changes",
    instruction=prompt.TRIP_MONITOR_INSTR,
    tools=[flight_status_check, event_booking_check, weather_impact_check],
    output_key="daily_checks",  # can be sent via email.
)


in_trip_agent = Agent(
    model="gemini-2.5-flash",
    name="in_trip_agent",
    description="Provide information about what the users need as part of the tour.",
    instruction=prompt.INTRIP_INSTR,
    sub_agents=[
        trip_monitor_agent
    ],  # This can be run as an AgentTool. Illustrate as an Agent for demo purpose.
    tools=[
        AgentTool(agent=day_of_agent), 
        memorize
    ],
)

======================================================================
FILE: ./travel_concierge/sub_agents/in_trip/prompt.py
======================================================================

# Copyright 2025 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

"""Prompt for in_trip, trip_monitor and day_of agents."""

TRIP_MONITOR_INSTR = """
Given an itinerary: 
<itinerary>
{itinerary}
</itinerary>

and the user profile:
<user_profile>
{user_profile}
</user_profile>

If the itinerary is empty, inform the user that you can help once there is an itinerary, and asks to transfer the user back to the `inspiration_agent`.
Otherwise, follow the rest of the instruction.

Identify these type of events, and note their details:
- Flights: note flight number, date, check-in time and departure time.
- Events that requires booking: note the event name, date and location.
- Activities or visits that may be impacted by weather: note date, location and desired weather.

For each identified events, checks their status using tools:s
- flights delays or cancelations - use `flight_status_check`
- events that requires booking - use `event_booking_check`
- outdoor activities that may be affected by weather, weather forecasts - use `weather_impact`

Summarize and present a short list of suggested changes if any for the user's attention. For example:
- Flight XX123 is cancelled, suggest rebooking.
- Event ABC may be affected by bad weather, suggest find alternatives.
- ...etc.

Finally, after the summary transfer back to the `in_trip_agent` to handle user's other needs.
"""

INTRIP_INSTR = """
You are a travel concierge. You provide helpful information during the users' trip.
The variety of information you provide:
1. You monitor the user's bookings daily and provide a summary to the user in case there needs to be changes to their plan.
2. You help the user travel from A to B and provide transport and logistical information.
3. By default, you are acting as a tour guide, when the user asked, may be with a photo, you provide information about the venue and attractions the user is visiting.

When instructed with the command "monitor", call the `trip_monitor_agent` and summarize the results.
When instructed with the command "transport", call `day_of_agent(help)` as a tool asking it to provide logistical support.
When instructed with the command "memorize" with a datetime to be stored under a key, call the tool s`memorize(key, value)` to store the date and time.

The current trip itinerary.
<itinerary>
{itinerary}
</itinerary>

The current time is "{itinerary_datetime}".
"""

NEED_ITIN_INSTR = """
Cannot find an itinerary to work on. 
Inform the user that you can help once there is an itinerary, and asks to transfer the user back to the `inspiration_agent` or the `root_agent`.
"""

LOGISTIC_INSTR_TEMPLATE = """
Your role is primarily to handle logistics to get to the next destination on a traveler's trip.

Current time is "{CURRENT_TIME}".
The user is traveling from:
  <FROM>{TRAVEL_FROM}</FROM>
  <DEPART_BY>{LEAVE_BY_TIME}</DEPART_BY>
  <TO>{TRAVEL_TO}</TO>
  <ARRIVE_BY>{ARRIVE_BY_TIME}</ARRIVE_BY>

Assess how you can help the traveler:
- If <FROM/> is the same as <TO/>, inform the traveler that there is nothing to do.
- If the <ARRIVE_BY/> is far from Current Time, which means we don't have anything to work on just yet.
- If <ARRIVE_BY/> is "as soon as possible", or it is in the immediate future:
  - Suggest the best transportation mode and the best time to depart the starting FROM place, in order to reach the TO place on time, or well before time.
  - If the destination in <TO/> is an airport, make sure to provide some extra buffer time for going through security checks, parking... etc.
  - If the destination in <TO/> is reachable by Uber, offer to order one, figure out the ETA and find a pick up point.
"""

======================================================================
FILE: ./travel_concierge/profiles/itinerary_seattle_example.json
======================================================================

{
  "state": {
    "user_profile" : {
      "passport_nationality" : "US Citizen",
      "seat_preference": "window",
      "food_preference": "vegan",
      "allergies": [],
      "likes": [],
      "dislikes": [],
      "price_sensitivity": [],    
      "home":
      {
        "event_type": "home",
        "address": "6420 Sequence Dr #400, San Diego, CA 92121, United States",
        "local_prefer_mode": "drive"
      }  
    },
    "itinerary": {
      "trip_name": "San Diego to Seattle Getaway",
      "start_date": "2025-06-15",
      "end_date": "2025-06-17",
      "origin": "San Diego",
      "destination": "Seattle",
      "days": [
        {
          "day_number": 1,
          "date": "2025-06-15",
          "events": [
            {
              "event_type": "flight",
              "description": "Flight from San Diego to Seattle",
              "flight_number": "AA1234",
              "departure_airport": "SAN",
              "arrival_airport": "SEA",
              "departure_time": "08:00",
              "boarding_time": "07:30",
              "seat_number": "22A",
              "booking_required": true,
              "booking_id": "ABC-123-XYZ"
            }
          ]
        },
        {
          "day_number": 2,
          "date": "2025-06-16",
          "events": [
            {
              "event_type": "visit",
              "description": "Visit Pike Place Market",
              "location": {
                "name": "Pike Place Market",
                "address": "85 Pike St, Seattle, WA 98101",
                "latitude": "47.6097",
                "longitude": "-122.3422"
              },
              "start_time": "09:00",
              "end_time": "12:00",
              "booking_required": false
            },
            {
              "event_type": "visit",
              "description": "Lunch at Ivar's Acres of Clams",
              "location": {
                "name": "Ivar's Acres of Clams",
                "address": "1001 Alaskan Way, Pier 54, Seattle, WA 98104",
                "latitude": "47.6029",
                "longitude": "-122.3398"
              },
              "start_time": "12:30",
              "end_time": "13:30",
              "booking_required": false
            },
            {
              "event_type": "visit",
              "description": "Visit the Space Needle",
              "location": {
                "name": "Space Needle",
                "address": "400 Broad St, Seattle, WA 98109",
                "latitude": "47.6205",
                "longitude": "-122.3492"
              },
              "start_time": "14:30",
              "end_time": "16:30",
              "booking_required": true,
              "booking_id": "DEF-456-UVW"
            },
            {
              "event_type": "visit",
              "description": "Dinner in Capitol Hill",
              "location": {
                "name": "Capitol Hill Neighborhood",
                "address": "Capitol Hill, Seattle, WA",
                "latitude": "47.6234",
                "longitude": "-122.3175"
              },
              "start_time": "19:00",
              "end_time": "21:00",
              "booking_required": false
            }
          ]
        },
        {
          "day_number": 3,
          "date": "2025-06-17",
          "events": [
            {
              "event_type": "visit",
              "description": "Visit the Museum of Pop Culture (MoPOP)",
              "location": {
                "name": "Museum of Pop Culture (MoPOP)",
                "address": "325 5th Ave N, Seattle, WA 98109",
                "latitude": "47.6212",
                "longitude": "-122.3472"
              },
              "start_time": "10:00",
              "end_time": "13:00",
              "booking_required": true,
              "booking_id": "GHI-789-PQR"
            },
            {
              "event_type":"flight",
              "description": "Return Flight from Seattle to San Diego",
              "flight_number": "UA5678",
              "departure_airport": "SEA",
              "arrival_airport": "SAN",
              "departure_time": "16:00",
              "boarding_time": "15:30",
              "seat_number": "10F",
              "booking_required": true,
              "booking_id": "LMN-012-STU"
            }
          ]
        }
      ]
    },
    "origin": "San Diego",
    "destination": "Seattle",    
    "start_date": "2025-06-15",
    "end_date": "2025-06-17",    
    "outbound_flight_selection" : "",
    "outbound_seat_number" : "",
    "return_flight_selection" : "",
    "return_seat_number" : "",
    "hotel_selection" : "",
    "room_selection" : "",
    "poi" : "",
    "itinerary_datetime" : "",
    "itinerary_start_date" : "2025-06-15",
    "itinerary_end_date" : "2025-06-17"    
  }
}
======================================================================
FILE: ./travel_concierge/profiles/itinerary_empty_default.json
======================================================================

{
  "state": {
    "user_profile" : {
      "passport_nationality" : "US Citizen",
      "seat_preference": "window",
      "food_preference": "vegan",
      "allergies": [],
      "likes": [],
      "dislikes": [],
      "price_sensitivity": [],    
      "home":
      {
          "event_type": "home",
          "address": "6420 Sequence Dr #400, San Diego, CA 92121, United States",
          "local_prefer_mode": "drive"
      }    
    },
    "itinerary": {},
    "origin" : "",
    "destination" : "",
    "start_date" : "",
    "end_date" : "",
    "outbound_flight_selection" : "",
    "outbound_seat_number" : "",
    "return_flight_selection" : "",
    "return_seat_number" : "",
    "hotel_selection" : "",
    "room_selection" : "",
    "poi" : "",
    "itinerary_datetime" : "",
    "itinerary_start_date" : "",
    "itinerary_end_date" : ""  
  }
}
======================================================================
FILE: ./eval/data/test_config.json
======================================================================

{
  "criteria": {
    "tool_trajectory_avg_score": 0.1,
    "response_match_score": 0.1
  }
}
======================================================================
FILE: ./eval/data/intrip.test.json
======================================================================

{
  "eval_set_id": "a554f356-c2b0-4b18-94cb-479d98b3192f",
  "name": "a554f356-c2b0-4b18-94cb-479d98b3192f",
  "description": null,
  "eval_cases": [
    {
      "eval_id": "/usr/local/google/home/gkcng/Projects/adk-samples/python/agents/travel-concierge/eval/data/intrip.test.json",
      "conversation": [
        {
          "invocation_id": "9c5b4cb9-9481-4916-9635-a5e8e60b7348",
          "user_content": {
            "parts": [
              {
                "video_metadata": null,
                "thought": null,
                "inline_data": null,
                "code_execution_result": null,
                "executable_code": null,
                "file_data": null,
                "function_call": null,
                "function_response": null,
                "text": "transfer to in_trip"
              }
            ],
            "role": "user"
          },
          "final_response": {
            "parts": [
              {
                "video_metadata": null,
                "thought": null,
                "inline_data": null,
                "code_execution_result": null,
                "executable_code": null,
                "file_data": null,
                "function_call": null,
                "function_response": null,
                "text": "Okay, I am now in charge. How can I help you with your trip? I can provide information about your itinerary, help with transportation, or offer details about the attractions you're visiting."
              }
            ],
            "role": "model"
          },
          "intermediate_data": {
            "tool_uses": [
              {
                "id": null,
                "args": {
                  "agent_name": "in_trip_agent"
                },
                "name": "transfer_to_agent"
              }
            ],
            "intermediate_responses": []
          },
          "creation_timestamp": 1747946882.9598289
        },
        {
          "invocation_id": "4c3147f7-8d90-425f-b3d6-85a30215766d",
          "user_content": {
            "parts": [
              {
                "video_metadata": null,
                "thought": null,
                "inline_data": null,
                "code_execution_result": null,
                "executable_code": null,
                "file_data": null,
                "function_call": null,
                "function_response": null,
                "text": "monitor"
              }
            ],
            "role": "user"
          },
          "final_response": {
            "parts": [
              {
                "video_metadata": null,
                "thought": null,
                "inline_data": null,
                "code_execution_result": null,
                "executable_code": null,
                "file_data": null,
                "function_call": null,
                "function_response": null,
                "text": "OK. It looks like the Space Needle is closed on June 16, 2025. Would you like me to help you find an alternative activity for that time?"
              }
            ],
            "role": "model"
          },
          "intermediate_data": {
            "tool_uses": [
              {
                "id": null,
                "args": {
                  "agent_name": "trip_monitor_agent"
                },
                "name": "transfer_to_agent"
              },
              {
                "id": null,
                "args": {
                  "departure_time": "08:00",
                  "flight_number": "AA1234",
                  "flight_date": "2025-06-15",
                  "checkin_time": "07:30"
                },
                "name": "flight_status_check"
              },
              {
                "id": null,
                "args": {
                  "departure_time": "16:00",
                  "flight_number": "UA5678",
                  "flight_date": "2025-06-17",
                  "checkin_time": "15:30"
                },
                "name": "flight_status_check"
              },
              {
                "id": null,
                "args": {
                  "event_location": "Space Needle",
                  "event_name": "Space Needle",
                  "event_date": "2025-06-16"
                },
                "name": "event_booking_check"
              },
              {
                "id": null,
                "args": {
                  "event_date": "2025-06-17",
                  "event_location": "Museum of Pop Culture (MoPOP)",
                  "event_name": "Museum of Pop Culture (MoPOP)"
                },
                "name": "event_booking_check"
              },
              {
                "id": null,
                "args": {
                  "activity_date": "2025-06-16",
                  "activity_location": "Pike Place Market",
                  "activity_name": "Visit Pike Place Market"
                },
                "name": "weather_impact_check"
              },
              {
                "id": null,
                "args": {
                  "activity_location": "Ivar's Acres of Clams",
                  "activity_name": "Lunch at Ivar's Acres of Clams",
                  "activity_date": "2025-06-16"
                },
                "name": "weather_impact_check"
              },
              {
                "id": null,
                "args": {
                  "activity_location": "Capitol Hill Neighborhood",
                  "activity_date": "2025-06-16",
                  "activity_name": "Dinner in Capitol Hill"
                },
                "name": "weather_impact_check"
              },
              {
                "id": null,
                "args": {
                  "agent_name": "in_trip_agent"
                },
                "name": "transfer_to_agent"
              }
            ],
            "intermediate_responses": [
              [
                "trip_monitor_agent",
                [
                  {
                    "video_metadata": null,
                    "thought": null,
                    "inline_data": null,
                    "code_execution_result": null,
                    "executable_code": null,
                    "file_data": null,
                    "function_call": null,
                    "function_response": null,
                    "text": "Okay, I will monitor your itinerary and identify potential issues. Let's start!\n\nFirst, I'll identify the different types of events in your itinerary and note their details.\n\n**Flights:**\n\n*   **Flight 1:** San Diego to Seattle on 2025-06-15, Flight number AA1234, Check-in time 07:30, Departure time 08:00.\n*   **Flight 2:** Seattle to San Diego on 2025-06-17, Flight number UA5678, Check-in time 15:30, Departure time 16:00.\n\n**Events requiring booking:**\n\n*   Visit the Space Needle on 2025-06-16 at Space Needle.\n*   Visit the Museum of Pop Culture (MoPOP) on 2025-06-17 at Museum of Pop Culture (MoPOP).\n\n**Activities/Visits that may be impacted by weather:**\n\n*   Visit Pike Place Market on 2025-06-16 at Pike Place Market.\n*   Lunch at Ivar's Acres of Clams on 2025-06-16 at Ivar's Acres of Clams.\n*   Dinner in Capitol Hill on 2025-06-16 at Capitol Hill Neighborhood.\n\nNow, I will check the status of each of these events using the available tools."
                  }
                ]
              ],
              [
                "trip_monitor_agent",
                [
                  {
                    "video_metadata": null,
                    "thought": null,
                    "inline_data": null,
                    "code_execution_result": null,
                    "executable_code": null,
                    "file_data": null,
                    "function_call": null,
                    "function_response": null,
                    "text": "Here's a summary of suggested changes for your attention:\n\n*   The Space Needle is closed on 2025-06-16, suggest finding alternatives.\n\nI am now transferring you back to the `in_trip_agent` to handle your other needs."
                  }
                ]
              ]
            ]
          },
          "creation_timestamp": 1747946882.9600983
        },
        {
          "invocation_id": "4fca44ac-214f-4481-b1bf-48c8747f936d",
          "user_content": {
            "parts": [
              {
                "video_metadata": null,
                "thought": null,
                "inline_data": null,
                "code_execution_result": null,
                "executable_code": null,
                "file_data": null,
                "function_call": null,
                "function_response": null,
                "text": "memorize the date '2025-06-16 12:45:00' and store it in the variable 'itinerary_datetime'"
              }
            ],
            "role": "user"
          },
          "final_response": {
            "parts": [
              {
                "video_metadata": null,
                "thought": null,
                "inline_data": null,
                "code_execution_result": null,
                "executable_code": null,
                "file_data": null,
                "function_call": null,
                "function_response": null,
                "text": "OK. I have stored the date '2025-06-16 12:45:00' in the variable 'itinerary_datetime'."
              }
            ],
            "role": "model"
          },
          "intermediate_data": {
            "tool_uses": [
              {
                "id": null,
                "args": {
                  "key": "itinerary_datetime",
                  "value": "2025-06-16 12:45:00"
                },
                "name": "memorize"
              }
            ],
            "intermediate_responses": []
          },
          "creation_timestamp": 1747946882.9601574
        },
        {
          "invocation_id": "39369eef-9864-48d6-bdbb-835be1059753",
          "user_content": {
            "parts": [
              {
                "video_metadata": null,
                "thought": null,
                "inline_data": null,
                "code_execution_result": null,
                "executable_code": null,
                "file_data": null,
                "function_call": null,
                "function_response": null,
                "text": "call day_of for transport help"
              }
            ],
            "role": "user"
          },
          "final_response": {
            "parts": [
              {
                "video_metadata": null,
                "thought": null,
                "inline_data": null,
                "code_execution_result": null,
                "executable_code": null,
                "file_data": null,
                "function_call": null,
                "function_response": null,
                "text": "Okay, it looks like you can walk from Ivar's Acres of Clams to the Space Needle in about 25-30 minutes, or take a rideshare which would be much faster."
              }
            ],
            "role": "model"
          },
          "intermediate_data": {
            "tool_uses": [
              {
                "id": null,
                "args": {
                  "request": "help"
                },
                "name": "day_of_agent"
              }
            ],
            "intermediate_responses": []
          },
          "creation_timestamp": 1747946882.9602013
        }
      ],
      "session_input": {
        "app_name": "",
        "user_id": "",
        "state": {
          "user_profile": {
            "passport_nationality": "US Citizen",
            "seat_preference": "window",
            "food_preference": "vegan",
            "allergies": [],
            "likes": [],
            "dislikes": [],
            "price_sensitivity": [],
            "home": {
              "event_type": "home",
              "address": "6420 Sequence Dr #400, San Diego, CA 92121, United States",
              "local_prefer_mode": "drive"
            }
          },
          "itinerary": {},
          "origin": "",
          "destination": "",
          "start_date": "",
          "end_date": "",
          "outbound_flight_selection": "",
          "outbound_seat_number": "",
          "return_flight_selection": "",
          "return_seat_number": "",
          "hotel_selection": "",
          "room_selection": "",
          "poi": "",
          "itinerary_datetime": "",
          "itinerary_start_date": "",
          "itinerary_end_date": ""
        }
      },
      "creation_timestamp": 1747946882.9602163
    }
  ],
  "creation_timestamp": 1747946882.9602237
}
======================================================================
FILE: ./eval/data/inspire.test.json
======================================================================

{
  "eval_set_id": "458648cd-dbfb-4dfd-a077-6997d73b0583",
  "name": "458648cd-dbfb-4dfd-a077-6997d73b0583",
  "description": null,
  "eval_cases": [
    {
      "eval_id": "/usr/local/google/home/gkcng/Projects/adk-samples/python/agents/travel-concierge/eval/data/inspire.test.json",
      "conversation": [
        {
          "invocation_id": "b263f24e-66ae-4b3c-8f10-77a682fea614",
          "user_content": {
            "parts": [
              {
                "video_metadata": null,
                "thought": null,
                "inline_data": null,
                "code_execution_result": null,
                "executable_code": null,
                "file_data": null,
                "function_call": null,
                "function_response": null,
                "text": "Inspire me about the Americas"
              }
            ],
            "role": "user"
          },
          "final_response": {
            "parts": [
              {
                "video_metadata": null,
                "thought": null,
                "inline_data": null,
                "code_execution_result": null,
                "executable_code": null,
                "file_data": null,
                "function_call": null,
                "function_response": null,
                "text": "Okay, I have a few ideas for you! How about:\n\n*   **Machu Picchu, Peru:** An ancient Inca citadel set high in the Andes Mountains.\n*   **Banff National Park, Canada:** Home to majestic mountains and turquoise lakes.\n*   **New York City, USA:** An iconic metropolis with world-class museums and diverse cuisine.\n\nAre any of these destinations of particular interest to you? I can provide more details on activities and attractions.\n"
              }
            ],
            "role": "model"
          },
          "intermediate_data": {
            "tool_uses": [
              {
                "id": null,
                "args": {
                  "agent_name": "inspiration_agent"
                },
                "name": "transfer_to_agent"
              },
              {
                "id": null,
                "args": {
                  "request": "Americas"
                },
                "name": "place_agent"
              }
            ],
            "intermediate_responses": []
          },
          "creation_timestamp": 1747946425.614513
        },
        {
          "invocation_id": "2402df6f-dd6c-454a-a39f-b2d4cd6d52b4",
          "user_content": {
            "parts": [
              {
                "video_metadata": null,
                "thought": null,
                "inline_data": null,
                "code_execution_result": null,
                "executable_code": null,
                "file_data": null,
                "function_call": null,
                "function_response": null,
                "text": "Tell me more what I can do in Peru"
              }
            ],
            "role": "user"
          },
          "final_response": {
            "parts": [
              {
                "video_metadata": null,
                "thought": null,
                "inline_data": null,
                "code_execution_result": null,
                "executable_code": null,
                "file_data": null,
                "function_call": null,
                "function_response": null,
                "text": "Peru is a land of incredible history and natural beauty! You could:\n\n*   **Explore Machu Picchu:** Hike through the iconic Inca citadel and marvel at its architectural genius.\n*   **Visit Rainbow Mountain:** Trek through vibrant, colorful landscapes.\n*   **Discover Lake Titicaca:** Explore the highest navigable lake in South America and visit the unique Uros floating islands.\n*   **Explore Sacsayhuamán:** Roam through this Inca fortress with massive stone walls.\n*   **Fly over the Nazca Lines:** Take a flight to witness the mysterious geoglyphs etched into the desert sands.\n\nGiven your vegan food preference, you'll be happy to know that many restaurants in Peru offer vegan options, especially in larger cities like Cusco and Lima.\n\nWhich of these activities sounds most appealing? Or is there anything else about Peru you're curious about?\n"
              }
            ],
            "role": "model"
          },
          "intermediate_data": {
            "tool_uses": [
              {
                "id": null,
                "args": {
                  "request": "Peru"
                },
                "name": "poi_agent"
              },
              {
                "id": null,
                "args": {
                  "key": "poi"
                },
                "name": "map_tool"
              }
            ],
            "intermediate_responses": []
          },
          "creation_timestamp": 1747946425.6145446
        },
        {
          "invocation_id": "2900db8e-a91d-49c9-934c-762097a885ad",
          "user_content": {
            "parts": [
              {
                "video_metadata": null,
                "thought": null,
                "inline_data": null,
                "code_execution_result": null,
                "executable_code": null,
                "file_data": null,
                "function_call": null,
                "function_response": null,
                "text": "Start planning"
              }
            ],
            "role": "user"
          },
          "final_response": {
            "parts": [
              {
                "video_metadata": null,
                "thought": null,
                "inline_data": null,
                "code_execution_result": null,
                "executable_code": null,
                "file_data": null,
                "function_call": null,
                "function_response": null,
                "text": "Okay, let's start planning your trip to Peru! Based on your interest in Peru, I'll plan a trip centered around Machu Picchu, Rainbow Mountain, Lake Titicaca, Sacsayhuamán, and the Nazca Lines.\n\nFirst, I need a little more information to create the perfect itinerary.\n\n*   **Origin:** Where will you be departing from?\n*   **Start Date:** When would you like to begin your trip?\n*   **End Date:** How many days would you like your trip to last?\n"
              }
            ],
            "role": "model"
          },
          "intermediate_data": {
            "tool_uses": [
              {
                "id": null,
                "args": {
                  "agent_name": "planning_agent"
                },
                "name": "transfer_to_agent"
              }
            ],
            "intermediate_responses": []
          },
          "creation_timestamp": 1747946425.6145635
        }
      ],
      "session_input": {
        "app_name": "",
        "user_id": "",
        "state": {
          "user_profile": {
            "passport_nationality": "US Citizen",
            "seat_preference": "window",
            "food_preference": "vegan",
            "allergies": [],
            "likes": [],
            "dislikes": [],
            "price_sensitivity": [],
            "home": {
              "event_type": "home",
              "address": "6420 Sequence Dr #400, San Diego, CA 92121, United States",
              "local_prefer_mode": "drive"
            }
          },
          "itinerary": {},
          "origin": "",
          "destination": "",
          "start_date": "",
          "end_date": "",
          "outbound_flight_selection": "",
          "outbound_seat_number": "",
          "return_flight_selection": "",
          "return_seat_number": "",
          "hotel_selection": "",
          "room_selection": "",
          "poi": "",
          "itinerary_datetime": "",
          "itinerary_start_date": "",
          "itinerary_end_date": ""
        }
      },
      "creation_timestamp": 1747946425.61458
    }
  ],
  "creation_timestamp": 1747946425.614588
}
======================================================================
FILE: ./eval/data/pretrip.test.json
======================================================================

{
  "eval_set_id": "c58dc575-5e62-48f1-ab8a-ed3100e40779",
  "name": "c58dc575-5e62-48f1-ab8a-ed3100e40779",
  "description": null,
  "eval_cases": [
    {
      "eval_id": "/usr/local/google/home/gkcng/Projects/adk-samples/python/agents/travel-concierge/eval/data/pretrip.test.json",
      "conversation": [
        {
          "invocation_id": "c21d0583-7d9f-443a-9dbc-edd0d5bf6700",
          "user_content": {
            "parts": [
              {
                "video_metadata": null,
                "thought": null,
                "inline_data": null,
                "code_execution_result": null,
                "executable_code": null,
                "file_data": null,
                "function_call": null,
                "function_response": null,
                "text": "transfer to pre_trip"
              }
            ],
            "role": "user"
          },
          "final_response": {
            "parts": [
              {
                "video_metadata": null,
                "thought": null,
                "inline_data": null,
                "code_execution_result": null,
                "executable_code": null,
                "file_data": null,
                "function_call": null,
                "function_response": null,
                "text": "Okay, I am now the pre-trip agent. I see you have a trip planned from San Diego to Seattle from June 15, 2025 to June 17, 2025. I also see you are a US Citizen."
              }
            ],
            "role": "model"
          },
          "intermediate_data": {
            "tool_uses": [
              {
                "id": null,
                "args": {
                  "agent_name": "pre_trip_agent"
                },
                "name": "transfer_to_agent"
              }
            ],
            "intermediate_responses": []
          },
          "creation_timestamp": 1747947041.1170905
        },
        {
          "invocation_id": "c6143e8a-65d2-4e59-bce7-18d3e089e488",
          "user_content": {
            "parts": [
              {
                "video_metadata": null,
                "thought": null,
                "inline_data": null,
                "code_execution_result": null,
                "executable_code": null,
                "file_data": null,
                "function_call": null,
                "function_response": null,
                "text": "update"
              }
            ],
            "role": "user"
          },
          "final_response": {
            "parts": [
              {
                "video_metadata": null,
                "thought": null,
                "inline_data": null,
                "code_execution_result": null,
                "executable_code": null,
                "file_data": null,
                "function_call": null,
                "function_response": null,
                "text": "Here are the important information for your trip:\n\n- **Visa:** As a US citizen traveling domestically from San Diego to Seattle, you do not need a visa.\n- **Medical:** Ensure your routine vaccinations are up to date, including the flu shot, and consult your doctor about any personal medical concerns or necessary prescription refills.\n- **Storm Update:** In Seattle during June, expect moderately warm weather with average high temperatures increasing from 69°F to 74°F, and be prepared for rainfall on approximately 8 days of the month.\n- **Travel Advisory:** For up-to-date travel alerts and advisories in Seattle, consult the SDOT Blog for information on construction, events, and traffic, and check the Washington State Tourism website for alerts related to transportation, wildfires, and natural impacts.\n- **What to Pack:** I suggest bringing a light jacket, umbrella, comfortable walking shoes, and layers of clothing.\n"
              }
            ],
            "role": "model"
          },
          "intermediate_data": {
            "tool_uses": [
              {
                "id": null,
                "args": {
                  "request": "visa_requirements for a US Citizen traveling from San Diego to Seattle"
                },
                "name": "google_search_grounding"
              },
              {
                "id": null,
                "args": {
                  "request": "medical_requirements for travel from San Diego to Seattle"
                },
                "name": "google_search_grounding"
              },
              {
                "id": null,
                "args": {
                  "request": "storm_monitor for Seattle in June"
                },
                "name": "google_search_grounding"
              },
              {
                "id": null,
                "args": {
                  "request": "travel_advisory for Seattle"
                },
                "name": "google_search_grounding"
              },
              {
                "id": null,
                "args": {
                  "request": "Seattle in June"
                },
                "name": "what_to_pack_agent"
              }
            ],
            "intermediate_responses": [
              [
                "pre_trip_agent",
                [
                  {
                    "video_metadata": null,
                    "thought": null,
                    "inline_data": null,
                    "code_execution_result": null,
                    "executable_code": null,
                    "file_data": null,
                    "function_call": null,
                    "function_response": null,
                    "text": "**Visa:** As a US citizen traveling from San Diego to Seattle, you don't need a visa. However, starting May 7, 2025, you'll need a REAL ID-compliant license or another acceptable form of identification (like a passport) for domestic flights."
                  }
                ]
              ],
              [
                "pre_trip_agent",
                [
                  {
                    "video_metadata": null,
                    "thought": null,
                    "inline_data": null,
                    "code_execution_result": null,
                    "executable_code": null,
                    "file_data": null,
                    "function_call": null,
                    "function_response": null,
                    "text": "**Medical:** Ensure you have a REAL ID-compliant driver's license or another acceptable form of identification like a U.S. passport. Check with your airline for any specific requirements."
                  }
                ]
              ],
              [
                "pre_trip_agent",
                [
                  {
                    "video_metadata": null,
                    "thought": null,
                    "inline_data": null,
                    "code_execution_result": null,
                    "executable_code": null,
                    "file_data": null,
                    "function_call": null,
                    "function_response": null,
                    "text": "**Storm Update:** I am unable to monitor storms specifically."
                  }
                ]
              ],
              [
                "pre_trip_agent",
                [
                  {
                    "video_metadata": null,
                    "thought": null,
                    "inline_data": null,
                    "code_execution_result": null,
                    "executable_code": null,
                    "file_data": null,
                    "function_call": null,
                    "function_response": null,
                    "text": "**Travel Advisory:** Seattle is generally safe, but be aware of petty crime, especially in tourist areas, and take normal security precautions."
                  }
                ]
              ],
              [
                "pre_trip_agent",
                [
                  {
                    "video_metadata": null,
                    "thought": null,
                    "inline_data": null,
                    "code_execution_result": null,
                    "executable_code": null,
                    "file_data": null,
                    "function_call": null,
                    "function_response": null,
                    "text": "**What to Pack:** I suggest bringing a light jacket, umbrella, comfortable walking shoes, and layers of clothing.}"
                  }
                ]
              ]
            ]
          },
          "creation_timestamp": 1747947041.1171503
        }
      ],
      "session_input": {
        "app_name": "",
        "user_id": "",
        "state": {
          "user_profile": {
            "passport_nationality": "US Citizen",
            "seat_preference": "window",
            "food_preference": "vegan",
            "allergies": [],
            "likes": [],
            "dislikes": [],
            "price_sensitivity": [],
            "home": {
              "event_type": "home",
              "address": "6420 Sequence Dr #400, San Diego, CA 92121, United States",
              "local_prefer_mode": "drive"
            }
          },
          "itinerary": {},
          "origin": "",
          "destination": "",
          "start_date": "",
          "end_date": "",
          "outbound_flight_selection": "",
          "outbound_seat_number": "",
          "return_flight_selection": "",
          "return_seat_number": "",
          "hotel_selection": "",
          "room_selection": "",
          "poi": "",
          "itinerary_datetime": "",
          "itinerary_start_date": "",
          "itinerary_end_date": ""
        }
      },
      "creation_timestamp": 1747947041.117178
    }
  ],
  "creation_timestamp": 1747947041.1171858
}
======================================================================
FILE: ./eval/test_eval.py
======================================================================

# Copyright 2025 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

"""Basic evaluation of the travel concierge agent."""

import pathlib

import dotenv
from google.adk.evaluation import AgentEvaluator
import pytest


@pytest.fixture(scope="session", autouse=True)
def load_env():
    dotenv.load_dotenv()


@pytest.mark.asyncio
async def test_inspire():
    """Test the agent's basic ability on a few examples."""
    await AgentEvaluator.evaluate(
        "travel_concierge",
        str(pathlib.Path(__file__).parent / "data/inspire.test.json"),
        num_runs=4
    )


@pytest.mark.asyncio
async def test_pretrip():
    """Test the agent's basic ability on a few examples."""
    await AgentEvaluator.evaluate(
        "travel_concierge",
        str(pathlib.Path(__file__).parent / "data/pretrip.test.json"),
        num_runs=4
    )


@pytest.mark.asyncio
async def test_intrip():
    """Test the agent's basic ability on a few examples."""
    await AgentEvaluator.evaluate(
        "travel_concierge",
        str(pathlib.Path(__file__).parent / "data/intrip.test.json"),
        num_runs=4
    )
    